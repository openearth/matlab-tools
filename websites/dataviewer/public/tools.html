<html>

<head>

	<link href="stylesheets/style.css" rel="stylesheet" type="text/css">
	<script src="http://www.google.com/jsapi?key=ABQIAAAAJOL4Dbu6i1iFFND9tVK1SxQHoHevx5I6K4zDbyPuyuDTxIU2BBSC_Q4vihWvqWvnnV3Qbrdn-3QeAQ"></script>
	<script type="text/javascript" src="scripts/js/loadxmldoc.js"></script>
	<script type="text/javascript" src="scripts/js/loadHtmlToDiv.js"></script>
	<script type="text/javascript" src="scripts/js/polydraw.js"></script>
	<script type="text/javascript" src="scripts/js/soapclient.js"></script>
	<script type="text/javascript" src="scripts/js/matlabsoap.js"></script>
	<script type="text/javascript" src="scripts/js/getQueryString.js"></script>
	<script type="text/javaScript" src="scripts/js/CalendarPopup.js"></script>
	<script type="text/javascript">
		var ge = null;
		var pm = null;
		var kml = null;
		var currentKmlObjects = {'':null};

		google.load("earth", "1", {'other_params': 'sensor=false' });

		// Initialize called on HTML body load
		function init()
		{
			google.earth.createInstance("map3d", initCB, failureCB);
		}

		// Initialization for Google Earth
		function initCB(instance)
		{
			ge = instance;
			// Google Earth Plugin Window Properties
			ge.getWindow().setVisibility(true);
			ge.getOptions().setStatusBarVisibility(true);
			// Google Earth Navigation Control Properties
			var navControl = ge.getNavigationControl();
			navControl.setVisibility(ge.VISIBILITY_SHOW);
			// Set starting position : The Netherlands
			var la = ge.createLookAt('');
			la.set(52.05249, 4.58105, 750000, ge.ALTITUDE_RELATIVE_TO_GROUND, 0, 0, 99.99);
			ge.getView().setAbstractView(la);
			// Polygon used for drawing the shape in Google Earth
			pm = new Polygon(0,0,0,0,document.getElementById('polygonselect').value);

			// Load requested tool
			fillToolLinks(getQuerystring('case'));
			loadTool(0);

		}

		// Initialize KMLs to be shown in Google Earth (needed for export to MathLab)
		function toggleKml(kml_cb)
		{
			file = kml_cb.id;

		    if (currentKmlObjects[file])
		    {
     	      ge.getFeatures().removeChild(currentKmlObjects[file]);
		      currentKmlObject = null;
		    }

			// Load the KML from location if checkbox is checked
			if (kml_cb.value == "on")
			  {
			    loadKml(file)
			  }
		}

		function loadKml(file)
		{
		    // fetch the KML
		    google.earth.fetchKml(ge, file, function(kmlObject)
		       {
			     if (kmlObject)
			     {
			         // show it on Earth
			         currentKmlObjects[file] = kmlObject;
			         ge.getFeatures().appendChild(kmlObject);

			     }
			     else
			     {
			         // bad KML
			         currentKmlObjects[file] = null;

			         // wrap alerts in API callbacks and event handlers in a setTimeout to prevent deadlock in some browsers
			         setTimeout(function()
			         {
			           alert('Bad or null KML.');
			         }, 0);
		         }
		       });
		}


		function loadWMS(wmsLocation)
		{
			var groundOverlay = ge.createGroundOverlay('');
			groundOverlay.setIcon(ge.createIcon(''));
			groundOverlay.getIcon().setHref(wmsLocation);
			groundOverlay.setLatLonBox(ge.createLatLonBox(''));
			var center = ge.getView().copyAsLookAt(ge.ALTITUDE_RELATIVE_TO_GROUND);
			var north = center.getLatitude() + .75;
			var south = center.getLatitude() - .75;
			var east = center.getLongitude() + 1.00;
			var west = center.getLongitude() - 1.00;
			var rotation = 0;
			var latLonBox = groundOverlay.getLatLonBox();
			latLonBox.setBox(north, south, east, west, rotation);
			ge.getFeatures().appendChild(groundOverlay);
		}

	// If Google Earth fails to load this function captures the Error Code
		function failureCB(errorCode){}

		// Fill tools checbox area
		function fillToolLinks(caseNr)
		{
			var caseDoc = caseDoc=loadXMLDoc("xml/cases.xml");
			document.getElementById("case_title").innerHTML = caseDoc.getElementsByTagName("title")[caseNr].childNodes[0].nodeValue;
			toolfile = caseDoc.getElementsByTagName("toolfile")[caseNr].childNodes[0].nodeValue;

			// load case-specific xml file
			toolDoc=loadXMLDoc("xml/" + toolfile);
			numOfData=toolDoc.getElementsByTagName("tool").length;

			// first remove all what is in the listbox
			while(toolSelect.options.length!=0)
			toolSelect.options.remove(0);

			// find tools from the tool xml and fill up the select lists
			var toolSelectText = [];

			for (i=0;i<numOfData;i=i+1)
			{
			var oOption = document.createElement("OPTION");
			oOption.text=toolDoc.getElementsByTagName("tool")[i].getElementsByTagName("title")[0].textContent;
			oOption.value=i;
			oOption.class="vs";
			toolSelect.options.add(oOption)
			}
			return true;
		}

		// Load selected case
		function loadTool(value)
		{
			// write tool-specific html
			var toolDoc = loadXMLDoc("xml/tools.xml");
			datafile = toolDoc.getElementsByTagName("template")[value].childNodes[0].nodeValue;
			loadHtmlToDiv("http://dtvirt13/bwn/optie_compiled/templates/" + datafile,"tool_space");

			// zoom to case specific coordinates
			lon_cam = parseFloat(toolDoc.getElementsByTagName("lon")[value].childNodes[0].nodeValue);
			lat_cam = parseFloat(toolDoc.getElementsByTagName("lat")[value].childNodes[0].nodeValue);
			alt_cam = parseFloat(toolDoc.getElementsByTagName("height")[value].childNodes[0].nodeValue);

  			var camera = ge.getView().copyAsCamera(ge.ALTITUDE_RELATIVE_TO_GROUND);
  			camera.setLatitude(lat_cam);
  			camera.setLongitude(lon_cam);
  			camera.setAltitude(alt_cam);
  			ge.getView().setAbstractView(camera);
  		}

	</script>
</head>

<body onload='init()' id='body'>
<h1>OpenEarth Online Tools</h1>
<table width="350" class="links">
	<tr>
		<td colspan="3" STYLE="font-size: 16pt; text-transform: uppercase;">
		<div id="case_title"></div>
		</td>
	</tr>
	<tr>
		<td>
		<script type="text/javascript">
		document.write("<a href=data.html?case=" + getQuerystring('case') + ">Data</a>");
		</script>
		</td>
		<td>
		<script type="text/javascript">
		document.write("<a href=models.html?case=" + getQuerystring('case') + ">Models</a>");
		</script>
		</td>
		<td>Tools</td>
	</tr>
</table>

<hr/>
<div style='float:left; width:350px; height:750px; overflow:auto'>
  <table style='font-size:small'>

<!-- TOOL SELECTION -->
	<tr>
		<td colspan="2">
	    <h3>Available tools</h3>
		</td>
	</tr>
	<tr>
		<td colspan="2">
		<form name="toolsel" action='javascript:void(0);'>
			<select name="toolsel" id="toolSelect" class="s" onchange='loadTool(value)'>
				<option value="0" class="vs">Select case</option>
			</select>
		</form>
		Do you want to add sources? Submit your request to the case manager!
	    <hr />
</td>
</tr>

<!-- TOOL SPACE -->
	<tr>
	    <td colspan="2">
	    <div id="tool_space"></div>
	    <hr />
	    </td>
	</tr>

<!-- DRAWING TOOLS -->
	<tr>
		<td colspan="2">
			<h3>Drawing</h3>
		</td>
	</tr>
	<tr>
		<td>
			<form id="polyShape" action='javascript:void(0);'>
			<select name="polygon" id="polygonselect" onchange='pm.numsides = this.value; pm.drawPolygon()' class="s">
				<option value="1" class="vs">Point</option>
				<option value="2" class="vs">Line</option>
				<option value="3" class="vs">Triangle</option>
				<option value="4" class="vs">Square</option>
				<option value="5" class="vs">Pentagon</option>
				<option value="6" class="vs">Hexagon</option>
				<option value="7" class="vs">Heptagon</option>
				<option value="8" class="vs">Octagon</option>
				<option value="9" class="vs">Nonagon</option>
				<option value="10" class="vs">Decagon</option>
				<option value="11" class="vs">Hendecagon</option>
				<option value="12" class="vs">Dodecagon</option>
				<option value="25" class="vs">Circle</option>
			</select>
			</form>
		</td>
		<td>
		Use ctrl + mouse click to draw
		</td>
	</tr>
	<tr><td colspan="2"><hr /></td></tr>

</table>
</div>
<div id='map3d_container' style='border: 1px solid silver; height: 750px; margin-left:350px;'>
	<div id='map3d' style='height: 100%;'></div>
</div>
<hr/>
    This tool is provided by: <br />
    <a href="http://openearth.eu" target="_blank"><img src="https://public.deltares.nl/download/attachments/16876019/OET?version=1" align="left" width="100"/></a>
</body>

</html>
