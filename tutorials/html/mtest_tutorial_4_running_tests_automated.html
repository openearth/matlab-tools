
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN">
<html xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
      <!--
This HTML is auto-generated from an M-file.
To make changes, update the M-file and republish this document.
      -->
      <title>4. Automated tesing with the MTest toolbox</title>
      <meta name="generator" content="MATLAB 7.9">
      <meta name="date" content="2010-12-30">
      <meta name="m-file" content="mtest_tutorial_4_running_tests_automated">
      <link type="text/css" href="script/css/jquery-ui-1.7.2.custom.css" rel="stylesheet">
      <link type="text/css" href="script/css/jquery.collapsible.css" rel="stylesheet"><script type="text/javascript" src="script/js/jquery-1.3.2.min.js"></script><script type="text/javascript" src="script/js/jquery-ui-1.7.2.custom.min.js"></script><script type="text/javascript" src="script/js/matlab2collapsible.js"></script><script type="text/javascript" src="script/js/jquery.collapsible.js"></script><script type="text/javascript" src="script/js/matlabhelp.js"></script><script src="http://www.google.com/jsapi?key=ABQIAAAA9KO06BPsmsvzw4PogoawhRRxYg1slSMvxuda9W0Kolc-SbeLlhQGHwE9W-XlCfe8WtZh74R56zOChQ"></script><script type="text/javascript" src="script/js/googleEarthApi.js"></script><script type="text/javascript">
    $(document).ready(function ()
      {
        // Copy content
	copycontent();

	// validate href of links to matlab tutorials
	matlabpreparehelprefs();

  	// Accordion
  	collapsible($(".collapsible"));
	
	// googleearth($(".geapi"));
	currentGeApiDiv = $(".geapi");	
      });
    </script><link type="text/css" href="script/css/matlabcode.css" rel="stylesheet">
   </head>
   <body LINK="#48339F" VLINK="#48339F" ALINK="#48339F">
      <div class="content">
         <div class="introduction ui-widget ui-widget-content ui-corner-all">
            <h1>4. Automated tesing with the MTest toolbox</h1>
            <div>
               <p>
                  The MTest toolbox is based on object oriented programming as introduced in matlab version 7.6
                  (2008a). It is able to search a specified maindir (and subdirs) for files that include a
                  predefined string (indicating that it is a test). It can transform the found testdefinition files
                  (written in the format explained in the <a class="relref" href="testdefinitions_tutorial.html"
                  relhref="tutorial_automatedtesting.html">tutorial on testdefinitions</a> into mtest objects
                  containing all information that is in the testdefinition. These mtest objects can be run individually
                  or with the help of the MTestRunner. The following sections will show how.
                  
               </p>
               <p>
                  <a class="relref" href="tutorial_automatedtesting.html" relhref="tutorial_automatedtesting.html">Read more about automated
                  testing</a>
                  
               </p>
            </div>
            <h2>Contents</h2>
            <div>
               <ul>
                  <li><a href="#1">Building an mtestengine</a></li>
                  <li><a href="#5">Properties (fieldnames) of the MTestRunner</a></li>
                  <li><a href="#6">Specifying tests to run</a></li>
                  <li><a href="#12">Run all tests</a></li>
                  <li><a href="#14">Run all tests and publish documentation and results</a></li>
               </ul>
            </div>
         </div>
         <div class="collapsible">
            <div>
               <h2><a name="1">Building an mtestengine</a></h2>
               <div>
                  <p>Creating an MTestRunner is as simple as the following code suggests:</p><pre class="codeinput">mte = MTestRunner;
</pre></div>
            </div>
            <div>
               <div>
                  <p>Similar to a struct we can now visualize the properties of this object:</p><pre class="codeinput">mte
</pre><pre class="codeoutput">
mte = 

  MTestRunner handle

  Properties:
            MainDir: 'e:\Temp\tp75c7b7fb_f2ac_4331_896f_056c3548a3b4'
          Recursive: 1
            Verbose: 0
    IncludeCoverage: 1
             TestID: '_test'
         Exclusions: {'.svn'  '_tutorial'  '_exclude'}
              Tests: [1x1 MTest]
      WrongTestDefs: {}
    TestsCatalogued: 0
...</pre></div>
            </div>
            <div>
               <div>
                  <p>It directly shows the default options for all fields. Of course we would like to set some of the properties. This can be done
                     either when creating the object itself (with property value pairs) or afterwards in the same way as altering fields of a struct:
                  </p><pre class="codeinput">mte.MainDir = fileparts(which(<span class="string">'MTestRunner'</span>));
mte.Verbose = true;
mte.Recursive = true;
mte.IncludeCoverage = false;
</pre></div>
            </div>
            <div>
               <div>
                  <p>or:</p><pre class="codeinput">mte = MTestRunner(<span class="keyword">...</span>
    <span class="string">'MainDir'</span>,fileparts(which(<span class="string">'mte_simple_test'</span>)),<span class="keyword">...</span>
    <span class="string">'Verbose'</span>,true,<span class="keyword">...</span>
    <span class="string">'Recursive'</span>,true,<span class="keyword">...</span>
    <span class="string">'IncludeCoverage'</span>,false);
</pre></div>
            </div>
            <div>
               <h2><a name="5">Properties (fieldnames) of the MTestRunner</a></h2>
               <div>
                  <p>The MTestRunner has a couple of properties that can be used to define its behaviour while running tests. The following table
                     lists the properties of an MTestRunner object.
                  </p>
                  <p>
                     <table cellspacing="0" class="body" cellpadding="4" summary="" width="100%" border="2">
                     <colgroup>
                     <col width="16%">
                     <col width="21%">
                     <col width="63%">
                     </colgroup>
                     <thead>
                     <tr valign="top">
                     <th bgcolor="#B2B2B2">Property Name</th>
                     <th bgcolor="#B2B2B2"><p>Class</p></th>
                     <th bgcolor="#B2B2B2"><p>Description</p></th>
                     </tr>
                     </thead>
                     <tbody>
                     <tr valign="top">
                     <td bgcolor="#F2F2F2"><tt>MainDir</tt></td>
                     <td bgcolor="#F2F2F2"><p><tt>char</tt> Default=<tt>cd</tt></p></td>
                     <td bgcolor="#F2F2F2">
                     Root directory of the toolbox that must be analysed and tested.
                     </td>
                     </tr>
                     <tr valign="top">
                     <td bgcolor="#F2F2F2"><tt>Recursive</tt></td>
                     <td bgcolor="#F2F2F2"><p><tt>logical</tt> Default=<tt>true</tt></p></td>
                     <td bgcolor="#F2F2F2">
                     Flag to determine whether the mtestengine only lists tests in the maindir or also in all subdirs of the maindir.
                     </td>
                     </tr>
                     <tr valign="top">
                     <td bgcolor="#F2F2F2"><tt>Verbose</tt></td>
                     <td bgcolor="#F2F2F2"><p><tt>logical</tt> Default=<tt>false</tt></p></td>
                     <td bgcolor="#F2F2F2">
                     Flag that determines whether intermediate information must be printed in the command window.
                     </td>
                     </tr>
                     <tr valign="top">
                     <td bgcolor="#F2F2F2"><tt>IncludeCoverage</tt></td>
                     <td bgcolor="#F2F2F2"><p><tt>logical</tt> Default=<tt>true</tt></p></td>
                     <td bgcolor="#F2F2F2">
                     Flag to turn on / off the profile function during execution of the tests to obtain function coverage information.
                     </td>
                     </tr>
                     <tr valign="top">
                     <td bgcolor="#F2F2F2"><tt>TestID</tt></td>
                     <td bgcolor="#F2F2F2"><p><tt>cell</tt> Default=<tt>{'_test'}</tt></p></td>
                     <td bgcolor="#F2F2F2">
                     The character arrays included in this cell determine which functionnames are identified as testdefinition files.
                     </td>
                     </tr>
                     <tr valign="top">
                     <td bgcolor="#F2F2F2"><tt>Exclusions</tt></td>
                     <td bgcolor="#F2F2F2"><p><tt>cell</tt> Default=<tt>{'.svn','_tutorial'}</tt></p></td>
                     <td bgcolor="#F2F2F2">
                     Any function or pathname that includes one of the character arrays filling this cell is excluded from the list of testsdefinitions.
                     </td>
                     </tr>
                     <tr valign="top">
                     <td bgcolor="#F2F2F2"><tt>Tests</tt></td>
                     <td bgcolor="#F2F2F2"><p><tt>mtest</tt> Default=<tt>[]</tt></p></td>
                     <td bgcolor="#F2F2F2">
                     mtest object with the loaded testdefinitions. The mtestengine takes this list whenever the run command is given.
                     </td>
                     </tr>
                     <tr valign="top">
                     <td bgcolor="#F2F2F2"><tt>WrongTestDefs</tt></td>
                     <td bgcolor="#F2F2F2"><p><tt>cell</tt> Default=<tt>{}</tt></p></td>
                     <td bgcolor="#F2F2F2">
                     Files identified as tests according to the testid and exclusion keywords, but failed
                     to load in an mtest object. This is probably due to a testdefinition that is not
                     according to the convention used for the mtest toolbox.
                     </td>
                     </tr>
                     </tbody>
                     </table>
                     
                  </p>
                  <p>Setting properties is already adressed in the previous section.</p>
               </div>
            </div>
            <div>
               <h2><a name="6">Specifying tests to run</a></h2>
               <div>
                  <p>After creation of an mtestengine we can see that it does not contain any testdefinitions yet. The <b><i>tests</i></b> contains an empty test.
                  </p><pre class="codeinput">mte.Tests
</pre><pre class="codeoutput">
ans = 

  MTest handle

  Properties:
               Name: []
             Ignore: 0
      IgnoreMessage: ''
           Category: 0
            Verbose: 1
        AutoRefresh: 0
         TestResult: 0
               Time: 0
               Date: NaN
...</pre></div>
            </div>
            <div>
               <div>
                  <p><b>manually add tests</b></p>
                  <p>Specifying tests can be done in two different ways. Of course we can add tests manually to the field:</p><pre class="codeinput">mte.Tests(1) = MTest(<span class="string">'mte_simple_test'</span>);
</pre></div>
            </div>
            <div>
               <div>
                  <p><b>search for tests</b></p>
                  <p>The catalogueTests method (or function) searches for all testdefinitions that match the following requirements:</p>
                  <p>
                     <ul>
                     <li>Tests should be in the maindir (or one of the subdirs if mte.recursive = true)</li>
                     <li>The filename should include one of the strings specified in the field <b><i>testid</i></b> of the mtestobject</li>
                     <li>The filename should not include one of the strings specified in the field <b><i>exclusion</i></b> of the mtestobject</li>
                     <li>mfiles that match the above mentionned criteria are converted to mtest objects. they must therefore match the layout criteria
                     described in the <a class="relref" href="testdefinitions_tutorial.html" relhref="tutorial_automatedtesting.html">tutorial
                     on testdefinitions</a></li>
                     </ul>
                     
                  </p>
                  <p>By default testdefinition files include the following string in their filename:</p><pre class="codeinput">mte.TestID
</pre><pre class="codeoutput">
ans =

_test

</pre></div>
            </div>
            <div>
               <div>
                  <p>but we exclude files with one of these strings in the filename</p><pre class="codeinput">mte.Exclusions
</pre><pre class="codeoutput">
ans = 

    '.svn'    '_tutorial'    '_exclude'

</pre></div>
            </div>
            <div>
               <div>
                  <p>After automatically searching for testdefinitions and adding them to the testengine ...</p><pre class="codeinput">gathertests(mte);
</pre><pre class="codeoutput">Collecting tests
</pre></div>
            </div>
            <div>
               <div>
                  <p>we can see that the content of the <b><i>tests</i></b> field has changed. This is of course due to the fact that we just collected all tests that match the description as stated
                     above:
                  </p><pre class="codeinput">mte
</pre><pre class="codeoutput">
mte = 

  MTestRunner handle

  Properties:
            MainDir: 'F:\OpenEarthTools\trunk\matlab\maintenance\1_MTest\examples'
          Recursive: 1
            Verbose: 1
    IncludeCoverage: 0
             TestID: '_test'
         Exclusions: {'.svn'  '_tutorial'  '_exclude'}
              Tests: [1x10 MTest]
      WrongTestDefs: {1x2 cell}
    TestsCatalogued: 1
...</pre></div>
            </div>
            <div>
               <h2><a name="12">Run all tests</a></h2>
               <div>
                  <p>To run all tests specified in the <b><i>tests</i></b> field of the mtestengine object there is a very simple function:
                  </p><pre class="codeinput">run(mte);
</pre><pre class="codeoutput">## start running tests ##
     mte_wrongdefinition_test Could not be interpreted as a valid testdefinition.
 1. mt_definitionwithdescription_newstyle_test (mt_definitionwithdescription_newstyle_test)
     Test started: mt_definitionwithdescription_newstyle_test
     Error occurred: Assertion failure:
Expected and actual vallue differ at location (1  1)
Expected: 4
Actual:   5
     Test finished: mt_definitionwithdescription_newstyle_test
 2. mte_concepttest_test (mte_concepttest_test)
     Test started: mte_concepttest_test
     Error occurred: 1 is not 2
     Test finished: name of the test
 3. mte_fulldefinition_test (mte_fulldefinition_test)
     Test started: mte_fulldefinition_test
...</pre></div>
            </div>
            <div>
               <div>
                  <p>Each mtest object under the field <b><i>"tests"</i></b> contains a field that stores the testresult:
                  </p><pre class="codeinput">mte.Tests(2).TestResult
</pre><pre class="codeoutput">
ans =

     0

</pre></div>
            </div>
            <div>
               <h2><a name="14">Run all tests and publish documentation and results</a></h2>
               <div>
                  <p>The run function runs all tests and publishes the description and vizualization of results as specified in the testdefinition
                     files. TODO: It also publishes the coverage of the tests (which percentages (and lines) of which functions did we actually
                     test). More information on this function can be found in its help documentation:
                  </p><pre class="codeinput">help <span class="string">MTestRunner.run</span>
</pre><pre class="codeoutput"> RUN  Runs all tests (that are in the "Test" property)
 
    This function executes the run function of all mtest objects in the Tests property.
 
    TODO:
        - include input argument to specify test numbers (instead of just all tests).
 
    Syntax:
    outobj = obj.run;
    outobj = run(obj);
 
    Input:
    obj     -   an MTestRunner object.
 
    Output:
...</pre></div>
            </div>
         </div>
         <p class="footer"><br>
            this tutorial is based on: <a class="matlabhref" href="matlab:edit('mtest_tutorial_4_running_tests_automated');" browserhref="http://crucible.delftgeosystems.nl/browse/~raw,r=3766/OpenEarthTools/trunk/matlab/maintenance/1_MTest/mtest_tutorial_4_running_tests_automated.m">mtest_tutorial_4_running_tests_automated.m (revision: 3766)</a><br>
Published with MATLAB&reg; 7.9<br></p>
      </div>
      <!--
##### SOURCE BEGIN #####
%% 4. Automated tesing with the MTest toolbox
%
% <html>
% The MTest toolbox is based on object oriented programming as introduced in matlab version 7.6
% (2008a). It is able to search a specified maindir (and subdirs) for files that include a
% predefined string (indicating that it is a test). It can transform the found testdefinition files
% (written in the format explained in the <a class="relref" href="testdefinitions_tutorial.html"
% relhref="tutorial_automatedtesting.html">tutorial on testdefinitions</a> into mtest objects
% containing all information that is in the testdefinition. These mtest objects can be run individually
% or with the help of the MTestRunner. The following sections will show how.
% </html>
%
% <html>
% <a class="relref" href="tutorial_automatedtesting.html" relhref="tutorial_automatedtesting.html">Read more about automated testing</a>
% </html>

%% Building an mtestengine
% Creating an MTestRunner is as simple as the following code suggests:

mte = MTestRunner;

%%
% Similar to a struct we can now visualize the properties of this object:

mte

%%
% It directly shows the default options for all fields. Of course we would like to set some of the
% properties. This can be done either when creating the object itself (with property value pairs) or
% afterwards in the same way as altering fields of a struct:

mte.MainDir = fileparts(which('MTestRunner'));
mte.Verbose = true;
mte.Recursive = true;
mte.IncludeCoverage = false;

%%
% or:

mte = MTestRunner(...
    'MainDir',fileparts(which('mte_simple_test')),...
    'Verbose',true,...
    'Recursive',true,...
    'IncludeCoverage',false);

%% Properties (fieldnames) of the MTestRunner
% The MTestRunner has a couple of properties that can be used to define its behaviour while running tests. 
% The following table lists the properties of an MTestRunner object.
%
% <html>
% <table cellspacing="0" class="body" cellpadding="4" summary="" width="100%" border="2">
%   <colgroup>
%       <col width="16%">
%       <col width="21%">
%       <col width="63%">
%   </colgroup>
%   <thead>
%       <tr valign="top">
%           <th bgcolor="#B2B2B2">Property Name</th>
%           <th bgcolor="#B2B2B2"><p>Class</p></th>
%           <th bgcolor="#B2B2B2"><p>Description</p></th>
%       </tr>
%   </thead>
%   <tbody>
%       <tr valign="top">
%           <td bgcolor="#F2F2F2"><tt>MainDir</tt></td>
%           <td bgcolor="#F2F2F2"><p><tt>char</tt> Default=<tt>cd</tt></p></td>
%           <td bgcolor="#F2F2F2">
%               Root directory of the toolbox that must be analysed and tested.
%           </td>
%       </tr>
%       <tr valign="top">
%           <td bgcolor="#F2F2F2"><tt>Recursive</tt></td>
%           <td bgcolor="#F2F2F2"><p><tt>logical</tt> Default=<tt>true</tt></p></td>
%           <td bgcolor="#F2F2F2">
%               Flag to determine whether the mtestengine only lists tests in the maindir or also in all subdirs of the maindir.
%           </td>
%       </tr>
%       <tr valign="top">
%           <td bgcolor="#F2F2F2"><tt>Verbose</tt></td>
%           <td bgcolor="#F2F2F2"><p><tt>logical</tt> Default=<tt>false</tt></p></td>
%           <td bgcolor="#F2F2F2">
%               Flag that determines whether intermediate information must be printed in the command window.
%           </td>
%       </tr>
%       <tr valign="top">
%           <td bgcolor="#F2F2F2"><tt>IncludeCoverage</tt></td>
%           <td bgcolor="#F2F2F2"><p><tt>logical</tt> Default=<tt>true</tt></p></td>
%           <td bgcolor="#F2F2F2">
%               Flag to turn on / off the profile function during execution of the tests to obtain function coverage information.
%           </td>
%       </tr>
%       <tr valign="top">
%           <td bgcolor="#F2F2F2"><tt>TestID</tt></td>
%           <td bgcolor="#F2F2F2"><p><tt>cell</tt> Default=<tt>{'_test'}</tt></p></td>
%           <td bgcolor="#F2F2F2">
%               The character arrays included in this cell determine which functionnames are identified as testdefinition files.
%           </td>
%       </tr>
%       <tr valign="top">
%           <td bgcolor="#F2F2F2"><tt>Exclusions</tt></td>
%           <td bgcolor="#F2F2F2"><p><tt>cell</tt> Default=<tt>{'.svn','_tutorial'}</tt></p></td>
%           <td bgcolor="#F2F2F2">
%               Any function or pathname that includes one of the character arrays filling this cell is excluded from the list of testsdefinitions.
%           </td>
%       </tr>
%       <tr valign="top">
%           <td bgcolor="#F2F2F2"><tt>Tests</tt></td>
%           <td bgcolor="#F2F2F2"><p><tt>mtest</tt> Default=<tt>[]</tt></p></td>
%           <td bgcolor="#F2F2F2">
%               mtest object with the loaded testdefinitions. The mtestengine takes this list whenever the run command is given.
%           </td>
%       </tr>
%       <tr valign="top">
%           <td bgcolor="#F2F2F2"><tt>WrongTestDefs</tt></td>
%           <td bgcolor="#F2F2F2"><p><tt>cell</tt> Default=<tt>{}</tt></p></td>
%           <td bgcolor="#F2F2F2">
%               Files identified as tests according to the testid and exclusion keywords, but failed
%               to load in an mtest object. This is probably due to a testdefinition that is not
%               according to the convention used for the mtest toolbox.
%           </td>
%       </tr>
%   </tbody>
% </table>
% </html>
%
% Setting properties is already adressed in the previous section.

%% Specifying tests to run
% After creation of an mtestengine we can see that it does not contain any testdefinitions yet. The
% *_tests_* contains an empty test.

mte.Tests

%%
% *manually add tests*
%
% Specifying tests can be done in two different ways. Of course we can add tests manually to the
% field:

mte.Tests(1) = MTest('mte_simple_test');

%%
% *search for tests*
%
% The catalogueTests method (or function) searches for all testdefinitions that match the following
% requirements:
%
% <html>
%   <ul>
%       <li>Tests should be in the maindir (or one of the subdirs if mte.recursive = true)</li>
%       <li>The filename should include one of the strings specified in the field <b><i>testid</i></b> of the mtestobject</li>
%       <li>The filename should not include one of the strings specified in the field <b><i>exclusion</i></b> of the mtestobject</li>
%       <li>mfiles that match the above mentionned criteria are converted to mtest objects. they must therefore match the layout criteria described in the <a class="relref" href="testdefinitions_tutorial.html" relhref="tutorial_automatedtesting.html">tutorial on testdefinitions</a></li>
%   </ul>
% </html>
%
% By default testdefinition files include the following string in their filename:
mte.TestID

%%
% but we exclude files with one of these strings in the filename
mte.Exclusions

%%
% After automatically searching for testdefinitions and adding them to the testengine ...

gathertests(mte);

%%
% we can see that the content of the *_tests_* field has changed. This is of course due to the fact
% that we just collected all tests that match the description as stated above:

mte

%% Run all tests
% To run all tests specified in the *_tests_* field of the mtestengine object there is a very simple
% function:

run(mte);

%%
% Each mtest object under the field *_"tests"_* contains a field that stores the testresult:

mte.Tests(2).TestResult

%% Run all tests and publish documentation and results
% The run function runs all tests and publishes the description and vizualization of
% results as specified in the testdefinition files.
% TODO: It also publishes the coverage of the tests (which percentages (and lines) of which functions did we actually test).
% More information on this function can be found in its help documentation:

help MTestRunner.run
##### SOURCE END #####
-->
   </body>
</html>