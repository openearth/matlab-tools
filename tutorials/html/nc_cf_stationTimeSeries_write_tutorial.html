
<!DOCTYPE html
PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN">
<html xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<!--
This HTML is auto-generated from an M-file.
To make changes, update the M-file and republish this document.
-->
<title>nc_cf_stationTimeSeries_write_tutorial</title>
<meta name="generator" content="MATLAB 7.7">
<meta name="date" content="2010-06-29">
<meta name="m-file" content="nc_cf_stationTimeSeries_write_tutorial">
<link type="text/css" href="script/css/jquery-ui-1.7.2.custom.css" rel="stylesheet">
<link type="text/css" href="script/css/jquery.collapsible.css" rel="stylesheet"><script type="text/javascript" src="script/js/jquery-1.3.2.min.js"></script><script type="text/javascript" src="script/js/jquery-ui-1.7.2.custom.min.js"></script><script type="text/javascript" src="script/js/matlab2collapsible.js"></script><script type="text/javascript" src="script/js/jquery.collapsible.js"></script><script type="text/javascript" src="script/js/matlabhelp.js"></script><script src="http://www.google.com/jsapi?key=ABQIAAAA9KO06BPsmsvzw4PogoawhRRxYg1slSMvxuda9W0Kolc-SbeLlhQGHwE9W-XlCfe8WtZh74R56zOChQ"></script><script type="text/javascript" src="script/js/googleEarthApi.js"></script><script type="text/javascript">
$(document).ready(function ()
{
// Copy content
copycontent();

// validate href of links to matlab tutorials
matlabpreparehelprefs();

// Accordion
collapsible($(".collapsible"));

// googleearth($(".geapi"));
currentGeApiDiv = $(".geapi");	
});
</script><link type="text/css" href="script/css/matlabcode.css" rel="stylesheet">
</head>
<body LINK="#48339F" VLINK="#48339F" ALINK="#48339F">
<div class="content">
<h2>Contents</h2>
<div>
<ul>
<li><a href="#1">Create netCDF-CF of a timeseries</a></li>
<li><a href="#2">Define meta-info: global</a></li>
<li><a href="#3">Define dimensions/coordinates</a></li>
<li><a href="#4">Define variable (define some data)</a></li>
<li><a href="#5">1.a Create netCDF file</a></li>
<li><a href="#6">1.b Add overall meta info</a></li>
<li><a href="#7">2   Create matrix span dimensions</a></li>
<li><a href="#8">3.a Create coordinate variables: time</a></li>
<li><a href="#9">3.b Create coordinate variables: longitude</a></li>
<li><a href="#10">3.c Create coordinate variables: latitude</a></li>
<li><a href="#11">3.d Create coordinate variables: coordinate system: WGS84 default</a></li>
<li><a href="#12">3.e Station number/name/code: proposed on:</a></li>
<li><a href="#13">4   Create dependent variable</a></li>
<li><a href="#14">5.a Create all variables with attributes</a></li>
<li><a href="#15">5.b Fill all variables</a></li>
<li><a href="#16">6   Check file summary</a></li>
<li><a href="#17">7.a Load the data: using the variable names from nc_dump</a></li>
<li><a href="#18">7.b Load the data: using standard_names and coordinate attribute</a></li>
<li><a href="#19">7.c Load the data: using a dedicated function developed for grids</a></li>
</ul>
</div>
<div class="collapsible">
<div>
<h2><a name="1">Create netCDF-CF of a timeseries</a></h2>
<div><pre>example of how to make a netCDF file with CF conventions of a
variable that is a timeseries. In this special case
the main dimension coincides with the time axis.</pre><pre>This case is described in:
* http://cf-pcmdi.llnl.gov/documents/cf-conventions/1.4/cf-conventions.html#id2984788 (simple)
* https://cf-pcmdi.llnl.gov/trac/wiki/PointObservationConventions (full definition)</pre><pre class="codeinput"><span class="comment">%See also: SNCTOOLS, NC_CF_STATIONTIMESERIES,...</span>
<span class="comment">%          NC_CF_GRID_WRITE_LAT_LON_ORTHOGONAL_TUTORIAL,</span>
<span class="comment">%          NC_CF_GRID_WRITE_LAT_LON_CURVILINEAR_TUTORIAL,</span>
<span class="comment">%          NC_CF_GRID_WRITE_X_Y_ORTHOGONAL_TUTORIAL</span>
<span class="comment">%          NC_CF_GRID_WRITE_X_Y_CURVILINEAR_TUTORIAL</span>

<span class="comment">% This tool is part of &lt;a href="http://www.OpenEarth.eu"&gt;OpenEarthTools&lt;/a&gt; under the &lt;a href="http://www.gnu.org/licenses/gpl.html"&gt;GPL&lt;/a&gt; license.</span>
</pre></div>
</div>
<div>
<h2><a name="2">Define meta-info: global</a></h2>
<div><pre class="codeinput">   OPT.title                  = <span class="string">''</span>;
OPT.institution            = <span class="string">''</span>;
OPT.source                 = <span class="string">''</span>;
OPT.history                = [<span class="string">'tranformation to netCDF: $HeadURL: https://repos.deltares.nl/repos/OpenEarthTools/trunk/matlab/io/netcdf/nctools/nc_cf_stationTimeSeries_write_tutorial.m $'</span>];
OPT.references             = <span class="string">''</span>;
OPT.email                  = <span class="string">''</span>;
OPT.comment                = <span class="string">''</span>;
OPT.version                = <span class="string">''</span>;
OPT.acknowledge            =[<span class="string">'These data can be used freely for research purposes provided that the following source is acknowledged: '</span>,OPT.institution];
OPT.disclaimer             = <span class="string">'This data is made available in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.'</span>;
</pre></div>
</div>
<div>
<h2><a name="3">Define dimensions/coordinates</a></h2>
<div><pre class="codeinput">   OPT.lon                    = 4.908893108;
OPT.lat                    = 52.37952805;
OPT.station_name           = <span class="string">'Hoek van Holland'</span>;
OPT.wgs84.code             = 4326;
</pre></div>
</div>
<div>
<h2><a name="4">Define variable (define some data)</a></h2>
<div><pre class="codeinput">   OPT.val                    = [1 2 3 nan 5 6];
OPT.datenum                = datenum(2001:2006,1,1);
OPT.timezone               = <span class="string">'+01:00'</span>;  <span class="comment">% MET=+1</span>
OPT.varname                = <span class="string">'windspeed'</span>;   <span class="comment">% free to choose: will appear in netCDF tree</span>
OPT.units                  = <span class="string">'m/s'</span>;         <span class="comment">% from UDunits package: http://www.unidata.ucar.edu/software/udunits/</span>
OPT.long_name              = <span class="string">'wind speed '</span>; <span class="comment">% free to choose: will appear in plots</span>
OPT.standard_name          = <span class="string">'wind_speed'</span>;
OPT.val_type               = <span class="string">'single'</span>;      <span class="comment">% 'single' or 'double'</span>
OPT.fillvalue              = nan;
</pre></div>
</div>
<div>
<h2><a name="5">1.a Create netCDF file</a></h2>
<div><pre class="codeinput">   ncfile = fullfile(fileparts(mfilename(<span class="string">'fullpath'</span>)),[mfilename,<span class="string">'.nc'</span>]);

nc_create_empty (ncfile)
</pre></div>
</div>
<div>
<h2><a name="6">1.b Add overall meta info</a></h2>
<div><pre>    http://cf-pcmdi.llnl.gov/documents/cf-conventions/1.4/cf-conventions.html#description-of-file-contents</pre><pre class="codeinput">   nc_attput(ncfile, nc_global, <span class="string">'title'</span>         , OPT.title);
nc_attput(ncfile, nc_global, <span class="string">'institution'</span>   , OPT.institution);
nc_attput(ncfile, nc_global, <span class="string">'source'</span>        , OPT.source);
nc_attput(ncfile, nc_global, <span class="string">'history'</span>       , OPT.history);
nc_attput(ncfile, nc_global, <span class="string">'references'</span>    , OPT.references);
nc_attput(ncfile, nc_global, <span class="string">'email'</span>         , OPT.email);

nc_attput(ncfile, nc_global, <span class="string">'comment'</span>       , OPT.comment);
nc_attput(ncfile, nc_global, <span class="string">'version'</span>       , OPT.version);

nc_attput(ncfile, nc_global, <span class="string">'Conventions'</span>   , <span class="string">'CF-1.4'</span>);
nc_attput(ncfile, nc_global, <span class="string">'CF:featureType'</span>, <span class="string">'Grid'</span>);  <span class="comment">% https://cf-pcmdi.llnl.gov/trac/wiki/PointObservationConventions</span>

nc_attput(ncfile, nc_global, <span class="string">'terms_for_use'</span> , OPT.acknowledge);
nc_attput(ncfile, nc_global, <span class="string">'disclaimer'</span>    , OPT.disclaimer);
</pre></div>
</div>
<div>
<h2><a name="7">2   Create matrix span dimensions</a></h2>
<div><pre>    http://cf-pcmdi.llnl.gov/documents/cf-conventions/1.4/cf-conventions.html#dimensions</pre><pre class="codeinput">   nc_add_dimension(ncfile, <span class="string">'time'</span>    , length(OPT.datenum));
nc_add_dimension(ncfile, <span class="string">'string'</span>  , length(OPT.station_name)); <span class="comment">% you could set this to UNLIMITED, be we suggest to keep UNLIMITED for time</span>

<span class="comment">% If you would like to include more locations of the same data,</span>
<span class="comment">% you can optionally use 'location' as a 2nd dimension.</span>
<span class="comment">% Here we use it for one station too, to be able to link cordinates.</span>

nc_add_dimension(ncfile, <span class="string">'location'</span>, 1);
</pre></div>
</div>
<div>
<h2><a name="8">3.a Create coordinate variables: time</a></h2>
<div><pre>    http://cf-pcmdi.llnl.gov/documents/cf-conventions/1.4/cf-conventions.html#time-coordinate</pre><pre class="codeinput">   <span class="comment">% For time we use "x units since reference_date + timezone", where</span>
<span class="comment">% * x              can be a character or number,</span>
<span class="comment">% * units          can be any units from UDunits: e.g. days, seconds, years, ...</span>
<span class="comment">% * reference_date is the moment where t-0 is defined in ISO notation</span>
<span class="comment">% * timezone       offset from GMT, in format -/+  HH:00</span>
<span class="comment">% For reference_date we advice to use a common epoch. Although gthis is a</span>
<span class="comment">% matlab tutorial, the matlab datenumber convention is not adviced:</span>
<span class="comment">% Here a a serial date number of 1 corresponds to Jan-1-0000. However, this</span>
<span class="comment">% epoch gives wrong dates in ncbrowse, as it uses a different calender. The</span>
<span class="comment">% Excel epoch of 31-dec-1899 is too stupid to be worth  mentioning. The Apple</span>
<span class="comment">% convenction of 1980 has been superseded since Apple uses unix as a basis. So</span>
<span class="comment">% * 1970-01-01    is adviced to use as epoch, the very common linux datenumber</span>
<span class="comment">%                 convention (which has no calender issues).</span>

OPT.refdatenum             = datenum(1970,1,1);

clear <span class="string">nc</span>;ifld = 1;
nc(ifld).Name             = <span class="string">'time'</span>;   <span class="comment">% dimension 'time' is here filled with variable 'time'</span>
nc(ifld).Nctype           = <span class="string">'double'</span>; <span class="comment">% time should always be in doubles</span>
nc(ifld).Dimension        = {<span class="string">'time'</span>};
nc(ifld).Attribute(    1) = struct(<span class="string">'Name'</span>, <span class="string">'long_name'</span>      ,<span class="string">'Value'</span>, <span class="string">'time'</span>);
nc(ifld).Attribute(end+1) = struct(<span class="string">'Name'</span>, <span class="string">'units'</span>          ,<span class="string">'Value'</span>, [<span class="string">'days since '</span>,datestr(OPT.refdatenum,<span class="string">'yyyy-mm-dd'</span>),<span class="string">' 00:00:00 '</span>,OPT.timezone]);
nc(ifld).Attribute(end+1) = struct(<span class="string">'Name'</span>, <span class="string">'standard_name'</span>  ,<span class="string">'Value'</span>, <span class="string">'time'</span>);
nc(ifld).Attribute(end+1) = struct(<span class="string">'Name'</span>, <span class="string">'actual_range'</span>   ,<span class="string">'Value'</span>, [min(OPT.datenum(:)) max(OPT.datenum(:))]-OPT.refdatenum);
</pre></div>
</div>
<div>
<h2><a name="9">3.b Create coordinate variables: longitude</a></h2>
<div><pre>    http://cf-pcmdi.llnl.gov/documents/cf-conventions/1.4/cf-conventions.html#longitude-coordinate</pre><pre class="codeinput">   ifld = ifld + 1;
nc(ifld).Name             = <span class="string">'lon'</span>;
nc(ifld).Nctype           = <span class="string">'double'</span>;
nc(ifld).Dimension        = {<span class="string">'location'</span>};
nc(ifld).Attribute(    1) = struct(<span class="string">'Name'</span>, <span class="string">'long_name'</span>      ,<span class="string">'Value'</span>, <span class="string">'longitude'</span>);
nc(ifld).Attribute(end+1) = struct(<span class="string">'Name'</span>, <span class="string">'units'</span>          ,<span class="string">'Value'</span>, <span class="string">'degrees_east'</span>);
nc(ifld).Attribute(end+1) = struct(<span class="string">'Name'</span>, <span class="string">'standard_name'</span>  ,<span class="string">'Value'</span>, <span class="string">'longitude'</span>);
nc(ifld).Attribute(end+1) = struct(<span class="string">'Name'</span>, <span class="string">'actual_range'</span>   ,<span class="string">'Value'</span>, [min(OPT.lon(:)) max(OPT.lon(:))]);
nc(ifld).Attribute(end+1) = struct(<span class="string">'Name'</span>, <span class="string">'coordinates'</span>    ,<span class="string">'Value'</span>, <span class="string">'lat lon'</span>);
nc(ifld).Attribute(end+1) = struct(<span class="string">'Name'</span>, <span class="string">'grid_mapping'</span>   ,<span class="string">'Value'</span>, <span class="string">'wgs84'</span>);
</pre></div>
</div>
<div>
<h2><a name="10">3.c Create coordinate variables: latitude</a></h2>
<div><pre>    http://cf-pcmdi.llnl.gov/documents/cf-conventions/1.4/cf-conventions.html#latitude-coordinate</pre><pre class="codeinput">   ifld = ifld + 1;
nc(ifld).Name             = <span class="string">'lat'</span>;
nc(ifld).Nctype           = <span class="string">'double'</span>;
nc(ifld).Dimension        = {<span class="string">'location'</span>};
nc(ifld).Attribute(    1) = struct(<span class="string">'Name'</span>, <span class="string">'long_name'</span>      ,<span class="string">'Value'</span>, <span class="string">'latitude'</span>);
nc(ifld).Attribute(end+1) = struct(<span class="string">'Name'</span>, <span class="string">'units'</span>          ,<span class="string">'Value'</span>, <span class="string">'degrees_north'</span>);
nc(ifld).Attribute(end+1) = struct(<span class="string">'Name'</span>, <span class="string">'standard_name'</span>  ,<span class="string">'Value'</span>, <span class="string">'latitude'</span>);
nc(ifld).Attribute(end+1) = struct(<span class="string">'Name'</span>, <span class="string">'actual_range'</span>   ,<span class="string">'Value'</span>, [min(OPT.lat(:)) max(OPT.lat(:))]);
nc(ifld).Attribute(end+1) = struct(<span class="string">'Name'</span>, <span class="string">'coordinates'</span>    ,<span class="string">'Value'</span>, <span class="string">'lat lon'</span>);
nc(ifld).Attribute(end+1) = struct(<span class="string">'Name'</span>, <span class="string">'grid_mapping'</span>   ,<span class="string">'Value'</span>, <span class="string">'wgs84'</span>);
</pre></div>
</div>
<div>
<h2><a name="11">3.d Create coordinate variables: coordinate system: WGS84 default</a></h2>
<div><pre>    global ellispes: WGS 84, ED 50, INT 1924, ETRS 89 and the upcoming ETRS update etc.
http://cf-pcmdi.llnl.gov/documents/cf-conventions/1.4/cf-conventions.html#grid-mappings-and-projections
http://cf-pcmdi.llnl.gov/documents/cf-conventions/1.4/cf-conventions.html#appendix-grid-mappings</pre><pre class="codeinput">   ifld = ifld + 1;
nc(ifld).Name         = <span class="string">'wgs84'</span>; <span class="comment">% preferred</span>
nc(ifld).Nctype       = nc_int;
nc(ifld).Dimension    = {};
nc(ifld).Attribute    = nc_cf_grid_mapping(OPT.wgs84.code);
var2evalstr(nc(ifld).Attribute)
</pre><pre class="codeoutput">
ans =

variable1(1).Name = 'name';
variable1(1).Value = 'WGS 84';
variable1(2).Name = 'epsg';
variable1(2).Value = 4326;
variable1(3).Name = 'grid_mapping_name';
variable1(3).Value = 'latitude_longitude';
variable1(4).Name = 'semi_major_axis';
variable1(4).Value = 6378137;
variable1(5).Name = 'semi_minor_axis';
variable1(5).Value = 6356752.3142;
variable1(6).Name = 'inverse_flattening';
variable1(6).Value = 298.2572;
...</pre></div>
</div>
<div>
<h2><a name="12">3.e Station number/name/code: proposed on:</a></h2>
<div><pre>    https://cf-pcmdi.llnl.gov/trac/wiki/PointObservationConventions</pre><pre class="codeinput">        ifld = ifld + 1;
nc(ifld).Name         = <span class="string">'station_id'</span>;
nc(ifld).Nctype       = <span class="string">'char'</span>;
nc(ifld).Dimension    = {<span class="string">'location'</span>,<span class="string">'string'</span>};
nc(ifld).Attribute(1) = struct(<span class="string">'Name'</span>, <span class="string">'long_name'</span>      ,<span class="string">'Value'</span>, <span class="string">'station identification code'</span>);
nc(ifld).Attribute(2) = struct(<span class="string">'Name'</span>, <span class="string">'standard_name'</span>  ,<span class="string">'Value'</span>, <span class="string">'station_id'</span>); <span class="comment">% standard name</span>
</pre></div>
</div>
<div>
<h2><a name="13">4   Create dependent variable</a></h2>
<div><pre>    http://cf-pcmdi.llnl.gov/documents/cf-conventions/1.4/cf-conventions.html#variables
Parameters with standard names:
http://cf-pcmdi.llnl.gov/documents/cf-standard-names/standard-name-table/current/</pre><pre class="codeinput">   ifld = ifld + 1;
nc(ifld).Name             = OPT.varname;
nc(ifld).Nctype           = nc_type(OPT.val_type);
nc(ifld).Dimension        = {<span class="string">'location'</span>,<span class="string">'time'</span>};
nc(ifld).Attribute(    1) = struct(<span class="string">'Name'</span>, <span class="string">'long_name'</span>      ,<span class="string">'Value'</span>, OPT.long_name    );
nc(ifld).Attribute(end+1) = struct(<span class="string">'Name'</span>, <span class="string">'units'</span>          ,<span class="string">'Value'</span>, OPT.units        );
nc(ifld).Attribute(end+1) = struct(<span class="string">'Name'</span>, <span class="string">'_FillValue'</span>     ,<span class="string">'Value'</span>, OPT.fillvalue    );
nc(ifld).Attribute(end+1) = struct(<span class="string">'Name'</span>, <span class="string">'actual_range'</span>   ,<span class="string">'Value'</span>, [min(OPT.val(:)) max(OPT.val(:))]);
nc(ifld).Attribute(end+1) = struct(<span class="string">'Name'</span>, <span class="string">'coordinates'</span>    ,<span class="string">'Value'</span>, <span class="string">'lat lon'</span>);
nc(ifld).Attribute(end+1) = struct(<span class="string">'Name'</span>, <span class="string">'grid_mapping'</span>   ,<span class="string">'Value'</span>, <span class="string">'epsg'</span>);
nc(ifld).Attribute(end+1) = struct(<span class="string">'Name'</span>, <span class="string">'standard_name'</span>  ,<span class="string">'Value'</span>, OPT.standard_name);
</pre></div>
</div>
<div>
<h2><a name="14">5.a Create all variables with attributes</a></h2>
<div><pre class="codeinput">   <span class="keyword">for</span> ifld=1:length(nc)
nc_addvar(ncfile, nc(ifld));
<span class="keyword">end</span>
</pre></div>
</div>
<div>
<h2><a name="15">5.b Fill all variables</a></h2>
<div><pre class="codeinput">   nc_varput(ncfile, <span class="string">'time'</span>         , OPT.datenum - OPT.refdatenum);
nc_varput(ncfile, <span class="string">'lon'</span>          , OPT.lon         );
nc_varput(ncfile, <span class="string">'lat'</span>          , OPT.lat         );
nc_varput(ncfile, <span class="string">'wgs84'</span>        , OPT.wgs84.code  );
nc_varput(ncfile, <span class="string">'station_id'</span>   , OPT.station_name);
nc_varput(ncfile, OPT.varname    , OPT.val         );
</pre></div>
</div>
<div>
<h2><a name="16">6   Check file summary</a></h2>
<div><pre class="codeinput">   nc_dump(ncfile);
fid = fopen(fullfile(fileparts(mfilename(<span class="string">'fullpath'</span>)),[mfilename,<span class="string">'.cdl'</span>]),<span class="string">'w'</span>);
nc_dump(ncfile,fid);
fclose(fid)
</pre><pre class="codeoutput">netCDF F:\checkouts\OpenEarthTools\matlab\io\netcdf\nctools\nc_cf_stationTimeSeries_write_tutorial.nc { 

dimensions:
time = 6 ;
string = 16 ;
location = 1 ;


variables:
// Preference 'PRESERVE_FVD':  false,
// dimensions consistent with ncBrowse, not with native MATLAB netcdf package.
double time(time), shape = [6]
time:long_name = "time" 
time:units = "days since 1970-01-01 00:00:00 +01:00" 
time:standard_name = "time" 
...</pre></div>
</div>
<div>
<h2><a name="17">7.a Load the data: using the variable names from nc_dump</a></h2>
<div><pre class="codeinput">   Da.datenum = nc_varget(ncfile,<span class="string">'time'</span>) + datenum(1970,1,1);
Da.var     = nc_varget(ncfile,<span class="string">'windspeed'</span>)
</pre><pre class="codeoutput">
Da = 

dep: [3x5 double]
lat: [3x1 single]
lon: [5x1 single]
datenum: [6x1 double]
var: [1 2 3 NaN 5 6]

</pre></div>
</div>
<div>
<h2><a name="18">7.b Load the data: using standard_names and coordinate attribute</a></h2>
<div><pre class="codeinput">   Db.datenum = nc_cf_time(ncfile);

varname    = nc_varfind(ncfile,<span class="string">'attributename'</span>, <span class="string">'standard_name'</span>, <span class="string">'attributevalue'</span>, <span class="string">'wind_speed'</span>)
Db.var     = nc_varget(ncfile,OPT.varname);
</pre><pre class="codeoutput">
varname =

windspeed

</pre></div>
</div>
<div>
<h2><a name="19">7.c Load the data: using a dedicated function developed for grids</a></h2>
<div><pre class="codeinput">   [Dc,Mc]    = nc_cf_stationTimeSeries(ncfile,OPT.varname,<span class="string">'plot'</span>,1);
</pre><img vspace="5" hspace="5" src="nc_cf_stationTimeSeries_write_tutorial_01.png" relsrc="nc_cf_stationTimeSeries_write_tutorial_01.png"> </div>
</div>
</div>
<p class="footer"><br>
this tutorial is based on: <a class="matlabhref" href="matlab:edit('nc_cf_stationTimeSeries_write_tutorial');" browserhref="http://crucible.delftgeosystems.nl/browse/~raw,r=NaN/OpenEarthTools/trunk/matlab/io/netcdf/nctools/nc_cf_stationTimeSeries_write_tutorial.m">nc_cf_stationTimeSeries_write_tutorial.m (revision: NaN)</a><br>
Published with MATLAB&reg; 7.7<br></p>
</div>
<!--
##### SOURCE BEGIN #####
%% Create netCDF-CF of a timeseries
%
%  example of how to make a netCDF file with CF conventions of a 
%  variable that is a timeseries. In this special case 
%  the main dimension coincides with the time axis.
%
%  This case is described in:
%  * http://cf-pcmdi.llnl.gov/documents/cf-conventions/1.4/cf-conventions.html#id2984788 (simple)
%  * https://cf-pcmdi.llnl.gov/trac/wiki/PointObservationConventions (full definition)
%
%See also: SNCTOOLS, NC_CF_STATIONTIMESERIES,...
%          NC_CF_GRID_WRITE_LAT_LON_ORTHOGONAL_TUTORIAL, 
%          NC_CF_GRID_WRITE_LAT_LON_CURVILINEAR_TUTORIAL, 
%          NC_CF_GRID_WRITE_X_Y_ORTHOGONAL_TUTORIAL
%          NC_CF_GRID_WRITE_X_Y_CURVILINEAR_TUTORIAL

% This tool is part of <a href="http://www.OpenEarth.eu">OpenEarthTools</a> under the <a href="http://www.gnu.org/licenses/gpl.html">GPL</a> license.

%% Define meta-info: global

OPT.title                  = '';
OPT.institution            = '';
OPT.source                 = '';
OPT.history                = ['tranformation to netCDF: $HeadURL: https://repos.deltares.nl/repos/OpenEarthTools/trunk/matlab/io/netcdf/nctools/nc_cf_stationTimeSeries_write_tutorial.m $'];
OPT.references             = '';
OPT.email                  = '';
OPT.comment                = '';
OPT.version                = '';
OPT.acknowledge            =['These data can be used freely for research purposes provided that the following source is acknowledged: ',OPT.institution];
OPT.disclaimer             = 'This data is made available in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.';

%% Define dimensions/coordinates

OPT.lon                    = 4.908893108;
OPT.lat                    = 52.37952805;
OPT.station_name           = 'Hoek van Holland';
OPT.wgs84.code             = 4326;

%% Define variable (define some data)

OPT.val                    = [1 2 3 nan 5 6];
OPT.datenum                = datenum(2001:2006,1,1);
OPT.timezone               = '+01:00';  % MET=+1
OPT.varname                = 'windspeed';   % free to choose: will appear in netCDF tree
OPT.units                  = 'm/s';         % from UDunits package: http://www.unidata.ucar.edu/software/udunits/
OPT.long_name              = 'wind speed '; % free to choose: will appear in plots
OPT.standard_name          = 'wind_speed';
OPT.val_type               = 'single';      % 'single' or 'double'
OPT.fillvalue              = nan;

%% 1.a Create netCDF file

ncfile = fullfile(fileparts(mfilename('fullpath')),[mfilename,'.nc']);

nc_create_empty (ncfile)

%% 1.b Add overall meta info
%      http://cf-pcmdi.llnl.gov/documents/cf-conventions/1.4/cf-conventions.html#description-of-file-contents

nc_attput(ncfile, nc_global, 'title'         , OPT.title);
nc_attput(ncfile, nc_global, 'institution'   , OPT.institution);
nc_attput(ncfile, nc_global, 'source'        , OPT.source);
nc_attput(ncfile, nc_global, 'history'       , OPT.history);
nc_attput(ncfile, nc_global, 'references'    , OPT.references);
nc_attput(ncfile, nc_global, 'email'         , OPT.email);

nc_attput(ncfile, nc_global, 'comment'       , OPT.comment);
nc_attput(ncfile, nc_global, 'version'       , OPT.version);

nc_attput(ncfile, nc_global, 'Conventions'   , 'CF-1.4');
nc_attput(ncfile, nc_global, 'CF:featureType', 'Grid');  % https://cf-pcmdi.llnl.gov/trac/wiki/PointObservationConventions

nc_attput(ncfile, nc_global, 'terms_for_use' , OPT.acknowledge);
nc_attput(ncfile, nc_global, 'disclaimer'    , OPT.disclaimer);

%% 2   Create matrix span dimensions
%      http://cf-pcmdi.llnl.gov/documents/cf-conventions/1.4/cf-conventions.html#dimensions   

nc_add_dimension(ncfile, 'time'    , length(OPT.datenum));
nc_add_dimension(ncfile, 'string'  , length(OPT.station_name)); % you could set this to UNLIMITED, be we suggest to keep UNLIMITED for time

% If you would like to include more locations of the same data, 
% you can optionally use 'location' as a 2nd dimension.                                         
% Here we use it for one station too, to be able to link cordinates. 

nc_add_dimension(ncfile, 'location', 1); 

%% 3.a Create coordinate variables: time
%      http://cf-pcmdi.llnl.gov/documents/cf-conventions/1.4/cf-conventions.html#time-coordinate

% For time we use "x units since reference_date + timezone", where 
% * x              can be a character or number,
% * units          can be any units from UDunits: e.g. days, seconds, years, ...
% * reference_date is the moment where t-0 is defined in ISO notation
% * timezone       offset from GMT, in format -/+  HH:00
% For reference_date we advice to use a common epoch. Although gthis is a 
% matlab tutorial, the matlab datenumber convention is not adviced: 
% Here a a serial date number of 1 corresponds to Jan-1-0000. However, this 
% epoch gives wrong dates in ncbrowse, as it uses a different calender. The
% Excel epoch of 31-dec-1899 is too stupid to be worth  mentioning. The Apple
% convenction of 1980 has been superseded since Apple uses unix as a basis. So
% * 1970-01-01    is adviced to use as epoch, the very common linux datenumber 
%                 convention (which has no calender issues).

OPT.refdatenum             = datenum(1970,1,1); 

clear nc;ifld = 1;
nc(ifld).Name             = 'time';   % dimension 'time' is here filled with variable 'time'
nc(ifld).Nctype           = 'double'; % time should always be in doubles
nc(ifld).Dimension        = {'time'};
nc(ifld).Attribute(    1) = struct('Name', 'long_name'      ,'Value', 'time');
nc(ifld).Attribute(end+1) = struct('Name', 'units'          ,'Value', ['days since ',datestr(OPT.refdatenum,'yyyy-mm-dd'),' 00:00:00 ',OPT.timezone]);
nc(ifld).Attribute(end+1) = struct('Name', 'standard_name'  ,'Value', 'time');
nc(ifld).Attribute(end+1) = struct('Name', 'actual_range'   ,'Value', [min(OPT.datenum(:)) max(OPT.datenum(:))]-OPT.refdatenum);

%% 3.b Create coordinate variables: longitude
%      http://cf-pcmdi.llnl.gov/documents/cf-conventions/1.4/cf-conventions.html#longitude-coordinate

ifld = ifld + 1;
nc(ifld).Name             = 'lon';
nc(ifld).Nctype           = 'double';
nc(ifld).Dimension        = {'location'};
nc(ifld).Attribute(    1) = struct('Name', 'long_name'      ,'Value', 'longitude');
nc(ifld).Attribute(end+1) = struct('Name', 'units'          ,'Value', 'degrees_east');
nc(ifld).Attribute(end+1) = struct('Name', 'standard_name'  ,'Value', 'longitude');
nc(ifld).Attribute(end+1) = struct('Name', 'actual_range'   ,'Value', [min(OPT.lon(:)) max(OPT.lon(:))]);
nc(ifld).Attribute(end+1) = struct('Name', 'coordinates'    ,'Value', 'lat lon');
nc(ifld).Attribute(end+1) = struct('Name', 'grid_mapping'   ,'Value', 'wgs84');

%% 3.c Create coordinate variables: latitude
%      http://cf-pcmdi.llnl.gov/documents/cf-conventions/1.4/cf-conventions.html#latitude-coordinate

ifld = ifld + 1;
nc(ifld).Name             = 'lat';
nc(ifld).Nctype           = 'double';
nc(ifld).Dimension        = {'location'};
nc(ifld).Attribute(    1) = struct('Name', 'long_name'      ,'Value', 'latitude');
nc(ifld).Attribute(end+1) = struct('Name', 'units'          ,'Value', 'degrees_north');
nc(ifld).Attribute(end+1) = struct('Name', 'standard_name'  ,'Value', 'latitude');
nc(ifld).Attribute(end+1) = struct('Name', 'actual_range'   ,'Value', [min(OPT.lat(:)) max(OPT.lat(:))]);
nc(ifld).Attribute(end+1) = struct('Name', 'coordinates'    ,'Value', 'lat lon');
nc(ifld).Attribute(end+1) = struct('Name', 'grid_mapping'   ,'Value', 'wgs84');

%% 3.d Create coordinate variables: coordinate system: WGS84 default
%      global ellispes: WGS 84, ED 50, INT 1924, ETRS 89 and the upcoming ETRS update etc.
%      http://cf-pcmdi.llnl.gov/documents/cf-conventions/1.4/cf-conventions.html#grid-mappings-and-projections
%      http://cf-pcmdi.llnl.gov/documents/cf-conventions/1.4/cf-conventions.html#appendix-grid-mappings

ifld = ifld + 1;
nc(ifld).Name         = 'wgs84'; % preferred
nc(ifld).Nctype       = nc_int;
nc(ifld).Dimension    = {};
nc(ifld).Attribute    = nc_cf_grid_mapping(OPT.wgs84.code);
var2evalstr(nc(ifld).Attribute)

%% 3.e Station number/name/code: proposed on:
%      https://cf-pcmdi.llnl.gov/trac/wiki/PointObservationConventions

ifld = ifld + 1;
nc(ifld).Name         = 'station_id';
nc(ifld).Nctype       = 'char';
nc(ifld).Dimension    = {'location','string'};
nc(ifld).Attribute(1) = struct('Name', 'long_name'      ,'Value', 'station identification code');
nc(ifld).Attribute(2) = struct('Name', 'standard_name'  ,'Value', 'station_id'); % standard name

%% 4   Create dependent variable
%      http://cf-pcmdi.llnl.gov/documents/cf-conventions/1.4/cf-conventions.html#variables
%      Parameters with standard names:
%      http://cf-pcmdi.llnl.gov/documents/cf-standard-names/standard-name-table/current/

ifld = ifld + 1;
nc(ifld).Name             = OPT.varname;
nc(ifld).Nctype           = nc_type(OPT.val_type);
nc(ifld).Dimension        = {'location','time'};
nc(ifld).Attribute(    1) = struct('Name', 'long_name'      ,'Value', OPT.long_name    );
nc(ifld).Attribute(end+1) = struct('Name', 'units'          ,'Value', OPT.units        );
nc(ifld).Attribute(end+1) = struct('Name', '_FillValue'     ,'Value', OPT.fillvalue    );
nc(ifld).Attribute(end+1) = struct('Name', 'actual_range'   ,'Value', [min(OPT.val(:)) max(OPT.val(:))]);
nc(ifld).Attribute(end+1) = struct('Name', 'coordinates'    ,'Value', 'lat lon');
nc(ifld).Attribute(end+1) = struct('Name', 'grid_mapping'   ,'Value', 'epsg');
nc(ifld).Attribute(end+1) = struct('Name', 'standard_name'  ,'Value', OPT.standard_name);

%% 5.a Create all variables with attributes

for ifld=1:length(nc)
nc_addvar(ncfile, nc(ifld));   
end

%% 5.b Fill all variables

nc_varput(ncfile, 'time'         , OPT.datenum - OPT.refdatenum);
nc_varput(ncfile, 'lon'          , OPT.lon         );
nc_varput(ncfile, 'lat'          , OPT.lat         );
nc_varput(ncfile, 'wgs84'        , OPT.wgs84.code  );
nc_varput(ncfile, 'station_id'   , OPT.station_name);
nc_varput(ncfile, OPT.varname    , OPT.val         );

%% 6   Check file summary

nc_dump(ncfile);
fid = fopen(fullfile(fileparts(mfilename('fullpath')),[mfilename,'.cdl']),'w');
nc_dump(ncfile,fid);
fclose(fid)

%% 7.a Load the data: using the variable names from nc_dump

Da.datenum = nc_varget(ncfile,'time') + datenum(1970,1,1);
Da.var     = nc_varget(ncfile,'windspeed')

%% 7.b Load the data: using standard_names and coordinate attribute

Db.datenum = nc_cf_time(ncfile);

varname    = nc_varfind(ncfile,'attributename', 'standard_name', 'attributevalue', 'wind_speed')
Db.var     = nc_varget(ncfile,OPT.varname);

%% 7.c Load the data: using a dedicated function developed for grids

[Dc,Mc]    = nc_cf_stationTimeSeries(ncfile,OPT.varname,'plot',1);

##### SOURCE END #####
-->
</body>
</html>
