
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN">
<html xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
      <!--
This HTML is auto-generated from an M-file.
To make changes, update the M-file and republish this document.
      -->
      <title>Extracting JarKus data from NetCDF</title>
      <meta name="generator" content="MATLAB 7.5">
      <meta name="date" content="2009-08-04">
      <meta name="m-file" content="tutorial_jarkus1a_reading_data"><style>

body {
  background-color: white;
  margin:10px;
}

h1 {
  color: #990000; 
  font-size: x-large;
}

h2 {
  color: #990000;
  font-size: medium;
}

/* Make the text shrink to fit narrow windows, but not stretch too far in 
wide windows. */ 
p,h1,h2,div.content div {
  max-width: 600px;
  /* Hack for IE6 */
  width: auto !important; width: 600px;
}

pre.codeinput {
  background: #EEEEEE;
  padding: 10px;
}
@media print {
  pre.codeinput {word-wrap:break-word; width:100%;}
} 

span.keyword {color: #0000FF}
span.comment {color: #228B22}
span.string {color: #A020F0}
span.untermstring {color: #B20000}
span.syscmd {color: #B28C00}

pre.codeoutput {
  color: #666666;
  padding: 10px;
}

pre.error {
  color: red;
}

p.footer {
  text-align: right;
  font-size: xx-small;
  font-weight: lighter;
  font-style: italic;
  color: gray;
}

  </style></head>
   <body>
      <div class="content">
         <h1>Extracting JarKus data from NetCDF</h1>
         <introduction>
            <p>For this example, we will extract data from a Jarkus profile in Egmond aan Zeeform the from opendap server, for the year 1999.</p>
         </introduction>
         <h2>Contents</h2>
         <div>
            <ul>
               <li><a href="#1">Locate the data file on the internet</a></li>
               <li><a href="#5">look at metadata</a></li>
               <li><a href="#7">figure out which part of the data we need</a></li>
               <li><a href="#11">extract the data</a></li>
               <li><a href="#16">plot the data</a></li>
            </ul>
         </div>
         <h2>Locate the data file on the internet<a name="1"></a></h2>
         <p>To locate the NETcdf data file, browse to:</p>
         <p><a href="http:\\opendap.deltares.nl:8080">http:\\opendap.deltares.nl:8080</a></p>
         <p>Find the Jarkus NetCDF file by clicking on: hyrax ==&gt; Rijkswaterstaat ==&gt; Jarkus ==&gt; transects. Click on the link to the file
            and extract the direct link to the JarKus NetCDF data file.
         </p><pre class="codeinput">url = <span class="string">'http://opendap.deltares.nl:8080/opendap/rijkswaterstaat/jarkus/profiles/transect.nc'</span>;
</pre><p>alternatively, you can use the function jarkus_url. This hast the advantage that it returns the link to the netCDF file on
            the Deltares network if it is available. This is faster than accessing data over the internet.
         </p><pre class="codeinput">url = jarkus_url
</pre><pre class="codeoutput">
url =

P:\mcdata\opendap\rijkswaterstaat\jarkus\profiles\transect.nc

</pre><h2>look at metadata<a name="5"></a></h2>
         <p>we can get data from this file using nc_varget. But first, let's see what is in the file using nc_dump. nc_dump shows all
            the metadata in the file. In the case of the JarKus file this is a lot.
         </p><pre class="codeinput">nc_dump(url)
</pre><pre class="codeoutput">netcdf P:\mcdata\opendap\rijkswaterstaat\jarkus\profiles\transect.nc { 

dimensions:
	time = UNLIMITED ; (44 currently)
	alongshore = 2178 ;
	cross_shore = 1925 ;
	stringsize = 100 ;


variables:
	long id(alongshore), shape = [2178]
		id:long_name = "identifier" 
		id:comment = "sum of area code (x1000000) and alongshore coordinate" 
	long areacode(alongshore), shape = [2178]
		areacode:long_name = "area code" 
...</pre><p>from the metadata we can see that there is a field 'id'. To look at this data, euse nc_varget.</p><pre class="codeinput">id = nc_varget(url,<span class="string">'id'</span>)
</pre><pre class="codeoutput">
id =

     2000100
     2000101
     2000102
     2000103
     2000104
     2000105
     2000106
     2000120
     2000140
     2000160
     2000180
     2000200
...</pre><h2>figure out which part of the data we need<a name="7"></a></h2>
         <p>The transect we are looking for is #3800, in area 7 (Noord-Holland). This transect has id 7003800.</p><pre class="codeinput">transect_nr = find(id==7003800)
</pre><pre class="codeoutput">
transect_nr =

        1074

</pre><p>To get only data from this transect, we can give nc_varget some extra arguments. The first optional argument is the start
            index from where you want to extract data. The second argument indicates the number or entrie you want along this dimension.
            In our case this is 1.
         </p><pre class="codeinput">id          = nc_varget(url,<span class="string">'id'</span>,transect_nr,1)
</pre><pre class="codeoutput">
id =

     7003825

</pre><p>The returned transect number is one off. This is becasue of zero based indexing of NetCDF files (versus 1 based indexing of
            MATLAB). This is easily corrected:
         </p><pre class="codeinput">id          = nc_varget(url,<span class="string">'id'</span>);
transect_nr = find(id==7003800)-1;
id          = nc_varget(url,<span class="string">'id'</span>,transect_nr,1)
</pre><pre class="codeoutput">
id =

     7003800

</pre><p>now that we have the correct transect, we can do the same for the year</p><pre class="codeinput">year        = nc_varget(url,<span class="string">'time'</span>);
year_nr     = find(year == 1966)-1;
year        = nc_varget(url,<span class="string">'time'</span>,year_nr,1)
</pre><pre class="codeoutput">
year =

        1966

</pre><h2>extract the data<a name="11"></a></h2>
         <p>The cross shore coordinate relative to RSP (RijksStrandPalen) is stored in the cross_shore field and the z data in the altitude
            field. Extracting the xRSP data is simple:
         </p><pre class="codeinput">xRSP        = nc_varget(url,<span class="string">'cross_shore'</span>);
</pre><p>from the nc_dump we find:</p>
         <p><tt>double altitude(time,alongshore,cross_shore), shape = [44 2178 1925]</tt></p>
         <p>This means that the altitude data is stored in a 3d matrix, which is a function of time, alongshore and cross_shore cordinates.
            We want data for 1 year, and for 1 alongshore coordinate, but for all cross shore locations. Use -1 in the second argument
            to ask for all data in that dimension:
         </p><pre class="codeinput">z           = nc_varget(url,<span class="string">'altitude'</span>,[year_nr,transect_nr,1],[1,1,-1]);
</pre><p>Not for every possible cross shore location, there is altitude information. For our case we might as well leave out those
            datapoints:
         </p><pre class="codeinput">x    = xRSP(~isnan(z));
z    =    z(~isnan(z));
</pre><h2>plot the data<a name="16"></a></h2>
         <p>always plot data to check if it's ok:</p><pre class="codeinput">plot(x,z,<span class="string">'.b'</span>)
</pre><img vspace="5" hspace="5" src="tutorial_jarkus1a_reading_data_01.png"> <p class="footer"><br>
            Published with MATLAB&reg; 7.5<br></p>
      </div>
      <!--
##### SOURCE BEGIN #####
%% Extracting JarKus data from NetCDF
% For this example, we will extract data from a Jarkus profile in Egmond 
% aan Zeeform the from opendap server, for the year 1999.

%% Locate the data file on the internet
% To locate the NETcdf data file, browse to:
%%
% <http:\\opendap.deltares.nl:8080> 

%% 
% Find the Jarkus NetCDF file by clicking on:
% hyrax ==> Rijkswaterstaat ==> Jarkus ==> transects.
% Click on the link to the file and extract the direct link to the JarKus
% NetCDF data file. 

url = 'http://opendap.deltares.nl:8080/opendap/rijkswaterstaat/jarkus/profiles/transect.nc';

%%
% alternatively, you can use the function jarkus_url. This hast the
% advantage that it returns the link to the netCDF file on the Deltares
% network if it is available. This is faster than accessing data
% over the internet.

url = jarkus_url

%% look at metadata
% we can get data from this file using nc_varget. But first, let's see what
% is in the file using nc_dump. nc_dump shows all the metadata in the file.
% In the case of the JarKus file this is a lot.

nc_dump(url)

%% 
% from the metadata we can see that there is a field 'id'. To look at this
% data, euse nc_varget.

id = nc_varget(url,'id')

%% figure out which part of the data we need
% The transect we are looking for is #3800, in area 7 (Noord-Holland). This
% transect has id 7003800. 

transect_nr = find(id==7003800)

%%
% To get only data from this transect, we can give nc_varget some extra
% arguments. The first optional argument is the start index from where you 
% want to extract data.
% The second argument indicates the number or entrie you want along this 
% dimension. In our case this is 1.

id          = nc_varget(url,'id',transect_nr,1)

%%
% The returned transect number is one off. This is becasue of zero based
% indexing of NetCDF files (versus 1 based indexing of MATLAB). This is
% easily corrected:

id          = nc_varget(url,'id');
transect_nr = find(id==7003800)-1;
id          = nc_varget(url,'id',transect_nr,1)

%%
% now that we have the correct transect, we can do the same for the year

year        = nc_varget(url,'time');
year_nr     = find(year == 1966)-1;
year        = nc_varget(url,'time',year_nr,1)

%% extract the data
% The cross shore coordinate relative to RSP (RijksStrandPalen) is stored 
% in the cross_shore field and the z data in the altitude field.
% Extracting the xRSP data is simple:

xRSP        = nc_varget(url,'cross_shore');

%%
% from the nc_dump we find: 
%%
% |double altitude(time,alongshore,cross_shore), shape = [44 2178 1925]|
%%
% This means that the altitude data is stored in a 3d matrix, which is a
% function of time, alongshore and cross_shore cordinates.
% We want data for 1 year, and for 1 alongshore coordinate, but for all
% cross shore locations. Use -1 in the second argument to ask for all data
% in that dimension:

z           = nc_varget(url,'altitude',[year_nr,transect_nr,1],[1,1,-1]);

%%
% Not for every possible cross shore location, there is altitude
% information. For our case we might as well leave out those datapoints:

x    = xRSP(~isnan(z));
z    =    z(~isnan(z));

%% plot the data
% always plot data to check if it's ok:

plot(x,z,'.b')
##### SOURCE END #####
-->
   </body>
</html>