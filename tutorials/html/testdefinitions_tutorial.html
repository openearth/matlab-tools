
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN">
<html xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
      <!--
This HTML is auto-generated from an M-file.
To make changes, update the M-file and republish this document.
      -->
      <title>2. Creating a test</title>
      <meta name="generator" content="MATLAB 7.10">
      <meta name="date" content="2010-06-22">
      <meta name="m-file" content="testdefinitions_tutorial">
      <link type="text/css" href="script/css/jquery-ui-1.7.2.custom.css" rel="stylesheet">
      <link type="text/css" href="script/css/jquery.collapsible.css" rel="stylesheet"><script type="text/javascript" src="script/js/jquery-1.3.2.min.js"></script><script type="text/javascript" src="script/js/jquery-ui-1.7.2.custom.min.js"></script><script type="text/javascript" src="script/js/matlab2collapsible.js"></script><script type="text/javascript" src="script/js/jquery.collapsible.js"></script><script type="text/javascript" src="script/js/matlabhelp.js"></script><script src="http://www.google.com/jsapi?key=ABQIAAAA9KO06BPsmsvzw4PogoawhRRxYg1slSMvxuda9W0Kolc-SbeLlhQGHwE9W-XlCfe8WtZh74R56zOChQ"></script><script type="text/javascript" src="script/js/googleEarthApi.js"></script><script type="text/javascript">
    $(document).ready(function ()
      {
        // Copy content
	copycontent();

	// validate href of links to matlab tutorials
	matlabpreparehelprefs();

  	// Accordion
  	collapsible($(".collapsible"));
	
	// googleearth($(".geapi"));
	currentGeApiDiv = $(".geapi");	
      });
    </script><link type="text/css" href="script/css/matlabcode.css" rel="stylesheet">
   </head>
   <body LINK="#48339F" VLINK="#48339F" ALINK="#48339F">
      <div class="content">
         <div class="introduction ui-widget ui-widget-content ui-corner-all">
            <h1>2. Creating a test</h1>
            <div>
               <p>Test definitions can contain several parts, but can also be minimal. This tutorial will first show all you know to generate
                  a test according to the OpenEarhtTools conventions and will then explain the conventions in detail.
               </p>
               <p>
                  <a class="relref" href="tutorial_automatedtesting.html" relhref="tutorial_automatedtesting.html">Read more about automated
                  testing</a>
                  
               </p>
            </div>
            <h2>Contents</h2>
            <div>
               <ul>
                  <li><a href="#1">Creating tests</a></li>
                  <li><a href="#2">Simple test</a></li>
                  <li><a href="#4">Basic elements of a test</a></li>
                  <li><a href="#5">Test code</a></li>
                  <li><a href="#6">Additional functions / methods</a></li>
                  <li><a href="#13">Formatting the publishable elements of a test</a></li>
                  <li><a href="#14">Examples</a></li>
               </ul>
            </div>
         </div>
         <div class="collapsible">
            <div>
               <h2><a name="1">Creating tests</a></h2>
               <div>
                  <p>Like functions OpenEarthTools also contains a function to automatically generate a new test (<i>oetnewtest</i>). <i>oetnewtest</i> can be used the following ways:
                  </p>
                  <p><b>Syntax</b></p>
                  <ul>
                     <li>oetnewtest('filename');</li>
                     <li>oetnewtest('currentfile');</li>
                     <li>oetnewtest('functionname');</li>
                     <li>oetnewfun(..., 'PropertyName', PropertyValue,...);</li>
                  </ul>
                  <p><b>Input</b></p>
                  <ul>
                     <li>'filename'    -   name of the test file (this should end with "_test.m" otherwise it is treated as a function name. If the
                        filename is not specified, an Untitled test will be generated.
                     </li>
                     <li>'currentfile' -   Looks up the last selected file in the matlab editor and creates a test for that function.</li>
                     <li>'functionname'-   Name of the function for which this file should provide a test.</li>
                  </ul>
                  <p><b>PropertyNames</b></p>
                  <ul>
                     <li>'h1line'      -   One line description</li>
                     <li>'description' -   Detailed description of the test</li>
                  </ul>
                  <p><b>Examples</b></p>
                  <ul>
                     <li>oetnewtest('oetnewtest_test');</li>
                     <li>oetnewtest('currentfile');</li>
                     <li>oetnewtest('oetnewtest');</li>
                  </ul>
               </div>
            </div>
            <div>
               <h2><a name="2">Simple test</a></h2>
               <div>
                  <p>For the sake of simplicity the most simple test is just a function with one line of code. The function must obay the following
                     rules:
                  </p>
                  <ul>
                     <li>The function name should contain <b><i>"_test"</i></b>.
                     </li>
                     <li>The function should be addressed <b><i>without any input parameters</i></b></li>
                  </ul>
                  <p>Such a function could look like this:</p><pre class="codeinput"><span class="keyword">function</span> testname_test()
</pre></div>
            </div>
            <div>
               <div><pre class="codeinput">assert(true,<span class="string">'This test does not crash'</span>);
</pre></div>
            </div>
            <div>
               <h2><a name="4">Basic elements of a test</a></h2>
               <div>
                  <p>A Testdefinition can be divided into two parts:</p>
                  <ol>
                     <li>Function help block</li>
                     <li>the test code itself</li>
                  </ol>
                  <p><b>Function help block</b></p>
                  <p>
                     Firstly a testdefinition is a function. Following the basic function documentation described in the
                     <a href="http://public.deltares.nl/display/OET/OpenEarth+guidelines+-+Matlab">Matlab style guide</a>
                     we should include a help block in the function with a layout similar to the one provided by
                     _oetnewfun_.
                     
                  </p>
                  <p><img vspace="5" hspace="5" src="prerendered_images/test_helpblock.png" relsrc="prerendered_images/test_helpblock.png"> </p>
               </div>
            </div>
            <div>
               <h2><a name="5">Test code</a></h2>
               <div>
                  <p>The code body of the test contains code to test a function or functions. If the function does not return a variable it is
                     counted as succeeded whenever there is no error detected. It is also possible to include a boolean variable as first output
                     argument, which indicates whether the test was successfull or not.
                  </p>
                  <p>The use of the matlab build-in function "_assert_" can come in handy when testing the result of a function against requirements.
                     For example:
                  </p><pre class="codeinput">a = sum([1, 1]);
assert(a==1,<span class="string">'1+1 should be equal to 2'</span>);
</pre></div>
            </div>
            <div>
               <h2><a name="6">Additional functions / methods</a></h2>
               <div>
                  <p>Furthermore one can use several functions available in the MTest toolbox to ignore tests, or document a test or its result:</p>
                  <ul>
                     <li>TeamCity.running</li>
                     <li>TeamCity.ignore</li>
                     <li>TeamCity.publishdescription</li>
                     <li>TeamCity.publishresult</li>
                     <li>MTest.name</li>
                     <li>MTest.category</li>
                  </ul>
                  <p><b>TeamCity.running</b></p>
                  <p>returns a boolean that is true whenever the TeamCity server is running tests. This function can typically be used to do something
                     that is only needed when running test at the buildserver (for example ignore the result).
                  </p>
                  <p><b>TeamCity.ignore</b></p>
                  <p>Causes the teamcity server to ignore the current test. The reason to ignore should be included as a string input into this
                     function. If the TeamCity server is not running this function will do nothing.
                  </p>
                  <p>An example of using both methods mentioned above to ignore tests:</p><pre class="codeinput"><span class="keyword">if</span> TeamCity.running
    TeamCity.ignore(<span class="string">'Work In Progress'</span>);
    <span class="keyword">return</span>;
<span class="keyword">end</span>
</pre></div>
            </div>
            <div>
               <div>
                  <p><b>TeamCity.publishdescription</b></p>
                  <p>This function adds a reference to the documentation of the test. This documentation can be located in a subfunction of the
                     test, or a file outside the testdefinition (as a script or function). When using this function to publish the test description,
                     the code of the specified function is copied and pasted into a temp file. This temp file gets published. Before and after
                     publication of the description the active workspace (of the test function) is copied in such a way that the result of the
                     publishable description is available in the workspace after finishing publication. Som of the publish options can be included
                     as input parameters. An example of how to use this function is given below:
                  </p><pre class="codeinput">TeamCity.publishdescription(@mte_descriptionhelper,<span class="keyword">...</span>
    <span class="string">'EvaluateCode'</span>,true,<span class="keyword">...</span>
    <span class="string">'IncludeCode'</span>,true,<span class="keyword">...</span>
    <span class="string">'maxWidht'</span>,400);
</pre></div>
            </div>
            <div>
               <div>
                  <p>Or:</p><pre class="codeinput">TeamCity.publishdescription(<span class="string">'mte_descriptionhelper'</span>,<span class="keyword">...</span>
    <span class="string">'EvaluateCode'</span>,true,<span class="keyword">...</span>
    <span class="string">'IncludeCode'</span>,true,<span class="keyword">...</span>
    <span class="string">'maxWidht'</span>,400);
</pre></div>
            </div>
            <div>
               <div>
                  <p><b>TeamCity.publishresult</b></p>
                  <p>Similar to TeamCity.publishdescription, this function adds a reference to publishable code that describes the test result.
                     Useage is also similar to TeamCity.publishdescription.
                  </p>
                  <p><b>MTest.name</b></p>
                  <p>Can be used to give a test a custome name (by default a tests gets the filename as name).</p><pre class="codeinput">MTest.name(<span class="string">'New name'</span>);
</pre></div>
            </div>
            <div>
               <div>
                  <p><b>MTest.category</b></p>
                  <p>This method specifies the Category of the test.</p><pre class="codeinput">MTest.category(<span class="string">'Integration'</span>);
</pre></div>
            </div>
            <div>
               <div>
                  <p>Or:</p><pre class="codeinput">MTest.category(<span class="string">'Slow'</span>);
</pre></div>
            </div>
            <div>
               <div>
                  <p>Or:</p><pre class="codeinput">MTest.category(<span class="string">'UnitTest'</span>);
</pre></div>
            </div>
            <div>
               <h2><a name="13">Formatting the publishable elements of a test</a></h2>
               <div>
                  <p>There are two publishable elements in a test definition (description and result). Publication of these parts to html is done
                     with the matlab function <b><i>"publish"</i></b>. A lot of information on formatting the output html pages can be found in the matlab documentation.
                  </p>
                  <p>
                     The
                     <a href="http://www.mathworks.com/access/helpdesk/help/techdoc/index.html?/access/helpdesk/help/techdoc/matlab_env/f6-30186.html&http://www.mathworks.com/cgi-bin/texis/webinator/search_spt?db=MSS&prox=page&rorder=750&rprox=750&rdfreq=500&rwfreq=500&rlead=250&sufs=0&order=r&is_summary_on=1&pr=SPT&cq=1&collection=1&ResultCount=10&query=Formatting+M-Files+Comments+for+publishing&x=8&y=8"
                     target="new">
                     matlab help documentation
                     </a>
                     contains a lot of information on formatting comments or code for publishing with the publish
                     function. It is for example possible to include equations, force a snapshot or include a
                     prerendered image. The matlab editor also contains a menu item with all of these functionalities:
                     
                  </p>
                  <p><img vspace="5" hspace="5" src="prerendered_images/test_cell_menu.png" relsrc="prerendered_images/test_cell_menu.png"> </p>
               </div>
            </div>
            <div>
               <h2><a name="14">Examples</a></h2>
               <div>
                  <p>The following files contain examples of how te use the testdefinition to obtain the desired result:</p>
                  <p>
                     <ul>
                     <li><a href="http://crucible.delftgeosystems.nl/browse/~raw,r=trunk/OpenEarthTools/trunk/matlab/maintenance/automatedTesting/examples/mte_simple_test.m"
                     target="new">Basic test</a></li>
                     <li><a href="http://crucible.delftgeosystems.nl/browse/~raw,r=trunk/OpenEarthTools/trunk/matlab/maintenance/automatedTesting/examples/mte_dummy_test.m"
                     target="new">Use of testcases</a></li>
                     </ul>
                     
                  </p>
               </div>
            </div>
         </div>
         <p class="footer"><br>
            this tutorial is based on: <a class="matlabhref" href="matlab:edit('testdefinitions_tutorial');" browserhref="http://crucible.delftgeosystems.nl/browse/~raw,r=2703/OpenEarthTools/trunk/matlab/maintenance/1_automated_Testing/testdefinitions_tutorial.m">testdefinitions_tutorial.m (revision: 2703)</a><br>
Published with MATLAB&reg; 7.10<br></p>
      </div>
      <!--
##### SOURCE BEGIN #####
%% 2. Creating a test
% Test definitions can contain several parts, but can also be minimal. This tutorial will first show
% all you know to generate a test according to the OpenEarhtTools conventions and will then explain
% the conventions in detail.
%
% <html>
% <a class="relref" href="tutorial_automatedtesting.html" relhref="tutorial_automatedtesting.html">Read more about automated testing</a>
% </html>

%% Creating tests
% Like functions OpenEarthTools also contains a function to automatically generate a new test
% (_oetnewtest_). _oetnewtest_ can be used the following ways:
%
% *Syntax*
%
% * oetnewtest('filename');
% * oetnewtest('currentfile');
% * oetnewtest('functionname');
% * oetnewfun(..., 'PropertyName', PropertyValue,...);
%
% *Input*
% 
% * 'filename'    -   name of the test file (this should end with "_test.m" otherwise it is treated
% as a function name. If the filename is not specified, an Untitled test will be generated.
% * 'currentfile' -   Looks up the last selected file in the matlab editor and creates a test for that function. 
% * 'functionname'-   Name of the function for which this file should provide a test.
%
% *PropertyNames*
%
% * 'h1line'      -   One line description
% * 'description' -   Detailed description of the test
%
% *Examples*
%
% * oetnewtest('oetnewtest_test');
% * oetnewtest('currentfile');
% * oetnewtest('oetnewtest');

%% Simple test
% For the sake of simplicity the most simple test is just a function with one line of code. The
% function must obay the following rules:
%
% * The function name should contain *_"_test"_*.
% * The function should be addressed *_without any input parameters_*
%
% Such a function could look like this:
function testname_test()
assert(true,'This test does not crash');

%% Basic elements of a test
% A Testdefinition can be divided into two parts:
%
% # Function help block
% # the test code itself
%
% *Function help block*
%
% <html>
% Firstly a testdefinition is a function. Following the basic function documentation described in the 
% <a href="http://public.deltares.nl/display/OET/OpenEarth+guidelines+-+Matlab">Matlab style guide</a>
% we should include a help block in the function with a layout similar to the one provided by
% _oetnewfun_.
% </html>
%
% <<prerendered_images/test_helpblock.png>>
%

%% Test code
%
% The code body of the test contains code to test a function or functions. If the function does not
% return a variable it is counted as succeeded whenever there is no error detected. It is also
% possible to include a boolean variable as first output argument, which indicates whether the test
% was successfull or not.
%
% The use of the matlab build-in function "_assert_" can come in handy when testing the result of a
% function against requirements. For example:
%
a = sum([1, 1]);
assert(a==1,'1+1 should be equal to 2');

%% Additional functions / methods
% Furthermore one can use several functions available in the MTest toolbox to ignore tests, or
% document a test or its result:
%
% * TeamCity.running
% * TeamCity.ignore
% * TeamCity.publishdescription
% * TeamCity.publishresult
% * MTest.name
% * MTest.category
%
% *TeamCity.running*
%
% returns a boolean that is true whenever the TeamCity server is running tests. This function can
% typically be used to do something that is only needed when running test at the buildserver (for
% example ignore the result).
%
% *TeamCity.ignore*
%
% Causes the teamcity server to ignore the current test. The reason to ignore should be included as 
% a string input into this function. If the TeamCity server is not running this function will do
% nothing.
%
% An example of using both methods mentioned above to ignore tests:
%
if TeamCity.running
    TeamCity.ignore('Work In Progress');
    return;
end

%%
% *TeamCity.publishdescription*
%
% This function adds a reference to the documentation of the test. This documentation can be located
% in a subfunction of the test, or a file outside the testdefinition (as a script or function). When
% using this function to publish the test description, the code of the specified function is copied
% and pasted into a temp file. This temp file gets published. Before and after publication of the
% description the active workspace (of the test function) is copied in such a way that the result of
% the publishable description is available in the workspace after finishing publication. Som of the
% publish options can be included as input parameters. An example of how to use this function is
% given below:
TeamCity.publishdescription(@mte_descriptionhelper,...
    'EvaluateCode',true,...
    'IncludeCode',true,...
    'maxWidht',400);

%%
% Or:

TeamCity.publishdescription('mte_descriptionhelper',...
    'EvaluateCode',true,...
    'IncludeCode',true,...
    'maxWidht',400);

%% 
% *TeamCity.publishresult*
%
% Similar to TeamCity.publishdescription, this function adds a reference to publishable code that
% describes the test result. Useage is also similar to TeamCity.publishdescription.
%
% *MTest.name*
%
% Can be used to give a test a custome name (by default a tests gets the filename as name).

MTest.name('New name');

%%
% *MTest.category*
%
% This method specifies the Category of the test.

MTest.category('Integration');

%%
% Or:

MTest.category('Slow');

%%
% Or:

MTest.category('UnitTest');

%% Formatting the publishable elements of a test
% There are two publishable elements in a test definition (description and result).
% Publication of these parts to html is done with the matlab function *_"publish"_*. A lot of
% information on formatting the output html pages can be found in the matlab documentation.
%
% <html>
% The 
% <a href="http://www.mathworks.com/access/helpdesk/help/techdoc/index.html?/access/helpdesk/help/techdoc/matlab_env/f6-30186.html&http://www.mathworks.com/cgi-bin/texis/webinator/search_spt?db=MSS&prox=page&rorder=750&rprox=750&rdfreq=500&rwfreq=500&rlead=250&sufs=0&order=r&is_summary_on=1&pr=SPT&cq=1&collection=1&ResultCount=10&query=Formatting+M-Files+Comments+for+publishing&x=8&y=8" target="new">
% matlab help documentation
% </a>
% contains a lot of information on formatting comments or code for publishing with the publish
% function. It is for example possible to include equations, force a snapshot or include a
% prerendered image. The matlab editor also contains a menu item with all of these functionalities:
% </html>
%
% <<prerendered_images/test_cell_menu.png>>

%% Examples
% The following files contain examples of how te use the testdefinition to obtain the desired
% result:
%
% <html>
%   <ul>
%       <li><a href="http://crucible.delftgeosystems.nl/browse/~raw,r=trunk/OpenEarthTools/trunk/matlab/maintenance/automatedTesting/examples/mte_simple_test.m" target="new">Basic test</a></li>
%       <li><a href="http://crucible.delftgeosystems.nl/browse/~raw,r=trunk/OpenEarthTools/trunk/matlab/maintenance/automatedTesting/examples/mte_dummy_test.m" target="new">Use of testcases</a></li>
%   </ul>
% </html>
%


##### SOURCE END #####
-->
   </body>
</html>