
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN">
<html xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
      <!--
This HTML is auto-generated from an M-file.
To make changes, update the M-file and republish this document.
      -->
      <title>Extracting JarKus data from netCDF</title>
      <meta name="generator" content="MATLAB 7.8">
      <meta name="date" content="2009-09-08">
      <meta name="m-file" content="jarkus_tutorial_reading_data_1">
      <link type="text/css" href="script/css/custom-theme/jquery-ui-1.7.2.custom.css" rel="stylesheet"><script type="text/javascript" src="script/js/jquery-1.3.2.min.js"></script><script type="text/javascript" src="script/js/jquery-ui-1.7.2.custom.min.js"></script><script type="text/javascript" src="script/js/matlab2accordion.js"></script><script type="text/javascript">
  	$(document).ready(function ()
  	{
  	// Copy content
	copycontent();

  	// Accordion
  	$(".accordion").accordion({ header: "h2" });
	$(".accordion").accordion('option', 'autoHeight', false);
	$(".accordion").accordion('option', 'collapsible', true);
	$(".accordion").accordion('activate',false);
	$(".accordion").accordion('option', 'clearStyle', true);
  	});
    </script><style>

pre.codeinput {
  background: #EEEEEE;
  padding: 10px;
}
@media print {
  pre.codeinput {word-wrap:break-word; width:100%;}
} 

span.keyword {color: #0000FF}
span.comment {color: #228B22}
span.string {color: #9F1EF4}
span.untermstring {color: #B20000}
span.syscmd {color: #B28C00}

pre.codeoutput {
  color: #666666;
  padding: 10px;
}

pre.error {
  color: red;
}

p.footer {
  text-align: right;
  font-size: xx-small;
  font-weight: lighter;
  font-style: italic;
  color: gray;
}

#contents {
  border-style:solid;
  border-width:1px;
}

  </style></head>
   <body LINK="#48339F" VLINK="#48339F" ALINK="#48339F">
      <div class="content">
         <div class="introduction ui-widget ui-widget-content ui-corner-all">
            <h1>Extracting JarKus data from netCDF</h1>
            <div>
               <p>For this example, we will extract data from a Jarkus profile in Egmond aan Zee from the OPeNDAP server, for the year 1999.</p>
            </div>
         </div>
         <div class="accordion">
            <div>
               <h2><a>Locate the data file on the internet</a></h2>
               <div>
                  <p>To locate the netCDF data file, browse to the OPeNDAP website:</p>
               </div>
            </div>
            <div>
               <div>
                  <p><a href="http:\\OPeNDAP.deltares.nl:8080">http:\\OPeNDAP.deltares.nl:8080</a></p>
               </div>
            </div>
            <div>
               <div>
                  <p>Find the Jarkus netCDF file by clicking on the following links: HYRAX ==&gt; Rijkswaterstaat ==&gt; JarKus ==&gt; transects. Click
                     on the link to the file and extract the direct link to the JarKus netCDF data file.
                  </p><pre class="codeinput">url = <span class="string">'http://OPeNDAP .deltares.nl:8080/OPeNDAP/rijkswaterstaat/jarkus/profiles/transect.nc'</span>;
</pre></div>
            </div>
            <div>
               <div>
                  <p>Alternatively, you can use the function jarkus_url. This has the advantage that it returns the link to the netCDF file on
                     the Deltares network if it is available. This is faster than accessing data over the internet.
                  </p><pre class="codeinput">url = jarkus_url
</pre><pre class="codeoutput">
url =

P:\mcdata\opendap\rijkswaterstaat\jarkus\profiles\transect.nc

</pre></div>
            </div>
            <div>
               <h2><a>View metadata</a></h2>
               <div>
                  <p>We can get data from this file using the function nc_varget. But first, let's see what is in the file using nc_dump. nc_dump
                     shows all the metadata in the file. In the case of the JarKus file this is a lot.
                  </p><pre class="codeinput">nc_dump(url)
</pre><pre class="codeoutput">netcdf P:\mcdata\opendap\rijkswaterstaat\jarkus\profiles\transect.nc { 

dimensions:
	time = UNLIMITED ; (44 currently)
	alongshore = 2178 ;
	cross_shore = 1925 ;
	stringsize = 100 ;


variables:
	long id(alongshore), shape = [2178]
		id:long_name = "identifier" 
		id:comment = "sum of area code (x1000000) and alongshore coordinate" 
	long areacode(alongshore), shape = [2178]
		areacode:long_name = "area code" 
...</pre></div>
            </div>
            <div>
               <div>
                  <p>From the metadata we can see that there is a field 'id'. To get this data, use nc_varget.</p><pre class="codeinput">id = nc_varget(url,<span class="string">'id'</span>)
</pre><pre class="codeoutput">
id =

     2000100
     2000101
     2000102
     2000103
     2000104
     2000105
     2000106
     2000120
     2000140
     2000160
     2000180
     2000200
...</pre></div>
            </div>
            <div>
               <h2><a>figure out which part of the data we need</a></h2>
               <div>
                  <p>The transect we are looking for is #3800, in area 7 (Noord-Holland). This transect has id 7003800. We know this from our previous
                     nc_dump
                  </p>
               </div>
            </div>
            <div>
               <div>
                  <p><tt>id:comment = "sum of area code (x1000000) and alongshore coordinate"</tt></p><pre class="codeinput">transect_nr = find(id==7003800)
</pre><pre class="codeoutput">
transect_nr =

        1074

</pre></div>
            </div>
            <div>
               <div>
                  <p>To get only data from this transect, we can give nc_varget some extra arguments. The first optional argument is the start
                     index from where you want to extract data. The second argument indicates the number or entries you want along this dimension.
                     In our case this is 1.
                  </p><pre class="codeinput">id          = nc_varget(url,<span class="string">'id'</span>,transect_nr,1)
</pre><pre class="codeoutput">
id =

     7003825

</pre></div>
            </div>
            <div>
               <div>
                  <p>The returned transect number is one off. This is becasue of zero based indexing of NetCDF files (versus 1 based indexing of
                     MATLAB). This is easily corrected:
                  </p><pre class="codeinput">id          = nc_varget(url,<span class="string">'id'</span>);
transect_nr = find(id==7003800)-1;
id          = nc_varget(url,<span class="string">'id'</span>,transect_nr,1)
</pre><pre class="codeoutput">
id =

     7003800

</pre></div>
            </div>
            <div>
               <div>
                  <p>now that we have the correct transect, we can do the same for the year</p><pre class="codeinput">year        = nc_varget(url,<span class="string">'time'</span>);
year_nr     = find(year == 1966)-1;
year        = nc_varget(url,<span class="string">'time'</span>,year_nr,1)
</pre><pre class="codeoutput">
year =

        1966

</pre></div>
            </div>
            <div>
               <h2><a>Extract the data</a></h2>
               <div>
                  <p>The cross shore coordinate relative to RSP (RijksStrandPalen) is stored in the cross_shore field and the z data in the altitude
                     field. Extracting the xRSP data is simple:
                  </p><pre class="codeinput">xRSP        = nc_varget(url,<span class="string">'cross_shore'</span>);
</pre></div>
            </div>
            <div>
               <div>
                  <p>from the nc_dump we find:</p>
               </div>
            </div>
            <div>
               <div>
                  <p><tt>double altitude(time,alongshore,cross_shore), shape = [44 2178 1925]</tt></p>
               </div>
            </div>
            <div>
               <div>
                  <p>This means that the altitude data is stored in a 3d matrix, which is a function of time, alongshore and cross_shore cordinates.
                     We want data for 1 year, and for 1 alongshore coordinate, but for all cross shore locations. Use -1 in the second argument
                     to ask for all data in that dimension:
                  </p><pre class="codeinput">z           = nc_varget(url,<span class="string">'altitude'</span>,[year_nr,transect_nr,0],[1,1,-1]);
</pre></div>
            </div>
            <div>
               <div>
                  <p>Note that the first z poi9tn we want data form is 0 becasue of the zero besed indexing!</p>
               </div>
            </div>
            <div>
               <div>
                  <p>Not for every possible cross shore location, there is altitude information. For our case we might as well leave out those
                     data points:
                  </p><pre class="codeinput">x    = xRSP(~isnan(z));
z    =    z(~isnan(z));
</pre></div>
            </div>
            <div>
               <h2><a>Plot the data</a></h2>
               <div>
                  <p>always plot data to check if it's ok:</p><pre class="codeinput">plot(x,z,<span class="string">'.b'</span>)
</pre><img vspace="5" hspace="5" src="jarkus_tutorial_reading_data_1_01.png"> </div>
            </div>
         </div>
         <p class="footer"><br>
            Published with MATLAB&reg; 7.8<br></p>
      </div>
      <!--
##### SOURCE BEGIN #####
%% Extracting JarKus data from netCDF
% For this example, we will extract data from a Jarkus profile in Egmond 
% aan Zee from the OPeNDAP server, for the year 1999.

%% Locate the data file on the internet
% To locate the netCDF data file, browse to the OPeNDAP website:
%%
% <http:\\OPeNDAP.deltares.nl:8080> 

%% 
% Find the Jarkus netCDF file by clicking on the following links:
% HYRAX ==> Rijkswaterstaat ==> JarKus ==> transects.
% Click on the link to the file and extract the direct link to the JarKus
% netCDF data file. 

url = 'http://OPeNDAP .deltares.nl:8080/OPeNDAP/rijkswaterstaat/jarkus/profiles/transect.nc';

%%
% Alternatively, you can use the function jarkus_url. This has the
% advantage that it returns the link to the netCDF file on the Deltares
% network if it is available. This is faster than accessing data
% over the internet.

url = jarkus_url

%% View metadata
% We can get data from this file using the function nc_varget. But first, let's see what
% is in the file using nc_dump. nc_dump shows all the metadata in the file.
% In the case of the JarKus file this is a lot.

nc_dump(url)

%% 
% From the metadata we can see that there is a field 'id'. To get this
% data, use nc_varget.

id = nc_varget(url,'id')

%% figure out which part of the data we need
% The transect we are looking for is #3800, in area 7 (Noord-Holland). This
% transect has id 7003800. We know this from our previous nc_dump
%%
% |id:comment = "sum of area code (x1000000) and alongshore coordinate"|

transect_nr = find(id==7003800)

%%
% To get only data from this transect, we can give nc_varget some extra
% arguments. The first optional argument is the start index from where you 
% want to extract data.
% The second argument indicates the number or entries you want along this 
% dimension. In our case this is 1.

id          = nc_varget(url,'id',transect_nr,1)

%%
% The returned transect number is one off. This is becasue of zero based
% indexing of NetCDF files (versus 1 based indexing of MATLAB). This is
% easily corrected:

id          = nc_varget(url,'id');
transect_nr = find(id==7003800)-1;
id          = nc_varget(url,'id',transect_nr,1)

%%
% now that we have the correct transect, we can do the same for the year

year        = nc_varget(url,'time');
year_nr     = find(year == 1966)-1;
year        = nc_varget(url,'time',year_nr,1)

%% Extract the data
% The cross shore coordinate relative to RSP (RijksStrandPalen) is stored 
% in the cross_shore field and the z data in the altitude field.
% Extracting the xRSP data is simple:

xRSP        = nc_varget(url,'cross_shore');

%%
% from the nc_dump we find: 
%%
% |double altitude(time,alongshore,cross_shore), shape = [44 2178 1925]|
%%
% This means that the altitude data is stored in a 3d matrix, which is a
% function of time, alongshore and cross_shore cordinates.
% We want data for 1 year, and for 1 alongshore coordinate, but for all
% cross shore locations. Use -1 in the second argument to ask for all data
% in that dimension:

z           = nc_varget(url,'altitude',[year_nr,transect_nr,0],[1,1,-1]);

%%
% Note that the first z poi9tn we want data form is 0 becasue of the zero
% besed indexing!

%%
% Not for every possible cross shore location, there is altitude
% information. For our case we might as well leave out those data points:

x    = xRSP(~isnan(z));
z    =    z(~isnan(z));

%% Plot the data
% always plot data to check if it's ok:

plot(x,z,'.b')

##### SOURCE END #####
-->
   </body>
</html>