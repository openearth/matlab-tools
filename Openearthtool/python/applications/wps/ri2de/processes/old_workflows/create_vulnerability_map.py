# -*- coding: utf-8 -*-
"""
Created on Wed Oct 17 23:39:41 2018

@author: gaytan_sa
"""
from utils_grid import *
from osgeo import ogr
from osgeo import gdal

#def create_vulnerability_map:
#os.system('gdal_calc -A Land_Cover_Map.tif -B slope.tif -C water.tif -D soil.tif --outfile=vulmapT1.tif --calc="(A+B+C+D)/8"')

#tif1 = "water.tif"
#tif2 = "soil.tif"
#tif3 = "Land_Cover_Map.tif"
#tif4 = "slope.tif"
#maskfile = "roads_mask.tif"
#outfile  = "vulmapT1.tif"
#gridFile = "grid.tif"

def create_vulnerability_map(tif1,tif2,tif3,tif4,gridfile,maskfile,outfile):
    
    # Read watermap
    raster = gdal.Open(maskfile)
    band = raster.GetRasterBand(1)
    mask = band.ReadAsArray()
    mask = np.where(mask ==1,mask,np.nan)

    # Read watermap
    raster = gdal.Open(tif1)
    band = raster.GetRasterBand(1)
    z1 = band.ReadAsArray()
    
    # Read soilmap
    raster = gdal.Open(tif2)
    band = raster.GetRasterBand(1)
    z2 = band.ReadAsArray()
    
    # Read landmap
    raster = gdal.Open(tif3)
    band = raster.GetRasterBand(1)
    z3 = band.ReadAsArray()
    
    # Read slopemap
    raster = gdal.Open(tif4)
    band = raster.GetRasterBand(1)
    z4 = band.ReadAsArray()
    
    z = np.true_divide((z1 + z2 + z3 + z4), 8)
    z = z*mask
    
    WriteArrayToGrid(gridfile, outfile, z)
    
