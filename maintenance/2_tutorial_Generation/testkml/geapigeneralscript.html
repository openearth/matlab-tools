<script src="http://www.google.com/jsapi?key=ABQIAAAA9KO06BPsmsvzw4PogoawhRRj_M5bzK3UrytplimxPwxv-qFuMBR8Z7bi4yvocAHPWFCBjtN5z0WAdg"> </script>
<script type="text/javascript">
   var id;
   var url;
   var lat;
   var lon;
   var altitude;
   var tilt;
   var rotation;
   var ge;
   google.load("earth", "1");

   function initgoogle(obj) {
   	  google.earth.setLanguage('en');
   	  var geapielements = document.getElementsByClassName('geapiusermacro');
   	  for (i=0;i<=geapielements.length-1;i=i+1)
	  {
	    if (obj.getAttribute('isloaded')=="false")
	      {
	        id = obj.getAttribute('id');
	        url = obj.getAttribute('url');
	        lat = parseFloat(obj.getAttribute('lat'));
	        lon = parseFloat(obj.getAttribute('lon'));
	        altitude = parseFloat(obj.getAttribute('altitude'));
	        tilt = parseFloat(obj.getAttribute('tilt'));
	        rotation = parseFloat(obj.getAttribute('rotation'));

	        google.earth.createInstance(id, initCB, failureCB);
	        obj.setAttribute('isloaded','true');
	      }
	  }
   }

   function initCB(instance) {
      ge = instance;
      ge.getWindow().setVisibility(true);
      ge.getNavigationControl().setVisibility(ge.VISIBILITY_SHOW);
      google.earth.fetchKml(ge, url, finished);
   }

   function finished(object) {
      if (!object)
	   {
	     // wrap alerts in API callbacks and event handlers
	     // in a setTimeout to prevent deadlock in some browsers
	  	 setTimeout(function() {alert('Bad or null KML.');}, 0);
	  	 return;
	   }

	  ge.getFeatures().appendChild(object);

	  var lookat = ge.createLookAt('');
	  lookat.set(lon, lat, 0, ge.ALTITUDE_RELATIVE_TO_GROUND, rotation, tilt, altitude);
	  ge.getView().setAbstractView(lookat);
   }


   function failureCB(errorCode)
   {
   }

   //google.setOnLoadCallback(initgoogle);
</script>