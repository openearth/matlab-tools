
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN">
<html xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
      <!--
This HTML is auto-generated from an M-file.
To make changes, update the M-file and republish this document.
      -->
      <title>convertCoordinatesNew</title>
      <meta name="generator" content="MATLAB 7.5">
      <meta name="date" content="2009-06-11">
      <meta name="m-file" content="convertCoordinatesNew"><style>

body {
  background-color: white;
  margin:10px;
}

h1 {
  color: #990000; 
  font-size: x-large;
}

h2 {
  color: #990000;
  font-size: medium;
}

/* Make the text shrink to fit narrow windows, but not stretch too far in 
wide windows. */ 
p,h1,h2,div.content div {
  max-width: 600px;
  /* Hack for IE6 */
  width: auto !important; width: 600px;
}

pre.codeinput {
  background: #EEEEEE;
  padding: 10px;
}
@media print {
  pre.codeinput {word-wrap:break-word; width:100%;}
} 

span.keyword {color: #0000FF}
span.comment {color: #228B22}
span.string {color: #A020F0}
span.untermstring {color: #B20000}
span.syscmd {color: #B28C00}

pre.codeoutput {
  color: #666666;
  padding: 10px;
}

pre.error {
  color: red;
}

p.footer {
  text-align: right;
  font-size: xx-small;
  font-weight: lighter;
  font-style: italic;
  color: gray;
}

  </style></head>
   <body>
      <div class="content">
         <h2>Contents</h2>
         <div>
            <ul>
               <li><a href="#2">get and set keyword value parameters</a></li>
               <li><a href="#3">error check the input, and find the indices of coordinate systems in data structure</a></li>
               <li><a href="#4">find coordinate reference system</a></li>
               <li><a href="#5">find coordinate system</a></li>
               <li><a href="#6">find coordinate system unit of measure</a></li>
               <li><a href="#7">find geographic reference system</a></li>
               <li><a href="#8">find datum</a></li>
               <li><a href="#9">find ellips</a></li>
               <li><a href="#10">find conversion parameters</a></li>
               <li><a href="#11">Get units of measure of in- and output</a></li>
               <li><a href="#12">Transform input coordinates to geographic 2D radians</a></li>
               <li><a href="#13">Datum transformation</a></li>
               <li><a href="#14">Transform geographic 2D radians to output coordinates</a></li>
               <li><a href="#15">EOF</a></li>
            </ul>
         </div><pre class="codeinput"><span class="keyword">function</span> [x2,y2,OPT]=convertCoordinatesNew(x1,y1,STD,varargin)
<span class="comment">%CONVERTCOORDINATES   transformation between coordinate systems</span>
<span class="comment">%</span>
<span class="comment">%    [x2,y2]=convertCoordinates(x1,y1,STD,'keyword','value')</span>
<span class="comment">%</span>
<span class="comment">% where x1,y1 are the values of the coordinates to be transformed.</span>
<span class="comment">%       x2,y2 are the values of the coordinates after transformation.</span>
<span class="comment">%</span>
<span class="comment">% Example: 4 different notations of 1 single case</span>
<span class="comment">%</span>
<span class="comment">%    [x,y]=convertCoordinates(5,52,'STD','CS1.name','WGS 84','CS1.type','geo','CS2.name','WGS 84 / UTM zone 31N','CS2.type','xy')</span>
<span class="comment">%    [x,y]=ConvertCoordinates(5,52,'WGS 84','geo',                  32631,'xy')</span>
<span class="comment">%    [x,y]=ConvertCoordinates(5,52,    4326,'geo','WGS 84 / UTM zone 31N','xy')</span>
<span class="comment">%    [x,y]=ConvertCoordinates(5,52,    4326,'geo',                  32631,'xy')</span>
<span class="comment">%</span>
<span class="comment">% Note: (x1,y1) can be vectors or matrices (vectorized).</span>
<span class="comment">%</span>
<span class="comment">%See also: SuperTrans = GetCoordinateSystems &gt; SelectCoordinateSystem &gt; ConvertCoordinates</span>

<span class="comment">%load('CoordinateSystems.mat');</span>
<span class="comment">%load('Operations.mat');</span>
<span class="comment">%[x,y]=ConvertCoordinates(5,52,'WGS 84','geo','WGS 84 / UTM zone</span>
<span class="comment">%31N','xy',CoordinateSystems,Operations)</span>
</pre><h2>get and set keyword value parameters<a name="2"></a></h2><pre class="codeinput">OPT.CS1.name                   = []; <span class="comment">% coordinate system name</span>
OPT.CS1.code                   = []; <span class="comment">% coordinate system reference code</span>
OPT.CS1.type                   = []; <span class="comment">% projection type</span>
                                     <span class="comment">% projection types supported:</span>
                                     <span class="comment">% projected, geographic 2D</span>
                                     <span class="comment">%</span>
                                     <span class="comment">% projection not (yet) supported:</span>
                                     <span class="comment">% engineering, geographic 3D, vertical, geocentric,  compound</span>
                                     <span class="comment">%</span>
                                     <span class="comment">% allowed synonyms for 'projected'</span>
                                     <span class="comment">% 'xy','proj','cartesian','cart'</span>
                                     <span class="comment">% allowed sysnonyms for 'geographic 2D'</span>
                                     <span class="comment">% 'geo','geographic2d','latlon','lat lon','geographic'</span>
                                     <span class="comment">%</span>
OPT.CS1.geoRefSys.name         = []; <span class="comment">% associated geographic reference system name</span>
OPT.CS1.geoRefSys.code         = []; <span class="comment">% associated geographic reference system code</span>
OPT.CS1.coordSys.name          = []; <span class="comment">%</span>
OPT.CS1.coordSys.code          = []; <span class="comment">%</span>
                                     <span class="comment">%</span>
OPT.CS1.ellips.name            = []; <span class="comment">% ellipsoide name</span>
OPT.CS1.ellips.code            = []; <span class="comment">% ellipsoide code</span>
OPT.CS1.ellips.inv_flattening  = []; <span class="comment">% inverse flattening</span>
OPT.CS1.ellips.semi_major_axis = []; <span class="comment">% semi major axis</span>
OPT.CS1.ellips.semi_minor_axis = []; <span class="comment">% semi minor axis</span>
                                     <span class="comment">%</span>
OPT.CS1.UoM.name               = []; <span class="comment">% unit of measure name of coordinates</span>
OPT.CS1.UoM.code               = []; <span class="comment">% unit of measure code of coordinates</span>
                                     <span class="comment">%</span>
OPT.CS1.conv.name              = []; <span class="comment">% projection to datum conversion name</span>
OPT.CS1.conv.code              = []; <span class="comment">% projection to datum conversion code</span>
OPT.CS1.conv.param.val         = []; <span class="comment">% conversion paramter values</span>
OPT.CS1.conv.param.code        = []; <span class="comment">% conversion paramter codes</span>
OPT.CS1.conv.param.name        = []; <span class="comment">% conversion paramter names</span>

OPT.CS2.name                   = [];
OPT.CS2.code                   = [];
OPT.CS2.type                   = [];
OPT.CS2.geoRefSys.name         = [];
OPT.CS2.geoRefSys.code         = [];
OPT.CS2.coordSys.name          = [];
OPT.CS2.coordSys.code          = [];
OPT.CS2.ellips.name            = [];
OPT.CS2.ellips.code            = [];
OPT.CS2.ellips.inv_flattening  = [];
OPT.CS2.ellips.semi_major_axis = [];
OPT.CS2.ellips.semi_minor_axis = [];
OPT.CS2.UoM.name               = [];
OPT.CS2.UoM.code               = [];
OPT.CS2.conv.name              = [];
OPT.CS2.conv.code              = [];
OPT.CS2.conv.param.val         = [];
OPT.CS2.conv.param.code        = [];
OPT.CS2.conv.param.name        = [];


[OPT, Set, Default]     = setPropertyInDeeperStruct(OPT, varargin{:});
</pre><h2>error check the input, and find the indices of coordinate systems in data structure<a name="3"></a></h2>
         <p>replace synonyms with default names. e.g. replace 'geo' with 'geographic 2D' reference system</p><pre class="codeinput">OPT.CS1 = ConvertCoordinatesCheckInput(OPT.CS1,STD);
OPT.CS2 = ConvertCoordinatesCheckInput(OPT.CS2,STD);
</pre><h2>find coordinate reference system<a name="4"></a></h2><pre class="codeinput">OPT.CS1 = ConvertCoordinatesFindCoordRefSys(OPT.CS1,STD);
OPT.CS2 = ConvertCoordinatesFindCoordRefSys(OPT.CS2,STD);
</pre><h2>find coordinate system<a name="5"></a></h2><pre class="codeinput">OPT.CS1 = ConvertCoordinatesFindCoordSys(OPT.CS1,STD);
OPT.CS2 = ConvertCoordinatesFindCoordSys(OPT.CS2,STD);
</pre><h2>find coordinate system unit of measure<a name="6"></a></h2><pre class="codeinput">OPT.CS1 = ConvertCoordinatesFindUoM(OPT.CS1,STD);
OPT.CS2 = ConvertCoordinatesFindUoM(OPT.CS2,STD);
</pre><h2>find geographic reference system<a name="7"></a></h2><pre class="codeinput">OPT.CS1 = ConvertCoordinatesFindGeoRefSys(OPT.CS1,STD);
OPT.CS2 = ConvertCoordinatesFindGeoRefSys(OPT.CS2,STD);
</pre><h2>find datum<a name="8"></a></h2><pre class="codeinput">OPT.CS1 = ConvertCoordinatesFindDatum(OPT.CS1,STD);
OPT.CS2 = ConvertCoordinatesFindDatum(OPT.CS2,STD);
</pre><h2>find ellips<a name="9"></a></h2><pre class="codeinput">OPT.CS1 = ConvertCoordinatesFindEllips(OPT.CS1,STD);
OPT.CS2 = ConvertCoordinatesFindEllips(OPT.CS2,STD);
</pre><h2>find conversion parameters<a name="10"></a></h2><pre class="codeinput"><span class="keyword">switch</span> OPT.CS1.type
    <span class="keyword">case</span> <span class="string">'projected'</span> <span class="comment">% Coordinate conversion to radians</span>
        OPT.CS1 = ConvertCoordinatesFindConversionParams(OPT.CS1,STD);
    <span class="keyword">case</span> <span class="string">'geographic 2D'</span> <span class="comment">% do nothing</span>
<span class="keyword">end</span>
<span class="keyword">switch</span> OPT.CS2.type
    <span class="keyword">case</span> <span class="string">'projected'</span> <span class="comment">% Coordinate conversion to radians</span>
        OPT.CS2 = ConvertCoordinatesFindConversionParams(OPT.CS2,STD);
    <span class="keyword">case</span> <span class="string">'geographic 2D'</span> <span class="comment">% do nothing</span>
<span class="keyword">end</span>
</pre><h2>Get units of measure of in- and output<a name="11"></a></h2>
         <p>extract coordinate system UoM name from the used coordinate system, unless there is a userdefined unit of mease code or name</p>
         <h2>Transform input coordinates to geographic 2D radians<a name="12"></a></h2><pre class="codeinput"><span class="keyword">switch</span> OPT.CS1.type
    <span class="keyword">case</span> <span class="string">'projected'</span> <span class="comment">% convert projection to geographic radians</span>
        x1 = convertUnits(x1,OPT.CS1.UoM.name,<span class="string">'metre'</span>,STD);
        y1 = convertUnits(y1,OPT.CS1.UoM.name,<span class="string">'metre'</span>,STD);
        [x1,y1] = ConvertCoordinatesProjectionConvert(x1,y1,OPT.CS1,<span class="string">'xy2geo'</span>,STD);
    <span class="keyword">case</span> <span class="string">'geographic 2D'</span> <span class="comment">% do nothing</span>
        x1 = convertUnits(x1,OPT.CS1.UoM.name,<span class="string">'radian'</span>,STD);
        y1 = convertUnits(y1,OPT.CS1.UoM.name,<span class="string">'radian'</span>,STD);
<span class="keyword">end</span>
</pre><h2>Datum transformation<a name="13"></a></h2>
         <p>check if geogcrs_code1 and geogcrs_code2 are different</p>
         <p>check if there is a direct transormation between geogcrs_code1 and geogcrs_code2;</p>
         <div>
            <ul>
               <li>if multiple options found, use the newest unless user has defined something else</li>
               <li>if no direct transformation exists, convert via WGS 84</li>
            </ul>
         </div><pre class="codeinput">OPT = ConvertCoordinatesFindDatumTransOpt(OPT,STD);
<span class="keyword">if</span> strcmp(<span class="string">'no datum transformation needed'</span>,OPT.datum_trans1)
 x2 = x1;
 y2 = y1;
<span class="keyword">else</span>
    [x2,y2] = ConvertCoordinatesDatumTransform(x1,y1,OPT.datum_trans1);
    <span class="keyword">if</span> isfield(OPT,<span class="string">'datum_trans2'</span>)
    [x2,y2] = ConvertCoordinatesDatumTransform(x2,y2,OPT.datum_trans2);
    <span class="keyword">end</span>
<span class="keyword">end</span>
</pre><h2>Transform geographic 2D radians to output coordinates<a name="14"></a></h2><pre class="codeinput"><span class="keyword">switch</span> OPT.CS2.type
    <span class="keyword">case</span> <span class="string">'projected'</span> <span class="comment">% convert projection to geographic radians</span>
        [x2,y2] = ConvertCoordinatesProjectionConvert(x1,y1,OPT.CS2,<span class="string">'geo2xy'</span>,STD);
        x2 = convertUnits(x2,OPT.CS2.UoM.name,<span class="string">'metre'</span>,STD);
        y2 = convertUnits(y2,OPT.CS2.UoM.name,<span class="string">'metre'</span>,STD);
    <span class="keyword">case</span> <span class="string">'geographic 2D'</span> <span class="comment">% do nothing</span>
        x2 = convertUnits(x2,<span class="string">'radian'</span>,OPT.CS2.UoM.name,STD);
        y2 = convertUnits(y2,<span class="string">'radian'</span>,OPT.CS2.UoM.name,STD);
<span class="keyword">end</span>
</pre><h2>EOF<a name="15"></a></h2><pre class="codeinput"><span class="keyword">end</span>
</pre><p class="footer"><br>
            Published with MATLAB&reg; 7.5<br></p>
      </div>
      <!--
##### SOURCE BEGIN #####
function [x2,y2,OPT]=convertCoordinatesNew(x1,y1,STD,varargin)
%CONVERTCOORDINATES   transformation between coordinate systems
%
%    [x2,y2]=convertCoordinates(x1,y1,STD,'keyword','value')
%
% where x1,y1 are the values of the coordinates to be transformed.
%       x2,y2 are the values of the coordinates after transformation.
%
% Example: 4 different notations of 1 single case
%
%    [x,y]=convertCoordinates(5,52,'STD','CS1.name','WGS 84','CS1.type','geo','CS2.name','WGS 84 / UTM zone 31N','CS2.type','xy')
%    [x,y]=ConvertCoordinates(5,52,'WGS 84','geo',                  32631,'xy')
%    [x,y]=ConvertCoordinates(5,52,    4326,'geo','WGS 84 / UTM zone 31N','xy')
%    [x,y]=ConvertCoordinates(5,52,    4326,'geo',                  32631,'xy')
%
% Note: (x1,y1) can be vectors or matrices (vectorized).
%
%See also: SuperTrans = GetCoordinateSystems > SelectCoordinateSystem > ConvertCoordinates

%load('CoordinateSystems.mat');
%load('Operations.mat');
%[x,y]=ConvertCoordinates(5,52,'WGS 84','geo','WGS 84 / UTM zone
%31N','xy',CoordinateSystems,Operations)

%% get and set keyword value parameters

OPT.CS1.name                   = []; % coordinate system name
OPT.CS1.code                   = []; % coordinate system reference code 
OPT.CS1.type                   = []; % projection type
                                     % projection types supported:
                                     % projected, geographic 2D
                                     %
                                     % projection not (yet) supported:
                                     % engineering, geographic 3D, vertical, geocentric,  compound
                                     %
                                     % allowed synonyms for 'projected'
                                     % 'xy','proj','cartesian','cart'
                                     % allowed sysnonyms for 'geographic 2D'
                                     % 'geo','geographic2d','latlon','lat lon','geographic'
                                     %
OPT.CS1.geoRefSys.name         = []; % associated geographic reference system name
OPT.CS1.geoRefSys.code         = []; % associated geographic reference system code
OPT.CS1.coordSys.name          = []; %
OPT.CS1.coordSys.code          = []; %
                                     %
OPT.CS1.ellips.name            = []; % ellipsoide name
OPT.CS1.ellips.code            = []; % ellipsoide code
OPT.CS1.ellips.inv_flattening  = []; % inverse flattening
OPT.CS1.ellips.semi_major_axis = []; % semi major axis
OPT.CS1.ellips.semi_minor_axis = []; % semi minor axis
                                     %
OPT.CS1.UoM.name               = []; % unit of measure name of coordinates
OPT.CS1.UoM.code               = []; % unit of measure code of coordinates
                                     %
OPT.CS1.conv.name              = []; % projection to datum conversion name
OPT.CS1.conv.code              = []; % projection to datum conversion code
OPT.CS1.conv.param.val         = []; % conversion paramter values
OPT.CS1.conv.param.code        = []; % conversion paramter codes
OPT.CS1.conv.param.name        = []; % conversion paramter names

OPT.CS2.name                   = []; 
OPT.CS2.code                   = []; 
OPT.CS2.type                   = []; 
OPT.CS2.geoRefSys.name         = []; 
OPT.CS2.geoRefSys.code         = []; 
OPT.CS2.coordSys.name          = []; 
OPT.CS2.coordSys.code          = []; 
OPT.CS2.ellips.name            = []; 
OPT.CS2.ellips.code            = []; 
OPT.CS2.ellips.inv_flattening  = []; 
OPT.CS2.ellips.semi_major_axis = []; 
OPT.CS2.ellips.semi_minor_axis = []; 
OPT.CS2.UoM.name               = []; 
OPT.CS2.UoM.code               = []; 
OPT.CS2.conv.name              = []; 
OPT.CS2.conv.code              = []; 
OPT.CS2.conv.param.val         = []; 
OPT.CS2.conv.param.code        = []; 
OPT.CS2.conv.param.name        = []; 


[OPT, Set, Default]     = setPropertyInDeeperStruct(OPT, varargin{:});
%% error check the input, and find the indices of coordinate systems in data structure 
% replace synonyms with default names. e.g. replace 'geo' with 'geographic 2D'
% reference system
OPT.CS1 = ConvertCoordinatesCheckInput(OPT.CS1,STD);
OPT.CS2 = ConvertCoordinatesCheckInput(OPT.CS2,STD);
%% find coordinate reference system
OPT.CS1 = ConvertCoordinatesFindCoordRefSys(OPT.CS1,STD);
OPT.CS2 = ConvertCoordinatesFindCoordRefSys(OPT.CS2,STD);
%% find coordinate system
OPT.CS1 = ConvertCoordinatesFindCoordSys(OPT.CS1,STD);
OPT.CS2 = ConvertCoordinatesFindCoordSys(OPT.CS2,STD);
%% find coordinate system unit of measure
OPT.CS1 = ConvertCoordinatesFindUoM(OPT.CS1,STD);
OPT.CS2 = ConvertCoordinatesFindUoM(OPT.CS2,STD);
%% find geographic reference system
OPT.CS1 = ConvertCoordinatesFindGeoRefSys(OPT.CS1,STD);
OPT.CS2 = ConvertCoordinatesFindGeoRefSys(OPT.CS2,STD);
%% find datum
OPT.CS1 = ConvertCoordinatesFindDatum(OPT.CS1,STD);
OPT.CS2 = ConvertCoordinatesFindDatum(OPT.CS2,STD);
%% find ellips
OPT.CS1 = ConvertCoordinatesFindEllips(OPT.CS1,STD);
OPT.CS2 = ConvertCoordinatesFindEllips(OPT.CS2,STD);
%% find conversion parameters
switch OPT.CS1.type
    case 'projected' % Coordinate conversion to radians
        OPT.CS1 = ConvertCoordinatesFindConversionParams(OPT.CS1,STD);
    case 'geographic 2D' % do nothing
end
switch OPT.CS2.type
    case 'projected' % Coordinate conversion to radians
        OPT.CS2 = ConvertCoordinatesFindConversionParams(OPT.CS2,STD);
    case 'geographic 2D' % do nothing
end
%% Get units of measure of in- and output
% extract coordinate system UoM name from the used coordinate system, 
% unless there is a userdefined unit of mease code or name

%% Transform input coordinates to geographic 2D radians
switch OPT.CS1.type
    case 'projected' % convert projection to geographic radians
        x1 = convertUnits(x1,OPT.CS1.UoM.name,'metre',STD);
        y1 = convertUnits(y1,OPT.CS1.UoM.name,'metre',STD);
        [x1,y1] = ConvertCoordinatesProjectionConvert(x1,y1,OPT.CS1,'xy2geo',STD);
    case 'geographic 2D' % do nothing
        x1 = convertUnits(x1,OPT.CS1.UoM.name,'radian',STD);
        y1 = convertUnits(y1,OPT.CS1.UoM.name,'radian',STD);
end

%% Datum transformation
% check if geogcrs_code1 and geogcrs_code2 are different
%
% check if there is a direct transormation between geogcrs_code1 and
% geogcrs_code2; 
% 
% * if multiple options found, use the newest unless user has defined something else
% * if no direct transformation exists, convert via WGS 84
OPT = ConvertCoordinatesFindDatumTransOpt(OPT,STD);
if strcmp('no datum transformation needed',OPT.datum_trans1)
 x2 = x1;
 y2 = y1;
else
    [x2,y2] = ConvertCoordinatesDatumTransform(x1,y1,OPT.datum_trans1);
    if isfield(OPT,'datum_trans2')
    [x2,y2] = ConvertCoordinatesDatumTransform(x2,y2,OPT.datum_trans2);
    end
end
   

%% Transform geographic 2D radians to output coordinates 
switch OPT.CS2.type
    case 'projected' % convert projection to geographic radians
        [x2,y2] = ConvertCoordinatesProjectionConvert(x1,y1,OPT.CS2,'geo2xy',STD);
        x2 = convertUnits(x2,OPT.CS2.UoM.name,'metre',STD);
        y2 = convertUnits(y2,OPT.CS2.UoM.name,'metre',STD);
    case 'geographic 2D' % do nothing
        x2 = convertUnits(x2,'radian',OPT.CS2.UoM.name,STD);
        y2 = convertUnits(y2,'radian',OPT.CS2.UoM.name,STD);
end
%% EOF
end
##### SOURCE END #####
-->
   </body>
</html>