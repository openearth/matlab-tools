function D = t_tide_read(fname)
%t_tide_read   load ascii 'output' file as generated by t_tide
%
% D = t_tide_read(filename)
%
%See also: t_tide, textscan

%   --------------------------------------------------------------------
%   Copyright (C) 2010 Deltares
%       Gerben J. de Boer
%
%       gerben.deboer@deltares.nl	
%
%       Deltares
%       P.O. Box 177
%       2600 MH Delft
%       The Netherlands
%
%   This library is free software: you can redistribute it and/or
%   modify it under the terms of the GNU Lesser General Public
%   License as published by the Free Software Foundation, either
%   version 2.1 of the License, or (at your option) any later version.
%
%   This library is distributed in the hope that it will be useful,
%   but WITHOUT ANY WARRANTY; without even the implied warranty of
%   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
%   Lesser General Public License for more details.
%
%   You should have received a copy of the GNU Lesser General Public
%   License along with this library. If not, see <http://www.gnu.org/licenses/>.
%   --------------------------------------------------------------------

% This tool is part of <a href="http://OpenEarth.nl">OpenEarthTools</a>.
% OpenEarthTools is an online collaboration to share and manage data and 
% programming tools in an open source, version controlled environment.
% Sign up to recieve regular updates of this function, and to contribute 
% your own tools.

%% Version <http://svnbook.red-bean.com/en/1.5/svn.advanced.props.special.keywords.html>
% $Id$
% $HeadURL$
% $Keywords: $

      fid     = fopen(fname,'r');
      
%% meta

      tmp     = dir(fname);
      D.name  = tmp.name;
      D.date  = tmp.date;
      D.bytes = tmp.bytes;

%% header
      
      for ii=1:16
         D.header{ii} = fgetl(fid);   
      end
  
      %-------------
      %
      %    file name: fname
      %    date: 01-Dec-2010
      %    nobs = 26281,  ngood = 26281,  record length (days) = 182.51
      %    start time: 01-Jan-1998
      %    rayleigh criterion = 1.0
      %    Greenwich phase computed with nodal corrections applied to amplitude \n and phase relative to center time
      %    
      %    x0= 5.97, x trend= 0
      %    
      %    var(x)= 3169321519.5862   var(xp)= 3053240866.7394   var(xres)= 115904582.427
      %    percent var predicted/var original= 96.3 %
      %    
      %         tidal amplitude and phase with 95% CI estimates
      %    
      %    tide   freq       amp     amp_err    pha    pha_err     snr
      % MM   0.0015122    0.0000  000.000   000.00   000.00        0
      % ...  
      % M8   0.3220456    0.0000  000.000   000.00   000.00        0
      %-------------
   
%% data

      C = textscan(fid,'%s%f%f%f%f%f%f');
        
      fclose(fid);
   
      D.component_name  = char(C{1});
     %D.significance    = cellfun(@(x) strcmp(x(1),'*'),D.component_name);
      D.significance    = D.component_name(:,1)=='*';
      D.component_name(D.significance,1) = ' ';
      D.component_name  = char(strtrim(cellstr(D.component_name)));
      
      D.frequency       = C{2};
      D.amplitude       = C{3};
      D.amplitude_error = C{4};
      D.phase           = C{5};
      D.phase_error     = C{6};
      D.snr             = C{7};
