<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>WAFO. Description of spec2cov2</title>
  <meta name="keywords" content="spec2cov2">
  <meta name="description" content=" Computes covariance function and its derivatives, alternative version">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="../index.html">wafo</a> &gt; <a href="index.html">spec</a> &gt; spec2cov2.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for wafo\spec&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>spec2cov2
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong> Computes covariance function and its derivatives, alternative version</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong> R = spec2cov2(S,nr,Nt,dt) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> <a href="spec2cov2.html" class="code" title=" Computes covariance function and its derivatives, alternative version ">SPEC2COV2</a> Computes covariance function and its derivatives, alternative version 
   
     CALL:  R = <a href="spec2cov2.html" class="code" title=" Computes covariance function and its derivatives, alternative version ">spec2cov2</a>(S,nr,Nt,dt); 
   
   R    = [R0, R1,...Rnr] matrix with autocovariance and its 
           derivatives, i.e., Ri (i=1:nr) are column vectors with 
           the 1'st to nr'th derivatives of R0.  size Nt+1 x Nr+1 
   S    = a spectral density structure (See <a href="../../wafo/docs/datastructures.html" class="code" title=" of spectrum, covariance function and density (pdf) in WAFO">datastructures</a>) 
   Nr   = number of derivatives in output, Nr&lt;=4          (default 0) 
   Nt   = number in time grid, i.e., number of time-lags.  
          (default rate*(n-1)) where rate = round(1/(2*f(end)*dt)) or  
           rate = round(pi/(w(n)*dt)) depending on S. 
   dt   = time spacing for R 
    
    NB! This routine requires that the spectrum grid is equidistant 
        starting from zero frequency. 
    Example:     
       S = <a href="jonswap.html" class="code" title=" Calculates (and plots) a JONSWAP spectral density">jonswap</a>; 
       dt = 0.1;   
       R = <a href="spec2cov2.html" class="code" title=" Computes covariance function and its derivatives, alternative version ">spec2cov2</a>(S,3,256,dt); 
  
  See also  <a href="spec2cov.html" class="code" title=" Computes covariance function and its derivatives  ">spec2cov</a>, <a href="specinterp.html" class="code" title=" Interpolation and zero-padding of spectrum">specinterp</a>, <a href="../../wafo/docs/datastructures.html" class="code" title=" of spectrum, covariance function and density (pdf) in WAFO">datastructures</a></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<TABLE BORDER=0>

<TR>
<TD><li><a href="freqtype.html" class="code" title=" ftype=freqtype(S)">freqtype</a></li></TD>
<TD> returns the frequency type of a Spectral density struct.</TD>
</TR>
<TR>
<TD><li><a href="spec2cov.html" class="code" title=" R = spec2cov(S,nr,Nt,rate,Nx,Ny,dx,dy)">spec2cov</a></li></TD>
<TD> Computes covariance function and its derivatives</TD>
</TR>
<TR>
<TD><li><a href="specinterp.html" class="code" title=" Snew = specinterp(S,dt)">specinterp</a></li></TD>
<TD> Interpolation and zero-padding of spectrum</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\datafun\@int16\diff.bi">diff</a></li></TD>
<TD>          Difference and approximate derivative.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\lang\error.m">error</a></li></TD>
<TD>         Display message and abort function.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\datatypes\getfield.m">getfield</a></li></TD>
<TD>      Get structure field contents.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\datatypes\isstruct.m">isstruct</a></li></TD>
<TD>      True for structures.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\strfun\sprintf.m">sprintf</a></li></TD>
<TD>       Write formatted data to string.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\strfun\@char\strcmpi.bi">strcmpi</a></li></TD>
<TD>       Compare strings ignoring case.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\lang\warning.m">warning</a></li></TD>
<TD>       Display warning message; disable or enable warning messages.</TD>
</TR>
</TABLE>
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<TABLE BORDER=0>

<TR>
<TD><li><a href="../../wafo/trgauss/spec2AcAt.html" class="code" title=" [f] = spec2AcAt(spec,utc,def,paramtc,paramtt,paramt,h1,h2,nit,speed,bound)">spec2AcAt</a></li></TD>
<TD>   Evaluates survival function R(h1,h2)=P(Ac>h1,At>h2).</TD>
</TR>
<TR>
<TD><li><a href="../../wafo/trgauss/spec2Acdf.html" class="code" title=" [f] = spec2Acdf(spec,utc,def,paramt,h,nit,speed,bound)">spec2Acdf</a></li></TD>
<TD>  Evaluates cdf of crests P(Ac<=h) or troughs P(At<=h).</TD>
</TR>
<TR>
<TD><li><a href="../../wafo/trgauss/spec2mmtpdf.html" class="code" title=" f = spec2mmtpdf(spec,utc,def,paramt,paramu,options,bound)">spec2mmtpdf</a></li></TD>
<TD> Calculates joint density of Maximum, minimum and period.</TD>
</TR>
<TR>
<TD><li><a href="../../wafo/trgauss/spec2tccpdf.html" class="code" title=" [f] = spec2tccpdf(spec,utc,def,paramt,h1,h2,nit,speed,bound,plotflag)">spec2tccpdf</a></li></TD>
<TD> Evaluates densities of wave period Tcc, wave lenght Lcc.</TD>
</TR>
<TR>
<TD><li><a href="../../wafo/trgauss/spec2thpdf.html" class="code" title=" f = spec2thpdf(spec,utc,def,paramt,h,options,plotflag)">spec2thpdf</a></li></TD>
<TD> Joint density of amplitude and period/wave-length characteristics</TD>
</TR>
<TR>
<TD><li><a href="../../wafo/trgauss/spec2tpdf.html" class="code" title=" [f] = spec2tpdf(spec,utc,def,paramt,h,nit,speed,bound,plotflag)">spec2tpdf</a></li></TD>
<TD> Evaluates densities for crest-,trough-period, length.</TD>
</TR>
<TR>
<TD><li><a href="../../wafo/trgauss/spec2tpdf2.html" class="code" title=" [f] = spec2tpdf2(spec,utc,def,paramt,varargin)">spec2tpdf2</a></li></TD>
<TD> Evaluates densities for various wave periods or wave lengths</TD>
</TR>
<TR>
<TD><li><a href="../../wafo/trgauss/private/wminmax.html" class="code" title=" [f_mM, paramu] = wminmax(spec,nit,paramu,t)">wminmax</a></li></TD>
<TD> Calculates joint density of minimum and following maximum</TD>
</TR>
</TABLE>

</ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>001 <span class="keyword">function</span> R = <a name="_sub0" href="#_subfunctions" class="code">spec2cov2</a>(S,nr,Nt,dt) 
002 <span class="comment">%SPEC2COV2 Computes covariance function and its derivatives, alternative version </span>
003 <span class="comment">%  </span>
004 <span class="comment">%    CALL:  R = spec2cov2(S,nr,Nt,dt); </span>
005 <span class="comment">%  </span>
006 <span class="comment">%  R    = [R0, R1,...Rnr] matrix with autocovariance and its </span>
007 <span class="comment">%          derivatives, i.e., Ri (i=1:nr) are column vectors with </span>
008 <span class="comment">%          the 1'st to nr'th derivatives of R0.  size Nt+1 x Nr+1 </span>
009 <span class="comment">%  S    = a spectral density structure (See datastructures) </span>
010 <span class="comment">%  Nr   = number of derivatives in output, Nr&lt;=4          (default 0) </span>
011 <span class="comment">%  Nt   = number in time grid, i.e., number of time-lags.  </span>
012 <span class="comment">%         (default rate*(n-1)) where rate = round(1/(2*f(end)*dt)) or  </span>
013 <span class="comment">%          rate = round(pi/(w(n)*dt)) depending on S. </span>
014 <span class="comment">%  dt   = time spacing for R </span>
015 <span class="comment">%   </span>
016 <span class="comment">%   NB! This routine requires that the spectrum grid is equidistant </span>
017 <span class="comment">%       starting from zero frequency. </span>
018 <span class="comment">%   Example:     </span>
019 <span class="comment">%      S = jonswap; </span>
020 <span class="comment">%      dt = 0.1;   </span>
021 <span class="comment">%      R = spec2cov2(S,3,256,dt); </span>
022 <span class="comment">% </span>
023 <span class="comment">% See also  spec2cov, specinterp, datastructures   </span>
024    
025 <span class="comment">% History </span>
026 <span class="comment">% revised pab Sept 2005 </span>
027 <span class="comment">%  - rate is sometimes zero -&gt; spec2cov2 crash: made an ad-hoc solution. </span>
028 <span class="comment">% by pab 24.11.2003 </span>
029 <span class="comment">% based on code from spec2XXpdf programmes </span>
030    
031 error(nargchk(1,4,nargin)) 
032 <span class="keyword">if</span> ~isstruct(S) 
033   error(<span class="string">'Incorrect input spectrum, see help datastructures'</span>) 
034 <span class="keyword">end</span> 
035    
036 <span class="keyword">if</span> nargin&lt;2|isempty(nr) 
037   nr=0; <span class="comment">% number of derivatives </span>
038 <span class="keyword">end</span> 
039 ftype = <a href="freqtype.html" class="code" title=" returns the frequency type of a Spectral density struct.">freqtype</a>(S); <span class="comment">%options are 'f' and 'w' and 'k' </span>
040 freq  = getfield(S,ftype); 
041 n     = length(freq); 
042  
043 <span class="keyword">if</span> nargin&lt;4|isempty(dt), 
044   <span class="keyword">if</span> strcmpi(ftype,<span class="string">'f'</span>) 
045     dt=1/(2*freq(n)); <span class="comment">% sampling interval=1/Fs </span>
046   <span class="keyword">else</span> 
047     dt=pi/(freq(n)); 
048   <span class="keyword">end</span> 
049 <span class="keyword">end</span> 
050 <span class="keyword">if</span> strcmpi(ftype,<span class="string">'f'</span>) 
051   rate = round(1/(2*freq(n)*dt)); <span class="comment">% sampling interval=1/Fs </span>
052 <span class="keyword">else</span> 
053   rate = round(pi/(freq(n)*dt)); 
054 <span class="keyword">end</span> 
055 <span class="comment">% TODO <span class="comment">% rate sometimes is zero -&gt; spec2cov2 sometimes crash </span></span>
056 rate = max(rate,1); 
057  
058 <span class="keyword">if</span> nargin&lt;3|isempty(Nt), 
059   Nt = rate*(n-1); 
060 <span class="keyword">else</span> <span class="comment">%check if Nt is ok </span>
061   Nt = min(Nt,rate*(n-1)); 
062 <span class="keyword">end</span> 
063  
064 checkdt = 1.2*min(diff(freq))/2/pi; 
065 <span class="keyword">switch</span> ftype 
066  <span class="keyword">case</span> {<span class="string">'w'</span>}, 
067   vari = <span class="string">'t'</span>;  
068  <span class="keyword">case</span> {<span class="string">'f'</span>},  
069   vari    = <span class="string">'t'</span>;  
070   checkdt = checkdt*2*pi; 
071  <span class="keyword">case</span> {<span class="string">'k'</span>}, 
072   vari = <span class="string">'x'</span>; 
073 <span class="keyword">end</span> 
074 msg1 = sprintf([<span class="string">'The step dt = %g in computation of the density is too'</span> <span class="keyword">...</span> 
075         <span class="string">' small.'</span>],dt); 
076 msg2 = sprintf([<span class="string">'The step dt = %g step is small, may cause numerical'</span> <span class="keyword">...</span> 
077         <span class="string">' inaccuracies.'</span>],dt); 
078  
079 <span class="keyword">if</span> (checkdt &lt; 2^-16/dt) 
080   disp(msg1) 
081   disp(<span class="string">'The computed covariance (by FFT(2^K)) may differ from the theoretical.'</span>) 
082   disp(<span class="string">'Solution:'</span>) 
083   error(<span class="string">'use larger dt or sparser grid for spectrum.'</span>) 
084 <span class="keyword">end</span> 
085  
086 <span class="comment">% Calculating covariances </span>
087 <span class="comment">%~~~~~~~~~~~~~~~~~~~~~~~~ </span>
088 S2 = <a href="specinterp.html" class="code" title=" Interpolation and zero-padding of spectrum">specinterp</a>(S,dt); 
089 R2 = <a href="spec2cov.html" class="code" title=" Computes covariance function and its derivatives  ">spec2cov</a>(S2,nr,Nt,1,0,0); 
090 R  = zeros(Nt+1,nr+1); 
091 fieldname = [<span class="string">'R'</span>  vari(ones(1,nr))]; 
092 idx = {1:Nt+1}; 
093 <span class="keyword">for</span> ix = 1:nr+1 
094   R(:,ix) = getfield(R2,fieldname(1:ix),idx); 
095 <span class="keyword">end</span> 
096  
097 EPS0 = 0.0001; 
098 cc  = R(1,1)-R(2,1)*(R(2,1)/R(1,1)); 
099 <span class="keyword">if</span> Nt+1&gt;=5 
100   <span class="comment">%cc1=R(1,1)-R(3,1)*(R(3,1)/R(1,1))+R(3,2)*(R(3,2)/R(1,3)); </span>
101   <span class="comment">%cc3=R(1,1)-R(5,1)*(R(5,1)/R(1,1))+R(5,2)*(R(5,2)/R(1,3)); </span>
102    
103   cc2 = R(1,1)-R(5,1)*(R(5,1)/R(1,1)); 
104   <span class="keyword">if</span> (cc2&lt;EPS0) 
105     warning(msg1) 
106   <span class="keyword">end</span> 
107 <span class="keyword">end</span> 
108 <span class="keyword">if</span> (cc&lt;EPS0) 
109   disp(msg2) 
110 <span class="keyword">end</span> 
111 <span class="keyword">return</span></pre></div>
<HR noShade>
<SMALL><A href="http://www.maths.lth.se/matstat/">Mathematical 
Statistics</A><BR><A href="http://www.maths.lth.se/">Centre for Mathematical 
Sciences</A><BR><A href="http://www.lu.se/">Lund University</A> with <A 
href="http://www.lth.se/">Lund Institute of Technology</A> </SMALL>
<P><SMALL>Comments or corrections to the <A
href="mailto:wafo@maths.lth.se">WAFO group</A>  </P>

<hr><address>Generated on Thu 06-Oct-2005 02:21:16
 for <strong><A href="http://www.maths.lth.se/matstat/wafo/">WAFO</A></strong>
 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>