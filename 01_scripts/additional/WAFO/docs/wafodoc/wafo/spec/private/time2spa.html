<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>WAFO. Description of time2spa</title>
  <meta name="keywords" content="time2spa">
  <meta name="description" content=" Transform of spectrum from frequency to wave no. (used in spec2spec)">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="../../index.html">wafo</a> &gt; <a href="../index.html">spec</a> &gt; <a href="index.html">private</a> &gt; time2spa.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for wafo\spec\private&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>time2spa
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong> Transform of spectrum from frequency to wave no. (used in spec2spec)</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong> Sk=time2spa(S,k,k2,g,rate) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> <a href="time2spa.html" class="code" title=" Transform of spectrum from frequency to wave no. (used in spec2spec)">TIME2SPA</a> Transform of spectrum from frequency to wave no. (used in <a href="../../../wafo/spec/spec2spec.html" class="code" title=" Transforms between different types of spectra">spec2spec</a>)
 
  CALL:  Sk = <a href="time2spa.html" class="code" title=" Transform of spectrum from frequency to wave no. (used in spec2spec)">time2spa</a>(S,k,k2,g)
 
    Sk = wave number spectrum, 1- or 2D depending on input
    S  = spectrum struct
   k,k2= wave number lag of output (default depending on input spectrum)
    g  = constant of <a href="../../../wafo/misc/gravity.html" class="code" title="  returns the constant acceleration of gravity ">gravity</a> (default see <a href="../../../wafo/misc/gravity.html" class="code" title="  returns the constant acceleration of gravity ">gravity</a>)
  rate = defining the <a href="../../../wafo/multidim/ratio.html" class="code" title=" compute ratio of hyperbolic functions ">ratio</a> between the wave numbers and angular
         frequencies. (default 2)
 
  Transforms a frequency or directional spectrum to 
  a wave number spectrum.
  Input 1D gives output 1D, input 2D gives output 2D
  Rotation, transformation etc is preserved
 
  See also definitions, <a href="../../../wafo/spec/spec2spec.html" class="code" title=" Transforms between different types of spectra">spec2spec</a></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<TABLE BORDER=0>

<TR>
<TD><li><a href="../../../wafo/misc/gravity.html" class="code" title=" g=gravity(phi)">gravity</a></li></TD>
<TD>  returns the constant acceleration of gravity</TD>
</TR>
<TR>
<TD><li><a href="../../../wafo/spec/k2w.html" class="code" title=" [w,th]=k2w(k,k2,h,g,u,u2)">k2w</a></li></TD>
<TD> Translates from wave number to frequency</TD>
</TR>
<TR>
<TD><li><a href="../../../wafo/spec/w2k.html" class="code" title=" [k,k2,ind]=w2k(w,th,h,g),">w2k</a></li></TD>
<TD> Translates from frequency to wave number</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\lang\error.m">error</a></li></TD>
<TD>         Display message and abort function.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\polyfun\interp1.m">interp1</a></li></TD>
<TD>       1-D interpolation (table lookup)</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\polyfun\interp2.m">interp2</a></li></TD>
<TD>       2-D interpolation (table lookup).</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\graph2d\@fighandle\isfield.m">isfield</a></li></TD>
<TD>       True if field is in structure array.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\elmat\linspace.m">linspace</a></li></TD>
<TD>      Linearly spaced vector.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\datatypes\rmfield.m">rmfield</a></li></TD>
<TD>       Remove fields from a structure array.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\strfun\@char\strcmpi.bi">strcmpi</a></li></TD>
<TD>       Compare strings ignoring case.</TD>
</TR>
</TABLE>
</ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<TABLE BORDER=0>

<TR>
<TD><li><a href="../../../wafo/spec/spec2spec.html" class="code" title=" [Snew]=spec2spec(S,newtype,phi,v)">spec2spec</a></li></TD>
<TD> Transforms between different types of spectra</TD>
</TR>
</TABLE>

</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="#_sub1" class="code"> dw=dwdk(w,k,h,g)</a></li></ul>
<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>001 <span class="keyword">function</span> Sk=<a name="_sub0" href="#_subfunctions" class="code">time2spa</a>(S,k,k2,g,rate)
002 <span class="comment">%TIME2SPA Transform of spectrum from frequency to wave no. (used in spec2spec)</span>
003 <span class="comment">%</span>
004 <span class="comment">% CALL:  Sk = time2spa(S,k,k2,g)</span>
005 <span class="comment">%</span>
006 <span class="comment">%   Sk = wave number spectrum, 1- or 2D depending on input</span>
007 <span class="comment">%   S  = spectrum struct</span>
008 <span class="comment">%  k,k2= wave number lag of output (default depending on input spectrum)</span>
009 <span class="comment">%   g  = constant of gravity (default see gravity)</span>
010 <span class="comment">% rate = defining the ratio between the wave numbers and angular</span>
011 <span class="comment">%        frequencies. (default 2)</span>
012 <span class="comment">%</span>
013 <span class="comment">% Transforms a frequency or directional spectrum to </span>
014 <span class="comment">% a wave number spectrum.</span>
015 <span class="comment">% Input 1D gives output 1D, input 2D gives output 2D</span>
016 <span class="comment">% Rotation, transformation etc is preserved</span>
017 <span class="comment">%</span>
018 <span class="comment">% See also definitions, spec2spec</span>
019 
020 <span class="comment">% Tested on Matlab 5.3</span>
021 <span class="comment">% History:  revised by så 03.10.2005: corrected bug when input k=dk</span>
022 <span class="comment">%           revised by es 29.11.1999: norm. in both x and y (length(g) 1 OR 2)</span>
023 <span class="comment">%           by es 99.08.17</span>
024 
025 error(nargchk(1,5,nargin))
026 <span class="keyword">if</span> nargin&lt;5|isempty(rate), rate = 2; <span class="keyword">end</span>
027 rate = max(round(abs(rate)),1);
028 
029 <span class="keyword">if</span> nargin&lt;3
030   <span class="keyword">if</span> isfield(S,<span class="string">'g'</span>)
031     g=S.g;
032   <span class="keyword">else</span>
033     g=<a href="../../../wafo/misc/gravity.html" class="code" title="  returns the constant acceleration of gravity ">gravity</a>;
034   <span class="keyword">end</span>
035 <span class="keyword">end</span>
036 <span class="keyword">if</span> strcmpi(S.type(<span class="keyword">end</span>-2:<span class="keyword">end</span>),<span class="string">'k1d'</span>)|strcmpi(S.type(<span class="keyword">end</span>-2:<span class="keyword">end</span>),<span class="string">'k2d'</span>)
037   error(<span class="string">'Spectrum already in space domain'</span>)
038 <span class="keyword">end</span>
039 Sk=S;
040 <span class="keyword">if</span> isfield(S,<span class="string">'f'</span>)
041   w=2*pi*S.f(:);
042   Sf=S.S/2/pi;
043   Sk=rmfield(Sk,<span class="string">'f'</span>);
044 <span class="keyword">else</span>
045   w=S.w(:);
046   Sf=S.S;
047   Sk=rmfield(Sk,<span class="string">'w'</span>);
048 <span class="keyword">end</span>
049 <span class="keyword">if</span> isfield(Sk,<span class="string">'v'</span>)
050   Sk=rmfield(Sk,{<span class="string">'v'</span>,<span class="string">'phi'</span>});
051   <span class="comment">% enc.velocity  and direction make no sense for wave no spectrum</span>
052 <span class="keyword">end</span>
053 Sk.g=g;
054 
055 <span class="keyword">if</span> strcmpi(S.type,<span class="string">'freq'</span>)|strcmpi(S.type,<span class="string">'enc'</span>)
056   <span class="keyword">if</span> nargin&lt;2|isempty(k)
057     k=linspace(0,<a href="../../../wafo/spec/w2k.html" class="code" title=" Translates from frequency to wave number">w2k</a>(w(<span class="keyword">end</span>),0,S.h,g(1)),rate*length(w))';
058   <span class="keyword">else</span>
059     <span class="keyword">if</span> length(k)==1 <span class="comment">% then interpret k as dk (step length)</span>
060       k=((0:length(w)-1)*k)';
061     <span class="keyword">end</span>
062   <span class="keyword">end</span>
063   length(k);
064   wk = <a href="../../../wafo/spec/k2w.html" class="code" title=" Translates from wave number to frequency">k2w</a>(k,0,Sk.h,g(1));
065   in = (wk&gt;min(w))&amp;(wk&lt;=w(<span class="keyword">end</span>));
066   Gk = zeros(size(w));
067   Gk(in)=interp1(w,Sf,wk(in));
068   Sk.S=zeros(size(k'));
069   Sk.S=(Gk.*<a href="#_sub1" class="code" title="sub  dw=dwdk(w,k,h,g)">dwdk</a>(wk,k,Sk.h,g(1)))';
070   Sk.type=<span class="string">'k1D'</span>;
071   Sk.k=k';
072 <span class="keyword">else</span> <span class="comment">% directional spectrum</span>
073   <span class="keyword">if</span> S.h&lt;inf
074     disp(<span class="string">'This transformation for finite depth is not available yet'</span>)
075     <span class="keyword">return</span>
076   <span class="keyword">end</span>
077   <span class="keyword">if</span> nargin&lt;2|(isempty(k)&amp;isempty(k2)) <span class="comment">% no arg-in for wave-numbers</span>
078     nw=max(rate-1,1)*length(w);
079     k=linspace(0,w(<span class="keyword">end</span>)^2/g(1),nw);
080     <span class="keyword">if</span> g(<span class="keyword">end</span>)&gt;0
081       k2=linspace(-w(<span class="keyword">end</span>)^2/g(<span class="keyword">end</span>), w(<span class="keyword">end</span>)^2/g(<span class="keyword">end</span>), 2*nw-1)';
082     <span class="keyword">else</span>
083        k2=linspace(-w(<span class="keyword">end</span>)^2/g(1), w(<span class="keyword">end</span>)^2/g(1), 2*nw-1)';
084     <span class="keyword">end</span>     
085   <span class="keyword">else</span> <span class="comment">% Some arg-in for k</span>
086     <span class="keyword">if</span> nargin&lt;3|isempty(k2) <span class="comment">% no arg-in for k2</span>
087       k2=k;
088     <span class="keyword">end</span>
089     <span class="keyword">if</span> length(k)==1 <span class="comment">% k scalar, ie dk</span>
090       k=(0:(nw-1))*k;
091     <span class="keyword">end</span>
092     <span class="keyword">if</span> length(k2)==1 <span class="comment">% ditto for k2</span>
093       k2=(-(nw-1):(nw-1))'*k2;
094     <span class="keyword">end</span>
095   <span class="keyword">end</span>
096   <span class="comment">% k,k2 vectors. Make matrices</span>
097   k=k(:)'; <span class="comment">% make k row vector</span>
098   <span class="keyword">if</span> (S.theta(1)&lt;-pi/2)|(S.theta(<span class="keyword">end</span>)&gt;pi/2);
099     <span class="comment">%thetas on the left half plane =&gt; k's&lt;0</span>
100     k=[-fliplr(k(:,2:<span class="keyword">end</span>)) k];
101   <span class="keyword">end</span>
102   k2=k2(:); <span class="comment">% make k2 column vector</span>
103   K1=ones(size(k2))*k;
104   K2=k2*ones(size(k));
105   Sk.k=k;
106   Sk.k2=k2;
107 
108   <span class="comment">% Matrices K1 and K2 are equidistant</span>
109   W=sqrt(sqrt(g(1)^2*K1.^2+g(<span class="keyword">end</span>)^2*K2.^2)); <span class="comment">% Non-equidistant W derived from (K1,K2)</span>
110   TH=atan2(g(<span class="keyword">end</span>)*K2,g(1)*K1); <span class="comment">% =&gt; -pi &lt; TH &lt;= pi, Non-eq.dist. TH ----&quot;----</span>
111   Gk=zeros(size(W));
112   in=(W&gt;w(1))&amp;(W&lt;=w(<span class="keyword">end</span>))&amp;(TH&gt;S.theta(1))&amp;(TH&lt;=S.theta(<span class="keyword">end</span>));
113   Gk(in)=interp2(w,S.theta,Sf,W(in),TH(in),<span class="string">'*linear'</span>);
114   Sk.S=zeros(size(Gk));
115   Sk.S(W&gt;0)=Gk(W&gt;0)./abs(W(W&gt;0)).^3/2*g(1)*g(<span class="keyword">end</span>);  <span class="comment">% Wave-number spectrum</span>
116   Sk=rmfield(Sk,<span class="string">'theta'</span>);
117   Sk.type=<span class="string">'k2D'</span>;
118 <span class="keyword">end</span>
119 <span class="keyword">return</span>
120 
121 <span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%<span class="comment">%</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>
122 
123 <span class="keyword">function</span> dw=<a name="_sub1" href="#_subfunctions" class="code">dwdk</a>(w,k,h,g)
124 
125 dw=zeros(size(w));
126 <span class="keyword">if</span> h==inf
127   dw(w&gt;0)=g/2./w(w&gt;0);
128 <span class="keyword">else</span>
129   dw(w&gt;0)=(g*tanh(k(w&gt;0)*h)+g*h*k(w&gt;0).*(1-tanh(k(w&gt;0)*h).^2))./w(w&gt;0)/2;
130 <span class="keyword">end</span>
131 <span class="keyword">return</span>
132 
133 
134 
135 
136 
137 
138 
139 
140 
141</pre></div>
<HR noShade>
<SMALL><A href="http://www.maths.lth.se/matstat/">Mathematical 
Statistics</A><BR><A href="http://www.maths.lth.se/">Centre for Mathematical 
Sciences</A><BR><A href="http://www.lu.se/">Lund University</A> with <A 
href="http://www.lth.se/">Lund Institute of Technology</A> </SMALL>
<P><SMALL>Comments or corrections to the <A
href="mailto:wafo@maths.lth.se">WAFO group</A>  </P>

<hr><address>Generated on Thu 06-Oct-2005 02:21:16
 for <strong><A href="http://www.maths.lth.se/matstat/wafo/">WAFO</A></strong>
 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>