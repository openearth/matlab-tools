<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>WAFO. Description of seasim</title>
  <meta name="keywords" content="seasim">
  <meta name="description" content=" Spectral simulation of a Gaussian sea, 2D (x,t) or 3D (x,y,t)">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="../index.html">wafo</a> &gt; <a href="index.html">wsim</a> &gt; seasim.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for wafo\wsim&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>seasim
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong> Spectral simulation of a Gaussian sea, 2D (x,t) or 3D (x,y,t)</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong> [Y,Mv]=seasim(spec,Nx,Ny,Nt,dx,dy,dt,fftdim,plotflag); </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> <a href="seasim.html" class="code" title=" Spectral simulation of a Gaussian sea, 2D (x,t) or 3D (x,y,t)">SEASIM</a> Spectral simulation of a Gaussian <a href="../../wafo/data/sea.html" class="code" title=" Surface elevation dataset used in WAT version 1.1.">sea</a>, 2D (x,t) or 3D (x,y,t)
 
  CALL:  [Y, Mv]=<a href="seasim.html" class="code" title=" Spectral simulation of a Gaussian sea, 2D (x,t) or 3D (x,y,t)">seasim</a>(spec,Nx,Ny,Nt,dx,dy,dt,fftdim,plotflag)
 
        Y    = output struct with simulated path
        Mv   = movie of output (run with movie(Mv))
        spec = spectrum struct, must be two-dimensional spectrum
        Nx,Ny,Nt = number of points in grid. Put Ny=0 for 2D simulation
                   (default 2^7)
        dx,dy,dt = steps in grid (default dx,dt by the Nyquist freq, dy=dx)
        fftdim   = 1 or 2 gives one- or two dimensional FFT. (default 2) 
                   If 1 then FFT over t and looping over x and y.
                   If 2 then FFT2 over x and y, looping over t. 
        plotflag = 0,1 or 2. If 0 no plot, if 2 movie (takes a couple of min.) 
                   if 1 single (first) frame of movie (default 0)
                    
  The output struct contains:
           .Z matrix of size [Ny Nx Nt], but with singleton dimensions removed 
           .x, .t (and .y if Ny&gt;1)  
  For the removal of singleton dimensions, see SQUEEZE.
   
  The output movie can also be created separately by calling <a href="seamovie.html" class="code" title=" Makes a movie of a 2D (x,t) or 3D (x,y,t) simulated sea ">SEAMOVIE</a>.
  Then can also different plot styles be chosen for the movie. The style
  used here is a surf-plot.  
   
  <a href="../../wafo/docs/limitations.html" class="code" title=" (+)  WAFO known limitations">Limitations</a>: memory demanding! fftdim=2 is in general better.
  When fftdim=1 and NX*NY is large (the limit also depends on spectrum, dt
  etc.) then a slower version with more looping is used. This version can be 
  forced by putting fftdim to something greater than 2, then fftdim will equal
  the number of extra loops. Try this after an interrupt by 'Out of Memory'. 
 
  If the spectrum has a non-empty field .tr, then the transformation is 
  applied to the simulated data, the result is a simulation of a transformed
  Gaussian <a href="../../wafo/data/sea.html" class="code" title=" Surface elevation dataset used in WAT version 1.1.">sea</a>.
 
  Example: % Simulate using <a href="../../wafo/spec/demospec.html" class="code" title=" Loads a precreated spectrum of chosen type">demospec</a>, plot the first frame 
           Y=<a href="seasim.html" class="code" title=" Spectral simulation of a Gaussian sea, 2D (x,t) or 3D (x,y,t)">seasim</a>(<a href="../../wafo/spec/demospec.html" class="code" title=" Loads a precreated spectrum of chosen type">demospec</a>('dir'),2^7,2^7,100,10,10,1,2,1);  
 
  See also  <a href="seamovie.html" class="code" title=" Makes a movie of a 2D (x,t) or 3D (x,y,t) simulated sea ">seamovie</a>, <a href="spec2sdat.html" class="code" title=" Simulates a Gaussian process and its derivative from spectrum">spec2sdat</a></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<TABLE BORDER=0>

<TR>
<TD><li><a href="../../wafo/misc/fwaitbar.html" class="code" title=" fout = fwaitbar(x,name,msg)">fwaitbar</a></li></TD>
<TD> Fast display of wait bar.</TD>
</TR>
<TR>
<TD><li><a href="../../wafo/misc/gravity.html" class="code" title=" g=gravity(phi)">gravity</a></li></TD>
<TD>  returns the constant acceleration of gravity</TD>
</TR>
<TR>
<TD><li><a href="../../wafo/spec/k2w.html" class="code" title=" [w,th]=k2w(k,k2,h,g,u,u2)">k2w</a></li></TD>
<TD> Translates from wave number to frequency</TD>
</TR>
<TR>
<TD><li><a href="seamovie.html" class="code" title=" Mv=seamovie(Y,s)">seamovie</a></li></TD>
<TD> Makes a movie of a 2D (x,t) or 3D (x,y,t) simulated sea</TD>
</TR>
<TR>
<TD><li><a href="../../wafo/misc/simpson.html" class="code" title=" [area,epsi,a,b] = simpson(x,f,dim)">simpson</a></li></TD>
<TD> Numerical integration with the Simpson method</TD>
</TR>
<TR>
<TD><li><a href="../../wafo/spec/spec2mom.html" class="code" title=" [m,mtext] = spec2mom(S,nr,vari,even)">spec2mom</a></li></TD>
<TD> Calculates spectral moments from spectrum</TD>
</TR>
<TR>
<TD><li><a href="../../wafo/spec/spec2spec.html" class="code" title=" [Snew]=spec2spec(S,newtype,phi,v)">spec2spec</a></li></TD>
<TD> Transforms between different types of spectra</TD>
</TR>
<TR>
<TD><li><a href="../../wafo/spec/specinterp.html" class="code" title=" Snew = specinterp(S,dt)">specinterp</a></li></TD>
<TD> Interpolation and zero-padding of spectrum</TD>
</TR>
<TR>
<TD><li><a href="../../wafo/trgauss/tranproc.html" class="code" title=" y = tranproc(x,ff)">tranproc</a></li></TD>
<TD> Transforms process X and up to four derivatives</TD>
</TR>
<TR>
<TD><li><a href="../../wafo/spec/w2k.html" class="code" title=" [k,k2,ind]=w2k(w,th,h,g),">w2k</a></li></TD>
<TD> Translates from frequency to wave number</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\graph2d\axis.m">axis</a></li></TD>
<TD>          Control axis scaling and appearance.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\imaq\imaq\private\clear.m">clear</a></li></TD>
<TD>         Clear variables and functions from memory.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\iofun\@serial\close.m">close</a></li></TD>
<TD>         Close figure.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\graph3d\colormap.m">colormap</a></li></TD>
<TD>      Color look-up table.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\specgraph\contour.m">contour</a></li></TD>
<TD>       Contour plot.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\datafun\@int16\diff.bi">diff</a></li></TD>
<TD>          Difference and approximate derivative.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\lang\error.m">error</a></li></TD>
<TD>         Display message and abort function.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\datafun\fft2.m">fft2</a></li></TD>
<TD>          Two-dimensional discrete Fourier Transform.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\datafun\fftshift.m">fftshift</a></li></TD>
<TD>      Shift zero-frequency component to center of spectrum.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\graphics\figure.m">figure</a></li></TD>
<TD>        Create figure window.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\graphics\gca.m">gca</a></li></TD>
<TD>           Get handle to current axis.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\graphics\gcf.m">gcf</a></li></TD>
<TD>           Get handle to current figure.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\datafun\@logical\ifft.bi">ifft</a></li></TD>
<TD>          Inverse discrete Fourier transform.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\signal\signal\@fdesign\interp.p">interp</a></li></TD>
<TD>        Resample data at a higher rate using lowpass interpolation.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\polyfun\interp2.m">interp2</a></li></TD>
<TD>       2-D interpolation (table lookup).</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\graph2d\@fighandle\isfield.m">isfield</a></li></TD>
<TD>       True if field is in structure array.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\strfun\@char\lower.bi">lower</a></li></TD>
<TD>         Convert string to lowercase.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\elmat\meshgrid.m">meshgrid</a></li></TD>
<TD>      X and Y arrays for 3-D plots.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\elfun\nextpow2.m">nextpow2</a></li></TD>
<TD>      Next higher power of 2.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\ident\ident\@iddata\plot.m">plot</a></li></TD>
<TD>          Linear plot.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\datatypes\rmfield.m">rmfield</a></li></TD>
<TD>       Remove fields from a structure array.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="set is a built-in method">set</a></li></TD>
<TD>           Set object properties.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\graph3d\shading.m">shading</a></li></TD>
<TD>       Color shading mode.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\robust\robust\@umat\squeeze.m">squeeze</a></li></TD>
<TD>       Remove singleton dimensions.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\strfun\@char\strcmp.bi">strcmp</a></li></TD>
<TD>        Compare strings.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\graph3d\surfl.m">surfl</a></li></TD>
<TD>         3-D shaded surface with lighting.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\ident\ident\@idmodel\view.m">view</a></li></TD>
<TD>          3-D graph viewpoint specification.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\graph2d\xlabel.m">xlabel</a></li></TD>
<TD>        X-axis label.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\graph2d\ylabel.m">ylabel</a></li></TD>
<TD>        Y-axis label.</TD>
</TR>
</TABLE>
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<TABLE BORDER=0>

<TR>
<TD><li><a href="../../wafo/papers/tutorcom/Chapter1.html" class="code" title="This is a script file.">Chapter1</a></li></TD>
<TD> % CHAPTER1 demonstrates some applications of WAFO</TD>
</TR>
</TABLE>

</ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>001 <span class="keyword">function</span> [Y,Mv]=<a name="_sub0" href="#_subfunctions" class="code">seasim</a>(spec,Nx,Ny,Nt,dx,dy,dt,fftdim,plotflag); 
002 <span class="comment">%SEASIM Spectral simulation of a Gaussian sea, 2D (x,t) or 3D (x,y,t)</span>
003 <span class="comment">%</span>
004 <span class="comment">% CALL:  [Y, Mv]=seasim(spec,Nx,Ny,Nt,dx,dy,dt,fftdim,plotflag)</span>
005 <span class="comment">%</span>
006 <span class="comment">%       Y    = output struct with simulated path</span>
007 <span class="comment">%       Mv   = movie of output (run with movie(Mv))</span>
008 <span class="comment">%       spec = spectrum struct, must be two-dimensional spectrum</span>
009 <span class="comment">%       Nx,Ny,Nt = number of points in grid. Put Ny=0 for 2D simulation</span>
010 <span class="comment">%                  (default 2^7)</span>
011 <span class="comment">%       dx,dy,dt = steps in grid (default dx,dt by the Nyquist freq, dy=dx)</span>
012 <span class="comment">%       fftdim   = 1 or 2 gives one- or two dimensional FFT. (default 2) </span>
013 <span class="comment">%                  If 1 then FFT over t and looping over x and y.</span>
014 <span class="comment">%                  If 2 then FFT2 over x and y, looping over t. </span>
015 <span class="comment">%       plotflag = 0,1 or 2. If 0 no plot, if 2 movie (takes a couple of min.) </span>
016 <span class="comment">%                  if 1 single (first) frame of movie (default 0)</span>
017 <span class="comment">%                   </span>
018 <span class="comment">% The output struct contains:</span>
019 <span class="comment">%          .Z matrix of size [Ny Nx Nt], but with singleton dimensions removed </span>
020 <span class="comment">%          .x, .t (and .y if Ny&gt;1)  </span>
021 <span class="comment">% For the removal of singleton dimensions, see SQUEEZE.</span>
022 <span class="comment">%  </span>
023 <span class="comment">% The output movie can also be created separately by calling SEAMOVIE.</span>
024 <span class="comment">% Then can also different plot styles be chosen for the movie. The style</span>
025 <span class="comment">% used here is a surf-plot.  </span>
026 <span class="comment">%  </span>
027 <span class="comment">% Limitations: memory demanding! fftdim=2 is in general better.</span>
028 <span class="comment">% When fftdim=1 and NX*NY is large (the limit also depends on spectrum, dt</span>
029 <span class="comment">% etc.) then a slower version with more looping is used. This version can be </span>
030 <span class="comment">% forced by putting fftdim to something greater than 2, then fftdim will equal</span>
031 <span class="comment">% the number of extra loops. Try this after an interrupt by 'Out of Memory'. </span>
032 <span class="comment">%</span>
033 <span class="comment">% If the spectrum has a non-empty field .tr, then the transformation is </span>
034 <span class="comment">% applied to the simulated data, the result is a simulation of a transformed</span>
035 <span class="comment">% Gaussian sea.</span>
036 <span class="comment">%</span>
037 <span class="comment">% Example: <span class="comment">% Simulate using demospec, plot the first frame </span></span>
038 <span class="comment">%          Y=seasim(demospec('dir'),2^7,2^7,100,10,10,1,2,1);  </span>
039 <span class="comment">%</span>
040 <span class="comment">% See also  seamovie, spec2sdat</span>
041   
042 <span class="comment">% Tested on Matlab 5.3  </span>
043 <span class="comment">% revised pab June 2005</span>
044 <span class="comment">% added fwaitbar and removed disp statements</span>
045 <span class="comment">% revised jr 310301, added some status info, displayed when pg is running</span>
046 <span class="comment">% revised jr 180101, line 77, g -&gt; spec.g</span>
047 <span class="comment">% revised es 200600, removed orient landscape  </span>
048 <span class="comment">% revised es 130600, corrected two errors, </span>
049 <span class="comment">%                    added more plotting alternatives depending on dimension  </span>
050 <span class="comment">% revised es 060600, added transformation of data  </span>
051 <span class="comment">% By es 23.05.00  </span>
052 
053 <span class="comment">% Initialization</span>
054 <span class="keyword">if</span> ~isfield(spec,<span class="string">'g'</span>)
055   spec.g=<a href="../../wafo/misc/gravity.html" class="code" title="  returns the constant acceleration of gravity ">gravity</a>;
056 <span class="keyword">end</span>
057 <span class="keyword">if</span> strcmp(lower(spec.type(<span class="keyword">end</span>-2:<span class="keyword">end</span>)),<span class="string">'k2d'</span>)
058   spec=<a href="../../wafo/spec/spec2spec.html" class="code" title=" Transforms between different types of spectra">spec2spec</a>(spec,<span class="string">'dir'</span>);
059 <span class="keyword">elseif</span> ~strcmp(lower(spec.type(<span class="keyword">end</span>-2:<span class="keyword">end</span>)),<span class="string">'dir'</span>)
060   error(<span class="string">'Spectrum must be two-dimensional'</span>)
061 <span class="keyword">end</span>
062 <span class="keyword">if</span> isfield(spec,<span class="string">'f'</span>)
063   spec.w=spec.f*2*pi;
064   spec.S=spec.S/2/pi;
065   spec=rmfield(spec,<span class="string">'f'</span>);
066 <span class="keyword">end</span>
067 <span class="keyword">if</span> nargin&lt;2|isempty(Nx)
068   Nx=2^nextpow2(length(spec.w));
069 <span class="keyword">end</span>
070 <span class="keyword">if</span> nargin&lt;3|isempty(Ny)
071   Ny=2^nextpow2(length(spec.w));
072 <span class="keyword">end</span>
073 <span class="keyword">if</span> Ny==0
074   Ny=1;
075 <span class="keyword">end</span>
076 <span class="keyword">if</span> nargin&lt;4|isempty(Nt)
077   Nt=2^nextpow2(length(spec.w));
078 <span class="keyword">end</span>
079 <span class="keyword">if</span> nargin&lt;5|isempty(dx)
080   dx=pi/(spec.w(<span class="keyword">end</span>)^2/spec.g)/2;
081 <span class="keyword">end</span>
082 <span class="keyword">if</span> nargin&lt;6|isempty(dy)
083   dy=dx;
084 <span class="keyword">end</span>
085 <span class="keyword">if</span> nargin&lt;7|isempty(dt)
086   dt=pi/spec.w(<span class="keyword">end</span>); <span class="comment">%directly by the Nyquist frequency</span>
087 <span class="keyword">end</span>
088 <span class="keyword">if</span> nargin&lt;8|isempty(fftdim)
089   fftdim=1;
090 <span class="keyword">end</span>
091 <span class="keyword">if</span> nargin&lt;9|isempty(plotflag)
092   plotflag=0;
093 <span class="keyword">end</span>
094 t=(0:Nt-1)'*dt;
095 x=(0:Nx-1)'*dx;  
096 y=(0:Ny-1)'*dy;  
097 
098 <span class="keyword">if</span> fftdim~=2
099   spec=<a href="../../wafo/spec/specinterp.html" class="code" title=" Interpolation and zero-padding of spectrum">specinterp</a>(spec,dt);
100   nf= length(spec.w); <span class="comment">%number of frequencies</span>
101   np= length(spec.theta); <span class="comment">% number of directions</span>
102   Nxy=Nx*Ny;
103   Nxyp=2^10;   <span class="comment">% limit for Nxy to do in one step</span>
104   [Xi,Yi]=meshgrid(x,y);
105   <span class="comment">%Normalize to get variance back after discretization</span>
106   Sdiscr=(spec.S)*spec.w(<span class="keyword">end</span>)/nf*diff(spec.theta([1,<span class="keyword">end</span>]))/np; <span class="comment">% size np x nf</span>
107   Sdiscr=(randn(np,nf)+i*randn(np,nf)).*sqrt(Sdiscr);
108   [k1,k2]=<a href="../../wafo/spec/w2k.html" class="code" title=" Translates from frequency to wave number">w2k</a>(spec.w,spec.theta,spec.h,spec.g);
109   Sxy=zeros(nf,Nxy);
110   
111   h = <a href="../../wafo/misc/fwaitbar.html" class="code" title=" Fast display of wait bar. ">fwaitbar</a>(0,[],<span class="string">' Integration ... '</span>);
112   <span class="keyword">for</span> ix=1:Nxy,
113     Sxy(:,ix)=<a href="../../wafo/misc/simpson.html" class="code" title=" Numerical integration with the Simpson method">simpson</a>(0:np-1,Sdiscr.*exp(i*(Xi(ix)*k1+Yi(ix)*k2))).';
114     <a href="../../wafo/misc/fwaitbar.html" class="code" title=" Fast display of wait bar. ">fwaitbar</a>(ix/Nxy,h)
115   <span class="keyword">end</span> 
116   close(h)
117   clear Sdiscr k1 k2
118   nfft=2^nextpow2(2*nf-2);
119   Sxy=[Sxy; zeros(nfft-(2*nf)+2,Nxy); conj(Sxy(nf-1:-1:2,:))];
120   <span class="comment">% size(Z) is Nxy x nfft</span>
121   Y.Z=zeros(Nxy,nfft);
122   <span class="keyword">if</span> (Nxy&lt;Nxyp)|fftdim&gt;2
123     Y.Z=real(ifft(Sxy,nfft,1)).'*nfft/(2*nf-2)*nf;
124   <span class="keyword">else</span> <span class="comment">%do it stepwise</span>
125     <span class="keyword">if</span> fftdim&gt;2 <span class="comment">% new Nxyp to get fftdim steps</span>
126       Nxyp=ceil(Nxy/fftdim);
127     <span class="keyword">end</span>
128     nr=ceil(Nxy/Nxyp);
129     
130     h = <a href="../../wafo/misc/fwaitbar.html" class="code" title=" Fast display of wait bar. ">fwaitbar</a>(0,[],<span class="string">'  ... '</span>);
131     <span class="keyword">for</span> j=1:nr 
132       Y.Z((j-1)*Nyxp+1:min(j*Nyxp,Nxy),:)=real(ifft(Sxy(:,(j-1)*Nxyp+1:min(j*2^10,Nxy)),nfft,1)).'* <span class="keyword">...</span>
133         nfft/(2*nf-2)*nf;
134       <a href="../../wafo/misc/fwaitbar.html" class="code" title=" Fast display of wait bar. ">fwaitbar</a>(j/nr,h)
135     <span class="keyword">end</span>
136     close(h)
137   <span class="keyword">end</span>
138   Y.Z=squeeze(reshape(Y.Z(1:Nxy,1:Nt),Ny,Nx,Nt)); 
139 <span class="keyword">else</span>  <span class="comment">% if fftdim ...</span>
140   nfftx=2^nextpow2(max(Nx,length(spec.w)));
141   nffty=2^nextpow2(max(Ny,length(spec.w)));
142   <span class="keyword">if</span> nffty&lt;2
143     nffty=2;
144   <span class="keyword">end</span>
145   dk1=2*pi/nfftx/dx; <span class="comment">% necessary wave number lag to satisfy input space lag</span>
146   dk2=2*pi/nffty/dy; <span class="comment">% necessary wave number lag to satisfy input space lag</span>
147   S=<a href="../../wafo/spec/spec2spec.html" class="code" title=" Transforms between different types of spectra">spec2spec</a>(spec,<span class="string">'k2d'</span>);
148   <span class="keyword">if</span> S.k(1)&gt;=0
149     S.S=[zeros(size(S.S,1),size(S.S,2)-1) S.S];
150     S.k=[-S.k(<span class="keyword">end</span>:-1:2) S.k];
151   <span class="keyword">end</span>
152   <span class="comment">% add  zeros just above old max-freq, and a zero at new max-freq</span>
153   <span class="comment">% to get non-NaN interpolation </span>
154   S.S=[zeros(2,size(S.S,1)+4); zeros(size(S.S,1),2) S.S <span class="keyword">...</span>
155        zeros(size(S.S,1),2);zeros(2,size(S.S,1)+4)];
156   dk1old=S.k(2)-S.k(1);
157   dk2old=S.k2(2)-S.k2(1);
158   S.k=[min(dk1*(-nfftx/2), S.k(1)-2*dk1old) S.k(1)-dk1old S.k S.k(<span class="keyword">end</span>)+dk1old max(dk1*(nfftx/2-1),S.k(<span class="keyword">end</span>)+2*dk1old)];
159   S.k2=[min(dk2*(-nffty/2),S.k2(1)-2*dk2old); S.k2(1)-dk2old; S.k2; S.k2(<span class="keyword">end</span>)+dk2old; max(dk2*(nffty/2-1),S.k2(<span class="keyword">end</span>)+2*dk2old)];
160   
161   <span class="comment">% Interpolate in spectrum to get right frequency grid to satisfy input</span>
162   disp(<span class="string">' Interpolating in spectrum'</span>)
163   S.S=interp2(S.k,S.k2,S.S,dk1*(-nfftx/2:nfftx/2-1),dk2*(-nffty/2:nffty/2-1)');
164   Sdiscr=S.S*dk1*dk2;
165   
166   <span class="keyword">if</span> sum(Sdiscr(:))&lt;0.9*<a href="../../wafo/spec/spec2mom.html" class="code" title=" Calculates spectral moments from spectrum">spec2mom</a>(spec,0)
167     disp(<span class="string">'WARNING: Too small dx and/or dy, or too small NX and/or NY'</span>)
168     disp(<span class="string">'         Information in the spectrum is lost'</span>)
169     disp(<span class="string">'         May be a good idea to interrupt'</span>)
170   <span class="keyword">end</span>
171   
172   Sdiscr=fftshift(Sdiscr);
173   <span class="comment">% Simulation</span>
174   Z0=sqrt(Sdiscr).*randn(nffty,nfftx)+i*sqrt(Sdiscr).*randn(nffty,nfftx);
175   W=<a href="../../wafo/spec/k2w.html" class="code" title=" Translates from wave number to frequency">k2w</a>((-nfftx/2:nfftx/2-1)*dk1,(-nffty/2:nffty/2-1)*dk2,S.h,S.g);
176   W(:,nfftx/2+1:nfftx)=-W(:,nfftx/2+1:nfftx); 
177   W=fftshift(W); 
178   Y.Z=zeros(nffty,nfftx,Nt);
179   <span class="comment">%disp(' Loop over t values')</span>
180   h = <a href="../../wafo/misc/fwaitbar.html" class="code" title=" Fast display of wait bar. ">fwaitbar</a>(0,[],<span class="string">'Loop over t values...'</span>);
181   nt = length(t);
182   <span class="keyword">for</span> j=1:nt
183     Y.Z(:,:,j)=real(fft2(Z0.*exp(i*W*t(j))));
184      <a href="../../wafo/misc/fwaitbar.html" class="code" title=" Fast display of wait bar. ">fwaitbar</a>(j/nt,h)
185   <span class="keyword">end</span>
186   close(h)
187   Y.Z=squeeze(Y.Z(1:Ny,1:Nx,:));
188   clear Z0 W Sdiscr
189   
190 <span class="keyword">end</span> <span class="comment">% if fftdim ...</span>
191 
192 <span class="keyword">if</span> Nx&gt;1
193   Y.x=x;
194 <span class="keyword">end</span>
195 <span class="keyword">if</span> Ny&gt;1
196   Y.y=y;
197 <span class="keyword">end</span>
198 <span class="keyword">if</span> Nt&gt;1
199   Y.t=t;
200 <span class="keyword">end</span>
201 
202 <span class="comment">% Transformation of data, if given</span>
203 <span class="keyword">if</span> isfield(spec,<span class="string">'tr'</span>) &amp; ~isempty(spec.tr)
204   disp(<span class="string">'   Transforming data.'</span>)
205   G=fliplr(spec.tr); <span class="comment">% the inverse of the transformation</span>
206   Y.Z(:)=<a href="../../wafo/trgauss/tranproc.html" class="code" title=" Transforms process X and up to four derivatives  ">tranproc</a>(Y.Z(:),G); 
207 <span class="keyword">end</span>
208   
209 <span class="comment">% Plotting if requested</span>
210 Mv=[];
211 <span class="keyword">if</span> plotflag==2
212   Mv=<a href="seamovie.html" class="code" title=" Makes a movie of a 2D (x,t) or 3D (x,y,t) simulated sea ">seamovie</a>(Y,1);
213 <span class="keyword">elseif</span> plotflag==1
214   figure(gcf)
215   <span class="keyword">if</span> min(Nx,Ny)&gt;2
216     colormap(<span class="string">'winter'</span>)
217     surfl(Y.x,Y.y,Y.Z(:,:,1),[-30, 45]);
218     shading interp
219     view(-37.5,20)
220     axis([Y.x(1) Y.x(<span class="keyword">end</span>) Y.y(1) Y.y(<span class="keyword">end</span>) 7*min(Y.Z(:)) 7*max(Y.Z(:))])
221     set(gca,<span class="string">'xtick'</span>,[])   
222     set(gca,<span class="string">'ytick'</span>,[])
223     axis(<span class="string">'square'</span>)
224     axis(<span class="string">'off'</span>)
225   <span class="keyword">elseif</span> Nt&gt;1
226     <span class="keyword">if</span> Nx&gt;1
227       contour(Y.t,Y.x,Y.Z,[0 0])
228     <span class="keyword">else</span>
229       contour(Y.t,Y.y,Y.Z,[0 0])
230     <span class="keyword">end</span>      
231     xlabel(<span class="string">'[s]'</span>)
232     ylabel(<span class="string">'[m]'</span>)
233   <span class="keyword">else</span>
234     <span class="keyword">if</span> Nx&gt;1
235       plot(Y.x,Y.Z)
236     <span class="keyword">elseif</span> Ny&gt;1
237       plot(Y.y,Y.Z)
238     <span class="keyword">end</span>
239     xlabel(<span class="string">'[m]'</span>)
240   <span class="keyword">end</span>
241 <span class="keyword">end</span>
242</pre></div>
<HR noShade>
<SMALL><A href="http://www.maths.lth.se/matstat/">Mathematical 
Statistics</A><BR><A href="http://www.maths.lth.se/">Centre for Mathematical 
Sciences</A><BR><A href="http://www.lu.se/">Lund University</A> with <A 
href="http://www.lth.se/">Lund Institute of Technology</A> </SMALL>
<P><SMALL>Comments or corrections to the <A
href="mailto:wafo@maths.lth.se">WAFO group</A>  </P>

<hr><address>Generated on Thu 06-Oct-2005 02:21:16
 for <strong><A href="http://www.maths.lth.se/matstat/wafo/">WAFO</A></strong>
 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>