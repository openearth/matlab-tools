<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>WAFO. Description of dat2cor</title>
  <meta name="keywords" content="dat2cor">
  <meta name="description" content=" Estimate auto correlation function from data.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="../index.html">wafo</a> &gt; <a href="index.html">onedim</a> &gt; dat2cor.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for wafo\onedim&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>dat2cor
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong> Estimate auto correlation function from data.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong> [corr,c0] = dat2cor(xn,varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> <a href="dat2cor.html" class="code" title=" Estimate auto correlation function from data.">DAT2COR</a> Estimate auto correlation function from data.
 
  CALL:  r = <a href="dat2cor.html" class="code" title=" Estimate auto correlation function from data.">dat2cor</a>(x,L,plotflag,dT,flag)
 
          r = Covariance structure containing:
                  R = ACF vector length L+1  
                  t = time lags  length L+1  
              stdev = estimated large lag standard deviation of the estimate
                      assuming x is a Gaussian process:
                      if r(k)=0 for all lags k&gt;q then an approximation 
                      of the variance for large samples due to Bartlett
                      <a href="../../wafo/wstats/var.html" class="code" title="  Variance ">var</a>(corr(k))=1/N*(1+2*r(1)^2+2*r(2)^2+ ..+2*r(q)^2)
                      for  k&gt;q and where  N=length(x). Special case is
                      white noise where it equals 1/N for k&gt;0
                  h = water depth (default inf)
                 tr = [], transformation 
               type = 'none'
               norm = 1 indicating that R is normalized
 
         x  = a vector or a two column data matrix with 
              sampled times and values. (length n)
         L  = the maximum time-lag for which the ACF is estimated.
                (Default L=n-1)        
   plotflag = 1 then the ACF is plotted vs lag
                2 then the ACF is plotted vs lag in seconds
                3 then the ACF is plotted vs lag and vs lag (sec
         dT = time-step between data points (default xn(2,1)-xn(1,1) or 1 Hz).
       flag = 'biased'  : scales the raw correlation by 1/n. (default)
              'unbiased': scales the raw correlation by 1/(n-abs(k)), 
                          where k is the lag.
 
   Note: - flag may be given anywhere after x.
         - x may contain NaN's (i.e. missing values).
 
  Example: 
    x = load('sea.dat');
    rf = <a href="dat2cor.html" class="code" title=" Estimate auto correlation function from data.">dat2cor</a>(x,150,2)
 
  See also  <a href="dat2cov.html" class="code" title=" Estimate auto covariance function from data.">dat2cov</a>, <a href="covplot.html" class="code" title=" Plots the auto covariance function (ACF) 1D or 2D. ">covplot</a></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<TABLE BORDER=0>

<TR>
<TD><li><a href="covplot.html" class="code" title=" covplot(rn,L,plotflag,lintype)">covplot</a></li></TD>
<TD> Plots the auto covariance function (ACF) 1D or 2D.</TD>
</TR>
<TR>
<TD><li><a href="../../wafo/spec/createcov.html" class="code" title=" R=createcov(nr,vari,ctype)">createcov</a></li></TD>
<TD> Covariance class constructor</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\lang\error.m">error</a></li></TD>
<TD>         Display message and abort function.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\datafun\@logical\fft.bi">fft</a></li></TD>
<TD>           Discrete Fourier transform.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\strfun\ischar.m">ischar</a></li></TD>
<TD>        True for character array (string).</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\datafun\mean.m">mean</a></li></TD>
<TD>          Average or mean value.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\elfun\nextpow2.m">nextpow2</a></li></TD>
<TD>      Next higher power of 2.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\strfun\@char\strcmpi.bi">strcmpi</a></li></TD>
<TD>       Compare strings ignoring case.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\signal\signal\xcorr.m">xcorr</a></li></TD>
<TD>         Cross-correlation function estimates.</TD>
</TR>
</TABLE>
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<TABLE BORDER=0>

<TR>
<TD><li><a href="dat2cov.html" class="code" title=" R = dat2cov(xn,varargin)">dat2cov</a></li></TD>
<TD> Estimate auto covariance function from data.</TD>
</TR>
</TABLE>

</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code"> [x,L,plotflag,dT,flag,n] = dat2corchk(P,xn,Na)</a></li></ul>
<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>001 <span class="keyword">function</span> [corr,c0] = <a name="_sub0" href="#_subfunctions" class="code">dat2cor</a>(xn,varargin)
002 <span class="comment">%DAT2COR Estimate auto correlation function from data.</span>
003 <span class="comment">%</span>
004 <span class="comment">% CALL:  r = dat2cor(x,L,plotflag,dT,flag)</span>
005 <span class="comment">%</span>
006 <span class="comment">%         r = Covariance structure containing:</span>
007 <span class="comment">%                 R = ACF vector length L+1  </span>
008 <span class="comment">%                 t = time lags  length L+1  </span>
009 <span class="comment">%             stdev = estimated large lag standard deviation of the estimate</span>
010 <span class="comment">%                     assuming x is a Gaussian process:</span>
011 <span class="comment">%                     if r(k)=0 for all lags k&gt;q then an approximation </span>
012 <span class="comment">%                     of the variance for large samples due to Bartlett</span>
013 <span class="comment">%                     var(corr(k))=1/N*(1+2*r(1)^2+2*r(2)^2+ ..+2*r(q)^2)</span>
014 <span class="comment">%                     for  k&gt;q and where  N=length(x). Special case is</span>
015 <span class="comment">%                     white noise where it equals 1/N for k&gt;0</span>
016 <span class="comment">%                 h = water depth (default inf)</span>
017 <span class="comment">%                tr = [], transformation </span>
018 <span class="comment">%              type = 'none'</span>
019 <span class="comment">%              norm = 1 indicating that R is normalized</span>
020 <span class="comment">%</span>
021 <span class="comment">%        x  = a vector or a two column data matrix with </span>
022 <span class="comment">%             sampled times and values. (length n)</span>
023 <span class="comment">%        L  = the maximum time-lag for which the ACF is estimated.</span>
024 <span class="comment">%               (Default L=n-1)        </span>
025 <span class="comment">%  plotflag = 1 then the ACF is plotted vs lag</span>
026 <span class="comment">%               2 then the ACF is plotted vs lag in seconds</span>
027 <span class="comment">%               3 then the ACF is plotted vs lag and vs lag (sec</span>
028 <span class="comment">%        dT = time-step between data points (default xn(2,1)-xn(1,1) or 1 Hz).</span>
029 <span class="comment">%      flag = 'biased'  : scales the raw correlation by 1/n. (default)</span>
030 <span class="comment">%             'unbiased': scales the raw correlation by 1/(n-abs(k)), </span>
031 <span class="comment">%                         where k is the lag.</span>
032 <span class="comment">%</span>
033 <span class="comment">%  Note: - flag may be given anywhere after x.</span>
034 <span class="comment">%        - x may contain NaN's (i.e. missing values).</span>
035 <span class="comment">%</span>
036 <span class="comment">% Example: </span>
037 <span class="comment">%   x = load('sea.dat');</span>
038 <span class="comment">%   rf = dat2cor(x,150,2)</span>
039 <span class="comment">%</span>
040 <span class="comment">% See also  dat2cov, covplot</span>
041 
042        
043 <span class="comment">%(If you do have the signal toolbox you may modify this file)</span>
044 
045 <span class="comment">% Tested on: Matlab 6.0, 5.3, 5.2, 5.1</span>
046 <span class="comment">% History:</span>
047 <span class="comment">% revised jr 02.04.2001</span>
048 <span class="comment">%  - added example, updating help </span>
049 <span class="comment">% revised pab 09.10.2000</span>
050 <span class="comment">%  - added secret output c0 = variance</span>
051 <span class="comment">%  - made computations faster for the case Ncens &lt; n</span>
052 <span class="comment">%  - added flag option, dat2corchk</span>
053 <span class="comment">%  -fixed a bug: forgot to subtract the mean from x</span>
054 <span class="comment">% revised pab 12.08.99</span>
055 <span class="comment">% - changed code to handle covariance structure/class</span>
056 <span class="comment">% modified by Per A. Brodtkorb 28.10.98 </span>
057 <span class="comment">% enabled to handle missing data </span>
058 
059 
060 [x,L,plotflag,dT,flag,n] = <a href="#_sub1" class="code" title="sub  [x,L,plotflag,dT,flag,n] = dat2corchk(P,xn,Na)">dat2corchk</a>(varargin,xn,nargout);
061 
062 corr       = <a href="../../wafo/spec/createcov.html" class="code" title=" Covariance class constructor ">createcov</a>(0,<span class="string">'t'</span>);
063 corr.R     = zeros(L+1,1);
064 corr.t     = zeros(L+1,1);
065 corr.stdev = zeros(L+1,1);
066 corr.h     = inf;
067 corr.norm  = 1; <span class="comment">% normalized</span>
068 
069 <span class="comment">%----------------------------------------------</span>
070 <span class="comment">%  </span>
071 <span class="comment">%  Signal toolbox users may modify below</span>
072 <span class="comment">%</span>
073 <span class="comment">%----------------------------------------------</span>
074 
075 indnan = isnan(x);
076 <span class="keyword">if</span> any(indnan)
077    x     = x-mean(x(~indnan)); <span class="comment">% remove the mean pab 09.10.2000</span>
078    indnan = find(indnan);
079    Ncens = n-length(indnan);
080 <span class="keyword">else</span>
081    indnan = [];
082    Ncens  = n;
083    x      = x-mean(x);
084 <span class="keyword">end</span>
085 
086 <span class="keyword">if</span> 0 <span class="comment">%Ncens&lt;n, <span class="comment">%Old call for missing data (slow)   </span></span>
087    r=zeros(L+1,1);
088    <span class="comment">% unbiased result, i.e. divide by n-abs(lag)</span>
089    <span class="keyword">for</span> tau=0:L,
090       Ntau=n-tau;
091       ix=1:Ntau; <span class="comment">% constructing a vector if indices</span>
092       <span class="comment">%vector multiplication is faster than a for loop in MATLAB</span>
093       tmp=x(ix).*x(ix+tau);
094       <span class="keyword">if</span> strcmpi(flag,<span class="string">'unbiased'</span>),
095          r(tau+1)=mean(tmp(~isnan(tmp))); <span class="comment">% unbiased estimate</span>
096       <span class="keyword">else</span>
097          r(tau+1)=sum(tmp(~isnan(tmp)))/Ncens; <span class="comment">% biased estimate</span>
098       <span class="keyword">end</span>
099    <span class="keyword">end</span>
100 <span class="keyword">else</span> 
101    <span class="keyword">if</span> any(indnan)
102       x(indnan)=0; <span class="comment">% pab 09.10.2000 much faster for censored samples</span>
103    <span class="keyword">end</span>
104    <span class="keyword">if</span> 1, <span class="comment">% If you haven't got the signal toolbox use this</span>
105      nfft=2^nextpow2(n) ;
106      Rper=abs(fft(x,nfft)).^2/Ncens; <span class="comment">% Raw periodogram</span>
107      <span class="comment">%plot(Rper)<span class="comment">%,size(Rper),n,nfft</span></span>
108           
109      r=real(fft(Rper))/nfft ; <span class="comment">%ifft=fft/nfft since Rper is real!</span>
110       
111      <span class="keyword">if</span> strcmpi(flag,<span class="string">'unbiased'</span>),
112            <span class="comment">% unbiased result, i.e. divide by n-abs(lag)</span>
113          r=r(1:L+1)*Ncens./ (Ncens:-1:Ncens-L)';
114      <span class="comment">%else  <span class="comment">% biased result, i.e. divide by n</span></span>
115      <span class="comment">%   r=r(1:L+1)/Ncens;</span>
116      <span class="keyword">end</span>
117 
118   <span class="keyword">else</span> <span class="comment">% If you have got the signal toolbox use this </span>
119     r=xcorr(x,L,flag);
120     r=(r((L+1):<span class="keyword">end</span>))'; 
121   <span class="keyword">end</span>  
122 <span class="keyword">end</span>
123 
124 c0     = r(1);
125 corr.R = r(1:(L+1))/c0; <span class="comment">%normalizing</span>
126 corr.t = (0:L)'*dT;
127 
128 corr.stdev=sqrt(1/Ncens*[ 0; 1 ;(1+2*cumsum(corr.R(2:L).^2))]);
129 
130 <span class="keyword">if</span> ((plotflag&gt;0) ),
131   <a href="covplot.html" class="code" title=" Plots the auto covariance function (ACF) 1D or 2D. ">covplot</a>(corr,L,plotflag)
132 <span class="keyword">end</span>
133 
134 <span class="keyword">return</span>
135 
136 <span class="keyword">function</span> [x,L,plotflag,dT,flag,n] = <a name="_sub1" href="#_subfunctions" class="code">dat2corchk</a>(P,xn,Na)
137 <span class="comment">% DAT2CORCHK Helper function for dat2cor.</span>
138 <span class="comment">%</span>
139 <span class="comment">% CALL  [x2,L,plotflag,dT,flag,n]=dat2corchk(P,x1) </span>
140 <span class="comment">%</span>
141 <span class="comment">%   P = the cell array P of input arguments (between 0 and 7 elements)</span>
142 <span class="comment">%   x = a vector.</span>
143 
144 
145 x=xn;
146 [n m]= size(x);
147 
148 <span class="keyword">if</span> n&lt;m
149  b=m;m=n;n=b; 
150  x=x';
151 <span class="keyword">end</span>
152 
153 <span class="keyword">if</span> n&lt;2, 
154   error(<span class="string">'The vector must have more than 2 elements!'</span>)
155 <span class="keyword">end</span>
156 
157 <span class="comment">% Default values</span>
158 <span class="comment">%~~~~~~~~~~~~~~~~  </span>
159 flag = <span class="string">'biased'</span>;
160 plotflag = 0;
161 dT=[]; <span class="comment">% sampling frequency unknown</span>
162 L=n-1;
163    <span class="comment">% if n&lt;400</span>
164 <span class="comment">%    L=floor(n/2);</span>
165 <span class="comment">%  else</span>
166 <span class="comment">%    L=floor(12*sqrt(n));</span>
167 <span class="comment">%  end</span>
168 
169 
170 
171 
172 Np=length(P);
173 strix=zeros(1,Np);
174 <span class="keyword">for</span> ix=1:Np, <span class="comment">% finding symbol strings </span>
175  strix(ix)=ischar(P{ix});
176 <span class="keyword">end</span>
177 
178 
179 k=find(strix);
180 <span class="keyword">if</span> any(k)
181   flag = P{k(1)};
182   Np   = Np-1;
183   P={P{find(~strix)}};
184 <span class="keyword">end</span>
185 
186 
187 <span class="keyword">if</span> Np&gt;0 &amp; ~isempty(P{1}), L=P{1}; <span class="keyword">end</span>
188 <span class="keyword">if</span> Np&gt;1 &amp; ~isempty(P{2}), plotflag=P{2}; <span class="keyword">end</span>
189 <span class="keyword">if</span> Np&gt;2 &amp; ~isempty(P{3}), dT=P{3}; <span class="keyword">end</span>
190 
191 <span class="keyword">if</span> (Na == 0)&amp;plotflag==0
192   plotflag=3;
193 <span class="keyword">end</span>
194 <span class="keyword">if</span> plotflag&gt;3, 
195   error(<span class="string">'Invalid option. Plotflag can only be 0,1,2 or 3'</span>)
196 <span class="keyword">end</span>
197  <span class="keyword">switch</span> m
198  <span class="keyword">case</span> 1, x=x(:); <span class="keyword">if</span> isempty(dT),dT=1;<span class="keyword">end</span>
199  <span class="keyword">case</span> 2,  dT=x(2,1)-x(1,1);x=x(:,2);
200  <span class="keyword">otherwise</span>, error(<span class="string">'Wrong dimension of input! dim must be 2xN, 1xN, Nx2 or Nx1 '</span>) 
201               
202 <span class="keyword">end</span>
203 <span class="keyword">return</span>
204</pre></div>
<HR noShade>
<SMALL><A href="http://www.maths.lth.se/matstat/">Mathematical 
Statistics</A><BR><A href="http://www.maths.lth.se/">Centre for Mathematical 
Sciences</A><BR><A href="http://www.lu.se/">Lund University</A> with <A 
href="http://www.lth.se/">Lund Institute of Technology</A> </SMALL>
<P><SMALL>Comments or corrections to the <A
href="mailto:wafo@maths.lth.se">WAFO group</A>  </P>

<hr><address>Generated on Thu 06-Oct-2005 02:21:16
 for <strong><A href="http://www.maths.lth.se/matstat/wafo/">WAFO</A></strong>
 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>