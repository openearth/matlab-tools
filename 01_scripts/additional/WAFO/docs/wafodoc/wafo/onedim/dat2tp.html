<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>WAFO. Description of dat2tp</title>
  <meta name="keywords" content="dat2tp">
  <meta name="description" content=" Extracts turning points from data,">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="../index.html">wafo</a> &gt; <a href="index.html">onedim</a> &gt; dat2tp.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for wafo\onedim&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>dat2tp
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong> Extracts turning points from data,</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong> [tp, ind] = data2tp(x,h,wdef); </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> <a href="dat2tp.html" class="code" title=" Extracts turning points from data,">DAT2TP</a> Extracts turning points from data,
         optionally rainflowfiltered. 
 
  CALL:  [tp ind] = <a href="dat2tp.html" class="code" title=" Extracts turning points from data,">dat2tp</a>(x,h,wdef);
 
     x  = two column data matrix with sampled times and values.
 
     tp = a two column matrix with times and turning points.
 
    ind = indices to the turning points in the original sequence.
 
     h  = a threshold; 
          if  h&lt;0, then  tp=x; 
          if  h=0, then  tp  is a sequence of turning points (default); 
          if  h&gt;0, then all rainflow cycles with height smaller than
                   h  are removed.
 
   wdef = defines the type of wave. Possible options are
       'mw' 'Mw' or 'none'. (Default 'none').
          If wdef='none' all rainflow filtered min and max 
          will be returned, otherwise only the rainflow filtered 
          min and max  which define a wave according to the 
          wave definition will be returned.
 
  Example:
    x  = load('sea.dat'); x1 = x(1:200,:);
    tp = <a href="dat2tp.html" class="code" title=" Extracts turning points from data,">dat2tp</a>(x1,0,'Mw'); tph = <a href="dat2tp.html" class="code" title=" Extracts turning points from data,">dat2tp</a>(x1,0.3,'Mw');
    plot(x1(:,1),x1(:,2),tp(:,1),tp(:,2),'ro',tph(:,1),tph(:,2),'k*')
  
   See also  <a href="findcross.html" class="code" title=" Finds indices to level v up and downcrossings of a vector">findcross</a>, <a href="findrfc.html" class="code" title=" Finds indices to rainflow cycles of a sequence of TP. ">findrfc</a>, <a href="../../wafo/cycles/tp2rfc.html" class="code" title=" Finds the rainflow cycles from the sequence of turning points.">tp2rfc</a>, <a href="dat2tc.html" class="code" title=" Extracts troughs and crests from data.">dat2tc</a></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<TABLE BORDER=0>

<TR>
<TD><li><a href="findextrema.html" class="code" title=" ind = findextrema(x)">findextrema</a></li></TD>
<TD> Finds indices to minima and maxima of data</TD>
</TR>
<TR>
<TD><li><a href="findrfc.html" class="code" title=" ind=findrfc(tp,h)">findrfc</a></li></TD>
<TD> Finds indices to rainflow cycles of a sequence of TP.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\lang\error.m">error</a></li></TD>
<TD>         Display message and abort function.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\strfun\@char\strcmp.bi">strcmp</a></li></TD>
<TD>        Compare strings.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\ops\@double\xor.bi">xor</a></li></TD>
<TD>           Logical EXCLUSIVE OR.</TD>
</TR>
</TABLE>
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<TABLE BORDER=0>

<TR>
<TD><li><a href="../../wafo/papers/tutorcom/Chapter1.html" class="code" title="This is a script file.">Chapter1</a></li></TD>
<TD> % CHAPTER1 demonstrates some applications of WAFO</TD>
</TR>
<TR>
<TD><li><a href="../../wafo/papers/tutorcom/Chapter2.html" class="code" title="This is a script file.">Chapter2</a></li></TD>
<TD> % CHAPTER2 Modelling random loads and stochastic waves</TD>
</TR>
<TR>
<TD><li><a href="../../wafo/papers/tutorcom/Chapter3.html" class="code" title="This is a script file.">Chapter3</a></li></TD>
<TD> % CHAPTER3  Demonstrates distributions of wave characteristics</TD>
</TR>
<TR>
<TD><li><a href="../../wafo/papers/tutorcom/Chapter4.html" class="code" title="This is a script file.">Chapter4</a></li></TD>
<TD> % CHAPTER4 contains the commands used in Chapter 4 of the tutorial</TD>
</TR>
<TR>
<TD><li><a href="dat2lc.html" class="code" title=" lc = dat2lc(x,h,def);">dat2lc</a></li></TD>
<TD> Extracts level-crossing spectrum from data,</TD>
</TR>
<TR>
<TD><li><a href="dat2midind.html" class="code" title=" ind2=dat2midind(x,p,ind,h)">dat2midind</a></li></TD>
<TD> Finds indices to midpoints between a min and Max and Max and min.</TD>
</TR>
<TR>
<TD><li><a href="../../wafo/trgauss/dat2tr.html" class="code" title=" [g, test, cmax, irr, g2]= dat2tr(x,def,varargin);">dat2tr</a></li></TD>
<TD> Estimate transformation, g, from data.</TD>
</TR>
<TR>
<TD><li><a href="dat2wa.html" class="code" title=" [T, index,ind] = dat2wa(xn,h,pdef,wdef,rate)">dat2wa</a></li></TD>
<TD> Extracts sequence of wavelengths from data.</TD>
</TR>
<TR>
<TD><li><a href="../../wafo/wdemos/democc.html" class="code" title="This is a script file.">democc</a></li></TD>
<TD> A program for visualization of cycle counts in random</TD>
</TR>
<TR>
<TD><li><a href="../../wafo/misc/findpeaks.html" class="code" title=" [indx, indy] = findpeaks(S,Np,min_h,min_p)">findpeaks</a></li></TD>
<TD> find peaks of vector or matrix possibly rainflow filtered</TD>
</TR>
<TR>
<TD><li><a href="../../wafo/wdemos/itmkurs/itmkurs_lab1.html" class="code" title="This is a script file.">itmkurs_lab1</a></li></TD>
<TD> Script to computer exercises 1</TD>
</TR>
<TR>
<TD><li><a href="../../wafo/wdemos/itmkurs/itmkurs_lab2.html" class="code" title="This is a script file.">itmkurs_lab2</a></li></TD>
<TD> Script to computer exercises 2</TD>
</TR>
<TR>
<TD><li><a href="../../wafo/wdemos/itmkurs/itmkurs_lab3.html" class="code" title="This is a script file.">itmkurs_lab3</a></li></TD>
<TD> Script to computer exercises 3</TD>
</TR>
<TR>
<TD><li><a href="../../wafo/wdemos/itmkurs/itmkurs_lab4.html" class="code" title="This is a script file.">itmkurs_lab4</a></li></TD>
<TD> Script to computer exercises 4</TD>
</TR>
<TR>
<TD><li><a href="../../wafo/wdemos/rfcdemo1.html" class="code" title=" [F_RFC] = refdemo1(demoNr,P,A,m,s2,param)">rfcdemo1</a></li></TD>
<TD>  Demo for switching AR(1)-processes.</TD>
</TR>
<TR>
<TD><li><a href="../../wafo/wdemos/rfcdemo2.html" class="code" title=" [F_RFC] = refdemo2(demoNr,P,param,x0,s,lam)">rfcdemo2</a></li></TD>
<TD> Rainflow matrix for Switching Markov Chains of Turning Points.</TD>
</TR>
<TR>
<TD><li><a href="../../wafo/cycles/test/test_cycles.html" class="code" title="This is a script file.">test_cycles</a></li></TD>
<TD> Quick test of the routines in module 'cycles'</TD>
</TR>
<TR>
<TD><li><a href="../../wafo/papers/wafodemo/wafofig9.html" class="code" title=" wafofig9">wafofig9</a></li></TD>
<TD>  Intensity of rainflow cycles computed from St</TD>
</TR>
</TABLE>

</ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>001 <span class="keyword">function</span> [tp, ind] = data2tp(x,h,wdef);
002 <span class="comment">%DAT2TP Extracts turning points from data,</span>
003 <span class="comment">%        optionally rainflowfiltered. </span>
004 <span class="comment">%</span>
005 <span class="comment">% CALL:  [tp ind] = dat2tp(x,h,wdef);</span>
006 <span class="comment">%</span>
007 <span class="comment">%    x  = two column data matrix with sampled times and values.</span>
008 <span class="comment">%</span>
009 <span class="comment">%    tp = a two column matrix with times and turning points.</span>
010 <span class="comment">%</span>
011 <span class="comment">%   ind = indices to the turning points in the original sequence.</span>
012 <span class="comment">%</span>
013 <span class="comment">%    h  = a threshold; </span>
014 <span class="comment">%         if  h&lt;0, then  tp=x; </span>
015 <span class="comment">%         if  h=0, then  tp  is a sequence of turning points (default); </span>
016 <span class="comment">%         if  h&gt;0, then all rainflow cycles with height smaller than</span>
017 <span class="comment">%                  h  are removed.</span>
018 <span class="comment">%</span>
019 <span class="comment">%  wdef = defines the type of wave. Possible options are</span>
020 <span class="comment">%      'mw' 'Mw' or 'none'. (Default 'none').</span>
021 <span class="comment">%         If wdef='none' all rainflow filtered min and max </span>
022 <span class="comment">%         will be returned, otherwise only the rainflow filtered </span>
023 <span class="comment">%         min and max  which define a wave according to the </span>
024 <span class="comment">%         wave definition will be returned.</span>
025 <span class="comment">%</span>
026 <span class="comment">% Example:</span>
027 <span class="comment">%   x  = load('sea.dat'); x1 = x(1:200,:);</span>
028 <span class="comment">%   tp = dat2tp(x1,0,'Mw'); tph = dat2tp(x1,0.3,'Mw');</span>
029 <span class="comment">%   plot(x1(:,1),x1(:,2),tp(:,1),tp(:,2),'ro',tph(:,1),tph(:,2),'k*')</span>
030 <span class="comment">% </span>
031 <span class="comment">%  See also  findcross, findrfc, tp2rfc, dat2tc</span>
032 
033 <span class="comment">% Tested on: matlab 6.0, 5.3, 5.2, 5.1</span>
034 
035 <span class="comment">% History:</span>
036 <span class="comment">% revised pab oct 2005</span>
037 <span class="comment">% -replaced some code with a call to findextrema</span>
038 <span class="comment">% revised pab Feb2004  </span>
039 <span class="comment">% Revised by jr 03.04.2001</span>
040 <span class="comment">% - added example, updated info </span>
041 <span class="comment">% Modified by Per A. Brodtkorb 07.08.98</span>
042 <span class="comment">% This is a modified version which is about 20 to 30 times faster than  </span>
043 <span class="comment">% the version of dat2tp in WAT (performance on a pentiumII 233 MHz  </span>
044 <span class="comment">% with 32 MB ram and Matlab 5.0 under Linux). The reason is</span>
045 <span class="comment">% that this version does not save x to disk. Instead it passes </span>
046 <span class="comment">% the arguments directly to the executeable file. </span>
047 <span class="comment">% This new version is also more flexible. It is able to return the </span>
048 <span class="comment">% indices to the turningpoints </span>
049 <span class="comment">% (This is useful when determining the wave steepness etc...). </span>
050 
051 error(nargchk(1,3,nargin))
052 
053 xn = x;
054 [n m]= size(xn);
055 <span class="keyword">if</span> n&lt;m
056   b=m;m=n;n=b; 
057   xn=xn';
058 <span class="keyword">end</span>
059 
060 <span class="keyword">if</span> n&lt;2, 
061   error(<span class="string">'The vector must have more than 2 elements!'</span>)
062 <span class="keyword">end</span>
063 
064 istime=1;
065 
066 <span class="keyword">switch</span> m
067   <span class="keyword">case</span> 1, x2=xn; istime=0;
068   <span class="keyword">case</span> 2, x2=xn(:,2);<span class="comment">% dimension OK!</span>
069   <span class="keyword">otherwise</span>, error(<span class="string">'Wrong dimension of input! dim must be 2xN, 1xN, Nx2 or Nx1 '</span>)          
070 <span class="keyword">end</span>
071 
072 <span class="keyword">if</span> ((nargin&lt;3) | isempty(wdef)),
073   wdef=<span class="string">'none'</span>;
074 <span class="keyword">end</span>
075 
076 <span class="keyword">if</span> (nargin&lt;2) | isempty(h),
077    h=0;
078 <span class="keyword">end</span>
079 
080 <span class="keyword">if</span> h&lt;0 
081   tp=xn; 
082   ind=(1:n)';
083   disp(<span class="string">'Warning: h&lt;0, the original data is returned'</span>)
084   <span class="keyword">return</span>   
085 <span class="keyword">end</span>            
086 
087 ind = <a href="findextrema.html" class="code" title=" Finds indices to minima and maxima of data ">findextrema</a>(x2);
088 
089 <span class="keyword">if</span> length(ind)&lt;2, 
090   tp=[];
091   <span class="keyword">return</span>;
092 <span class="keyword">end</span>
093 
094 <span class="comment">% In order to get the exact up-crossing intensity from rfc by </span>
095 <span class="comment">% mm2lc(tp2mm(rfc))  we have to add the indices</span>
096 <span class="comment">% to the last value (and also the first if the </span>
097 <span class="comment">% sequence of turning points does not start with a minimum).</span>
098 
099 <span class="keyword">if</span>  x2(ind(1))&gt;x2(ind(2)),        
100  <span class="comment">% adds indices to  first and last value</span>
101  ind=[1; ind ;n]; 
102 <span class="keyword">else</span> <span class="comment">%adds index to the last value</span>
103  ind=[ind; n];
104 <span class="keyword">end</span>
105 
106 <span class="keyword">if</span> h&gt;0 
107    ind1 = <a href="findrfc.html" class="code" title=" Finds indices to rainflow cycles of a sequence of TP. ">findrfc</a>(x2(ind),h);
108    ind  = ind(ind1);
109 <span class="keyword">end</span> 
110 
111 
112 Nm=length(ind); <span class="comment">% number of min and Max</span>
113 
114 
115 <span class="keyword">switch</span> wdef  <span class="comment">% switch wdef</span>
116  <span class="keyword">case</span> {<span class="string">'mw'</span>,<span class="string">'Mw'</span>},
117    <span class="comment">% make sure that the first is a Max if wdef == 'Mw'</span>
118    <span class="comment">% or make sure that the first is a min if wdef == 'mw'</span>
119    <span class="keyword">if</span> xor((xn(ind(1))&gt;(xn(ind(2)))),strcmp(wdef,<span class="string">'Mw'</span>)),
120      ind=ind(2:Nm);
121      Nm=Nm-1;
122    <span class="keyword">end</span>
123 
124    <span class="comment">% make sure the number of minima and Maxima are according to the wavedef.</span>
125    <span class="comment">% i.e., make sure Nm=length(ind) is odd</span>
126    <span class="keyword">if</span> ~(mod(Nm,2)), <span class="comment">% if Nm is even do</span>
127      ind(Nm)=[];
128      Nm=Nm-1;
129    <span class="keyword">end</span>    
130    
131  <span class="keyword">case</span> {<span class="string">'none'</span>}<span class="comment">% do nothing</span>
132  <span class="keyword">otherwise</span>, error(<span class="string">'Unknown wave definition'</span>) 
133 <span class="keyword">end</span>
134 
135 tp=xn(ind,:);
136 
137</pre></div>
<HR noShade>
<SMALL><A href="http://www.maths.lth.se/matstat/">Mathematical 
Statistics</A><BR><A href="http://www.maths.lth.se/">Centre for Mathematical 
Sciences</A><BR><A href="http://www.lu.se/">Lund University</A> with <A 
href="http://www.lth.se/">Lund Institute of Technology</A> </SMALL>
<P><SMALL>Comments or corrections to the <A
href="mailto:wafo@maths.lth.se">WAFO group</A>  </P>

<hr><address>Generated on Thu 06-Oct-2005 02:21:16
 for <strong><A href="http://www.maths.lth.se/matstat/wafo/">WAFO</A></strong>
 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>