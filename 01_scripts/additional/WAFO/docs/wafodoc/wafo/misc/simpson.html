<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>WAFO. Description of simpson</title>
  <meta name="keywords" content="simpson">
  <meta name="description" content=" Numerical integration with the Simpson method">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="../index.html">wafo</a> &gt; <a href="index.html">misc</a> &gt; simpson.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for wafo\misc&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>simpson
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong> Numerical integration with the Simpson method</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong> [area,epsi,a,b] = simpson(x,f,dim) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment">  <a href="simpson.html" class="code" title=" Numerical integration with the Simpson method">SIMPSON</a> Numerical integration with the <a href="simpson.html" class="code" title=" Numerical integration with the Simpson method">Simpson</a> method
 
  CALL: [area,epsi,a,b] = <a href="simpson.html" class="code" title=" Numerical integration with the Simpson method">simpson</a>(x,f,dim)
        [area,epsi,a,b] = <a href="simpson.html" class="code" title=" Numerical integration with the Simpson method">simpson</a>(f,dim)
 
     area = result, approximative integral
     epsi = estimate of the absolute error
     a,b  = integration limits
       x  = argument of function (vector or matrix, see below)
       f  = function (vector or matrix, see below)
      dim = dimension to integrate 
 
  Evaluates an approximation of the integral of the
  vector function F(x) wrt X from A to B using the <a href="simpson.html" class="code" title=" Numerical integration with the Simpson method">Simpson</a> method. 
 
  X and F must be vectors of the same length,
  OR X must be a vector and F an array whose first non-singleton
  dimension is length(X), then <a href="simpson.html" class="code" title=" Numerical integration with the Simpson method">SIMPSON</a> operates along this dimension.
  OR, if X is an array with the same dimension as F the integration
  is performed column-wise. If DIM is given <a href="simpson.html" class="code" title=" Numerical integration with the Simpson method">SIMPSON</a> integrates across
  dimension DIM of F. The length of X must be the same as size(F,DIM)).
 
  Notice that if N = length(F) is an even number,
  <a href="simpson.html" class="code" title=" Numerical integration with the Simpson method">SIMPSON</a> is used on the N-1 first values and the Trapezoidal rule 
  on the two last values. If X is not equidistant
  spaced use TRAPZ instead.
 
  Example:%
           x = linspace(0,4,201);
           f = exp(-x.^2);
           [area,epsi] = <a href="simpson.html" class="code" title=" Numerical integration with the Simpson method">simpson</a>(x,f)
 
  See also  trapz</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<TABLE BORDER=0>

<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\lang\error.m">error</a></li></TD>
<TD>         Display message and abort function.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\robust\robust\@umat\ipermute.m">ipermute</a></li></TD>
<TD>      Inverse permute array dimensions.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\strfun\num2str.m">num2str</a></li></TD>
<TD>       Convert number to string. (Fast version)</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\elmat\@char\permute.bi">permute</a></li></TD>
<TD>       Permute array dimensions.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\elmat\shiftdim.m">shiftdim</a></li></TD>
<TD>      Shift dimensions.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\robust\robust\@umat\squeeze.m">squeeze</a></li></TD>
<TD>       Remove singleton dimensions.</TD>
</TR>
</TABLE>
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<TABLE BORDER=0>

<TR>
<TD><li><a href="../../wafo/papers/tutorcom/Chapter3.html" class="code" title="This is a script file.">Chapter3</a></li></TD>
<TD> % CHAPTER3  Demonstrates distributions of wave characteristics</TD>
</TR>
<TR>
<TD><li><a href="../../wafo/spec/private/dir2enc.html" class="code" title=" Snew=dir2enc(S,d,v)">dir2enc</a></li></TD>
<TD> Transform a dir. spectrum to an encountered. (Used in spec2spec)</TD>
</TR>
<TR>
<TD><li><a href="../../wafo/spec/private/dir2k1d.html" class="code" title=" Snew=dir2k1d(S);">dir2k1d</a></li></TD>
<TD> Transforms directional spectrum to wavenumber spectrum.</TD>
</TR>
<TR>
<TD><li><a href="../../wafo/spec/dspec2char.html" class="code" title=" [ch,chtext] = dspec2char(S,varargin)">dspec2char</a></li></TD>
<TD> Evaluates directional spectral characteristics</TD>
</TR>
<TR>
<TD><li><a href="../../wafo/spec/private/dspec2dcov.html" class="code" title=" R=dspec2dcov(S,nr,Nt,rate,Nx,Ny,dx,dy)">dspec2dcov</a></li></TD>
<TD> Return covariance function given a directional spectrum</TD>
</TR>
<TR>
<TD><li><a href="../../wafo/multidim/fourier.html" class="code" title=" [a,b]=fourier(t,x,T,M,N);">fourier</a></li></TD>
<TD> Returns Fourier coefficients.</TD>
</TR>
<TR>
<TD><li><a href="../../wafo/multidim/private/getcrossspectra.html" class="code" title=" Sxy = getCrossSpectra(thetai,Gwt,DS)">getcrossspectra</a></li></TD>
<TD> Compute the cross spectra by integration</TD>
</TR>
<TR>
<TD><li><a href="../../wafo/multidim/private/imlm.html" class="code" title=" DS = imlm(Sxy,Gwt,thetai,fi,k,opt)">imlm</a></li></TD>
<TD>  Iterated maximum likelihood method for estimating the directional distribution</TD>
</TR>
<TR>
<TD><li><a href="../../wafo/spec/jonswap.html" class="code" title=" S1 = jonswap(w1,sdata,plotflag)">jonswap</a></li></TD>
<TD> Calculates (and plots) a JONSWAP spectral density</TD>
</TR>
<TR>
<TD><li><a href="../../wafo/multidim/private/memfun.html" class="code" title=" y = function(x,P1,P2,P3,P4)">memfun</a></li></TD>
<TD> private function for MEM</TD>
</TR>
<TR>
<TD><li><a href="../../wafo/wsim/seasim.html" class="code" title=" [Y,Mv]=seasim(spec,Nx,Ny,Nt,dx,dy,dt,fftdim,plotflag);">seasim</a></li></TD>
<TD> Spectral simulation of a Gaussian sea, 2D (x,t) or 3D (x,y,t)</TD>
</TR>
<TR>
<TD><li><a href="../../wafo/spec/spec2bw.html" class="code" title=" bw = spec2bw(S,fact)">spec2bw</a></li></TD>
<TD> Evaluates some spectral bandwidth and irregularity factors</TD>
</TR>
<TR>
<TD><li><a href="../../wafo/spec/spec2char.html" class="code" title=" [ch,R1,chtext,R]=spec2char(S,fact,T)">spec2char</a></li></TD>
<TD>  Evaluates spectral characteristics and their covariance</TD>
</TR>
<TR>
<TD><li><a href="../../wafo/spec/spec2mom.html" class="code" title=" [m,mtext] = spec2mom(S,nr,vari,even)">spec2mom</a></li></TD>
<TD> Calculates spectral moments from spectrum</TD>
</TR>
<TR>
<TD><li><a href="../../wafo/spec/spec2spec.html" class="code" title=" [Snew]=spec2spec(S,newtype,phi,v)">spec2spec</a></li></TD>
<TD> Transforms between different types of spectra</TD>
</TR>
<TR>
<TD><li><a href="../../wafo/spec/torsethaugen.html" class="code" title=" [S, Sw, Ss]=torsethaugen(w1,sdata,plotflag)">torsethaugen</a></li></TD>
<TD> Calculates a double peaked (swell + wind) spectrum</TD>
</TR>
<TR>
<TD><li><a href="../../wafo/spec/wspecplot.html" class="code" title=" wspecplot(S,varargin)">wspecplot</a></li></TD>
<TD> Plot a spectral density</TD>
</TR>
</TABLE>

</ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>001 <span class="keyword">function</span> [area,epsi,a,b] = <a name="_sub0" href="#_subfunctions" class="code">simpson</a>(x,f,dim)
002 <span class="comment">% SIMPSON Numerical integration with the Simpson method</span>
003 <span class="comment">%</span>
004 <span class="comment">% CALL: [area,epsi,a,b] = simpson(x,f,dim)</span>
005 <span class="comment">%       [area,epsi,a,b] = simpson(f,dim)</span>
006 <span class="comment">%</span>
007 <span class="comment">%    area = result, approximative integral</span>
008 <span class="comment">%    epsi = estimate of the absolute error</span>
009 <span class="comment">%    a,b  = integration limits</span>
010 <span class="comment">%      x  = argument of function (vector or matrix, see below)</span>
011 <span class="comment">%      f  = function (vector or matrix, see below)</span>
012 <span class="comment">%     dim = dimension to integrate </span>
013 <span class="comment">%</span>
014 <span class="comment">% Evaluates an approximation of the integral of the</span>
015 <span class="comment">% vector function F(x) wrt X from A to B using the Simpson method. </span>
016 <span class="comment">%</span>
017 <span class="comment">% X and F must be vectors of the same length,</span>
018 <span class="comment">% OR X must be a vector and F an array whose first non-singleton</span>
019 <span class="comment">% dimension is length(X), then SIMPSON operates along this dimension.</span>
020 <span class="comment">% OR, if X is an array with the same dimension as F the integration</span>
021 <span class="comment">% is performed column-wise. If DIM is given SIMPSON integrates across</span>
022 <span class="comment">% dimension DIM of F. The length of X must be the same as size(F,DIM)).</span>
023 <span class="comment">%</span>
024 <span class="comment">% Notice that if N = length(F) is an even number,</span>
025 <span class="comment">% SIMPSON is used on the N-1 first values and the Trapezoidal rule </span>
026 <span class="comment">% on the two last values. If X is not equidistant</span>
027 <span class="comment">% spaced use TRAPZ instead.</span>
028 <span class="comment">%</span>
029 <span class="comment">% Example:<span class="comment">%</span></span>
030 <span class="comment">%          x = linspace(0,4,201);</span>
031 <span class="comment">%          f = exp(-x.^2);</span>
032 <span class="comment">%          [area,epsi] = simpson(x,f)</span>
033 <span class="comment">%</span>
034 <span class="comment">% See also  trapz</span>
035 
036 <span class="comment">% Tested on: Matlab 5.3</span>
037 <span class="comment">% History:</span>
038 <span class="comment">% revised by pab 14.05.2000</span>
039 <span class="comment">%  - added dim</span>
040 <span class="comment">%  - added trapezoidal rule when lengt(f) is even</span>
041 <span class="comment">%  - changed the documentation according to the new changes.</span>
042 <span class="comment">% revised by es 28.09.1999 (documentation, help)</span>
043 <span class="comment">% by pab 1997, updated 16.06.1998</span>
044 
045 <span class="keyword">if</span> 0 <span class="comment">% Old call</span>
046   <span class="keyword">if</span> nargin&lt;2,
047     f = x;
048     [f,nshift] = shiftdim(f)
049     [nx m]=size(f);
050     fsiz(1)=1;fsiz(2)=1;
051     <span class="keyword">if</span> nx&lt;m
052       tmp=m;m=nx;nx=tmp; 
053       f=f.';
054       <span class="comment">% fsiz(1)=m;  fsiz(2)=1;</span>
055     <span class="keyword">else</span>
056       <span class="comment">%fsiz(1)=1;fsiz(2)=m;</span>
057     <span class="keyword">end</span>
058     <span class="keyword">switch</span> m
059       <span class="keyword">case</span> 1,  a=1;b=nx; bm1=nx-1;
060       <span class="keyword">case</span> 2,  a=f(1,1);b=f(nx,1);bm1=f(nx-1,1); f=f(:,2);
061       <span class="keyword">otherwise</span>, error(<span class="string">'Wrong dimension of input! dim must be 2xN, 1xN, Nx2 or Nx1 '</span>) 
062     <span class="keyword">end</span>
063     m=1;
064   <span class="keyword">end</span>  
065   
066   <span class="keyword">if</span> nargin==2,
067     fsiz=size(f);
068     [n m]=size(f);
069     [nx mx]=size(x);
070     
071     <span class="comment">%make sure x is a column vector</span>
072     <span class="keyword">if</span> nx*mx==n | nx*mx==m  , x=x(:);nx=max(nx,mx);<span class="keyword">end</span> 
073     
074     a=x(1,:);b=x(nx,:);bm1=x(nx-1,:); 
075     <span class="keyword">if</span> nx~=n
076       tmp=m;m=n;n=tmp; 
077       f=f.';
078       fsiz(2)=1;
079       <span class="keyword">if</span> (nx~=n) | (ndims(f)&gt;2)
080     error(<span class="string">'Fx must have dimensions which equals the  size of x '</span>)
081       <span class="keyword">end</span>
082     <span class="keyword">else</span>
083       fsiz(1)=1;
084     <span class="keyword">end</span>
085   <span class="keyword">end</span>  
086   
087 
088   <span class="keyword">if</span> nx&lt;3, 
089     error(<span class="string">'The vector must have more than 3 elements!'</span>)
090   <span class="keyword">end</span>
091   
092   <span class="keyword">if</span> (mod(nx, 2) == 0), <span class="comment">% checking if n is even</span>
093     f(nx,:)=[];
094     nx=nx-1; 
095     
096     disp(<span class="string">'Warning: Changed the integration limits '</span>)
097     disp([<span class="string">'         from '</span> num2str(b) <span class="string">' to '</span> num2str(bm1) ])
098     disp(<span class="string">'         so that the length of f(x) is odd.'</span>)
099     
100     b=bm1;
101   <span class="keyword">end</span>
102   
103   hn=2*(b-a)/(nx-1);
104   
105   
106   <span class="comment">% Midpoint approximation</span>
107   Un=hn.*sum(f(2:2:(nx-1),1:m)); 
108   
109   <span class="comment">% Trapeziodal approximation</span>
110   Tn=hn/2.*(f(1,1:m) + 2*sum(f(3:2:(nx-2),1:m)) + f(nx,1:m)); 
111   
112   <span class="comment">% Simpson's approximation</span>
113   area=(Tn+2*Un)/3; 
114   
115   <span class="comment">% Asymptotically the simpson approximation is a better estimate </span>
116   <span class="comment">% than both Tn and Un. If this is the case, </span>
117   <span class="comment">% then an estimate of the absolute error is</span>
118   
119   epsi = abs(Tn-Un)./4; 
120   <span class="comment">%fsiz</span>
121   <span class="comment">%area</span>
122   area=squeeze(reshape(area,fsiz));
123   epsi=squeeze(reshape(epsi,fsiz));
124   
125   
126 
127 <span class="keyword">else</span> <span class="comment">% NEW CALL</span>
128  
129   perm = []; nshifts = 0;
130   <span class="keyword">if</span> nargin == 3,                 <span class="comment">% simpson(x,f,dim)</span>
131     perm = [dim:max(ndims(f),dim) 1:dim-1];  
132     f = permute(f,perm);
133   <span class="keyword">elseif</span> nargin==2 &amp; length(f)==1 <span class="comment">% simpson(f,dim)</span>
134     dim = f; f = x; x=[]
135     perm = [dim:max(ndims(f),dim) 1:dim-1];
136     f = permute(f,perm);
137   <span class="keyword">else</span>                            <span class="comment">% simpson(x,f) or simpson(f)</span>
138     <span class="keyword">if</span> nargin &lt; 2, f = x; x=[]; <span class="keyword">end</span>
139     [f,nshifts] = shiftdim(f);
140   <span class="keyword">end</span>
141   
142   fsiz = size(f);
143   m = fsiz(1);
144   <span class="keyword">if</span> m&gt; 5 , n=3;<span class="keyword">else</span>, n=1;<span class="keyword">end</span>
145   <span class="keyword">if</span> isempty(x) <span class="comment">% assume unit spacing</span>
146     a=1;b=m;bmn=m-n;
147   <span class="keyword">else</span>
148     <span class="keyword">if</span> isempty(perm),
149       x = shiftdim(x);
150       xsiz=size(x);
151     <span class="keyword">else</span>
152       xsiz = size(x);
153       <span class="keyword">if</span> prod(xsiz)==prod(fsiz)
154     x = permute(x,perm);
155       <span class="keyword">end</span>
156     <span class="keyword">end</span>
157     <span class="keyword">if</span> xsiz(1) ~= m
158       error(<span class="string">'length(x) must equal length of first non-singleton dim of f.'</span>);
159     <span class="keyword">end</span>
160     a =x(1,:);b=x(m,:);
161     bmn=x(m-n,:); 
162   <span class="keyword">end</span>
163     
164   <span class="keyword">if</span> m&lt;3, 
165     error(<span class="string">'The vector must have more than 3 elements!'</span>)
166   <span class="keyword">end</span>
167   
168   <span class="keyword">if</span> (mod(m, 2) == 0), <span class="comment">% checking if m is even</span>
169     
170     <span class="keyword">if</span> n==1 <span class="comment">% Use trapezoidal  from bmn to b</span>
171       area = (f(m,:)+f(m-1,:))/2.*(b-bmn); 
172     <span class="keyword">else</span>    <span class="comment">% Use 4-points Newton-Cotes rule</span>
173       area = (f(m,:)+3*(f(m-1,:)+f(m-2,:))+ f(m-3,:))/8.*(b-bmn); 
174     <span class="keyword">end</span>
175     m = m-n;     
176     hn=2*(bmn-a)/(m-1);
177   <span class="keyword">else</span>
178     area = 0;
179     hn=2*(b-a)/(m-1);
180   <span class="keyword">end</span>
181   
182   <span class="comment">% Midpoint approximation</span>
183   Un = hn.*sum(f(2:2:(m-1),:)); 
184   
185   <span class="comment">% Trapeziodal approximation</span>
186   Tn = hn/2.*(f(1,:) + 2*sum(f(3:2:(m-2),:)) + f(m,:)); 
187   
188   <span class="comment">% Simpson's approximation</span>
189   area = area+(Tn+2*Un)/3; 
190   
191   <span class="comment">% Asymptotically the simpson approximation is a better estimate </span>
192   <span class="comment">% than both Tn and Un. If this is the case, </span>
193   <span class="comment">% then an estimate of the absolute error is</span>
194   <span class="keyword">if</span> nargout&gt;1,  epsi = abs(Tn-Un)/4; <span class="keyword">end</span>
195   
196   fsiz(1) = 1;
197   area = reshape(area,[ones(1,nshifts),fsiz]);
198   <span class="keyword">if</span> ~isempty(perm), area = ipermute(area,perm); <span class="keyword">end</span>
199 <span class="keyword">end</span>
200</pre></div>
<HR noShade>
<SMALL><A href="http://www.maths.lth.se/matstat/">Mathematical 
Statistics</A><BR><A href="http://www.maths.lth.se/">Centre for Mathematical 
Sciences</A><BR><A href="http://www.lu.se/">Lund University</A> with <A 
href="http://www.lth.se/">Lund Institute of Technology</A> </SMALL>
<P><SMALL>Comments or corrections to the <A
href="mailto:wafo@maths.lth.se">WAFO group</A>  </P>

<hr><address>Generated on Thu 06-Oct-2005 02:21:16
 for <strong><A href="http://www.maths.lth.se/matstat/wafo/">WAFO</A></strong>
 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>