<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>WAFO. Description of wafofig5</title>
  <meta name="keywords" content="wafofig5">
  <meta name="description" content="  Joint distribution (pdf) of crest front velocity and wave height:">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="../../index.html">wafo</a> &gt; <a href="../index.html">papers</a> &gt; <a href="index.html">wafodemo</a> &gt; wafofig5.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for wafo\papers\wafodemo&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>wafofig5
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>  Joint distribution (pdf) of crest front velocity and wave height:</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong> wafofig5 </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">  <a href="wafofig5.html" class="code" title="  Joint distribution (pdf) of crest front velocity and wave height:">WAFOFIG5</a>  Joint distribution (pdf) of crest front velocity and wave height:
            Theoretical joint density of Vcf and 2*Ac (solid), 
            kernel density estimate (dash) of Vcf and Hd
            data from Gullfaks C in the North <a href="../../../wafo/data/sea.html" class="code" title=" Surface elevation dataset used in WAT version 1.1.">Sea</a> (dots)
  
           ( Increase NNp and Nh to get a smoother theoretical distribution.
            This may increase the computational time dramatically)</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<TABLE BORDER=0>

<TR>
<TD><li><a href="../../../wafo/onedim/dat2spec.html" class="code" title=" [S,fcut] = dat2spec(xn,varargin)">dat2spec</a></li></TD>
<TD> Estimate one-sided spectral density from data.</TD>
</TR>
<TR>
<TD><li><a href="../../../wafo/onedim/dat2steep.html" class="code" title=" [S , H,AC1,AT1,TFRONT1,TREAR1,z_ind2,xn2]=dat2steep(xx,rate,method)">dat2steep</a></li></TD>
<TD> Extracts waveheights and steepnesses from data.</TD>
</TR>
<TR>
<TD><li><a href="../../../wafo/kdetools/evalpdf.html" class="code" title=" fi = evalpdf(pdf,varargin)">evalpdf</a></li></TD>
<TD> evaluates a PDF struct by interpolation</TD>
</TR>
<TR>
<TD><li><a href="../../../wafo/kdetools/kdebin.html" class="code" title=" f = kdebin(A,options,xlo,xup)">kdebin</a></li></TD>
<TD> Binned Kernel Density Estimator.</TD>
</TR>
<TR>
<TD><li><a href="../../../wafo/kdetools/kdeoptset.html" class="code" title=" options = kdeoptset(varargin)">kdeoptset</a></li></TD>
<TD> Create or alter KDE OPTIONS structure.</TD>
</TR>
<TR>
<TD><li><a href="../../../wafo/trgauss/pdfplot.html" class="code" title=" H1=pdfplot(f,varargin)">pdfplot</a></li></TD>
<TD> Plot contents of pdf structures</TD>
</TR>
<TR>
<TD><li><a href="../../../wafo/kdetools/qlevels.html" class="code" title=" [ui, p]=qlevels(pdf,p,x1,x2)">qlevels</a></li></TD>
<TD> Calculates quantile levels which encloses P% of PDF</TD>
</TR>
<TR>
<TD><li><a href="../../../wafo/kdetools/qlevels2.html" class="code" title=" [q, p]=qlevels2(r,p,method)">qlevels2</a></li></TD>
<TD> Calculates quantile levels which encloses P% of data</TD>
</TR>
<TR>
<TD><li><a href="../../../wafo/trgauss/rindoptset.html" class="code" title=" options = rindoptset(varargin)">rindoptset</a></li></TD>
<TD> Create or alter RIND OPTIONS structure.</TD>
</TR>
<TR>
<TD><li><a href="../../../wafo/misc/smooth.html" class="code" title=" [yy,coefs]= smooth(x,y,p,xx,LinExtrap,d2)">smooth</a></li></TD>
<TD> Calculates a smoothing spline.</TD>
</TR>
<TR>
<TD><li><a href="../../../wafo/trgauss/spec2thpdf.html" class="code" title=" f = spec2thpdf(spec,utc,def,paramt,h,options,plotflag)">spec2thpdf</a></li></TD>
<TD> Joint density of amplitude and period/wave-length characteristics</TD>
</TR>
<TR>
<TD><li><a href="../../../wafo/trgauss/tranproc.html" class="code" title=" y = tranproc(x,ff)">tranproc</a></li></TD>
<TD> Transforms process X and up to four derivatives</TD>
</TR>
<TR>
<TD><li><a href="../../../wafo/misc/wafostamp.html" class="code" title=" [H,ax]=wafostamp(varargin)">wafostamp</a></li></TD>
<TD> Prints a caption "made by WAFO" in current figure.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\imaq\imaq\private\clear.m">clear</a></li></TD>
<TD>         Clear variables and functions from memory.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\timefun\datestr.m">datestr</a></li></TD>
<TD>       String representation of date.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\strfun\findstr.bi">findstr</a></li></TD>
<TD>       Find one string within another.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\graphics\hold.m">hold</a></li></TD>
<TD>          Hold current graph.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\polyfun\interp1.m">interp1</a></li></TD>
<TD>       1-D interpolation (table lookup)</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\graph2d\@fighandle\isfield.m">isfield</a></li></TD>
<TD>       True if field is in structure array.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\elmat\linspace.m">linspace</a></li></TD>
<TD>      Linearly spaced vector.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\elmat\meshgrid.m">meshgrid</a></li></TD>
<TD>      X and Y arrays for 3-D plots.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\timefun\now.m">now</a></li></TD>
<TD>           Current date and time as date number.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\strfun\num2str.m">num2str</a></li></TD>
<TD>       Convert number to string. (Fast version)</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\ident\ident\@iddata\plot.m">plot</a></li></TD>
<TD>          Linear plot.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\lang\warning.m">warning</a></li></TD>
<TD>       Display warning message; disable or enable warning messages.</TD>
</TR>
</TABLE>
</ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<TABLE BORDER=0>

</TABLE>

</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="#_sub1" class="code"> f2 = th2vhpdf(f,v)</a></li></ul>
<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>001 <span class="keyword">function</span> <a name="_sub0" href="#_subfunctions" class="code">wafofig5</a>
002 <span class="comment">% WAFOFIG5  Joint distribution (pdf) of crest front velocity and wave height:</span>
003 <span class="comment">%           Theoretical joint density of Vcf and 2*Ac (solid), </span>
004 <span class="comment">%           kernel density estimate (dash) of Vcf and Hd</span>
005 <span class="comment">%           data from Gullfaks C in the North Sea (dots)</span>
006 <span class="comment">% </span>
007 <span class="comment">%          ( Increase NNp and Nh to get a smoother theoretical distribution.</span>
008 <span class="comment">%           This may increase the computational time dramatically)</span>
009 
010   
011 <span class="comment">% revised pab Feb2005</span>
012 <span class="comment">% -updated call to kdebin</span>
013   
014 <span class="keyword">global</span>  WAFOFIGNUM
015 
016 <span class="keyword">if</span> isempty(WAFOFIGNUM)
017   disp(<span class="string">'You must start wafodemo in order to run this script'</span>)
018   clear <span class="keyword">global</span> WAFOFIGNUM
019   <span class="keyword">return</span>
020 <span class="keyword">end</span>
021 
022 <span class="keyword">global</span> NVcf NHd Nxr Nrate 
023 <span class="keyword">global</span> fTcfAc NNp Nh Nnit Nspeed 
024 <span class="keyword">global</span> kdeVcfHd Nkernel Nhs NL2
025 
026 <span class="keyword">if</span> Nnit&lt;0
027   opt = <a href="../../../wafo/trgauss/rindoptset.html" class="code" title=" Create or alter RIND OPTIONS structure. ">rindoptset</a>(<span class="string">'method'</span>,abs(Nnit),<span class="string">'speed'</span>,Nspeed);
028 <span class="keyword">else</span>
029   opt = <a href="../../../wafo/trgauss/rindoptset.html" class="code" title=" Create or alter RIND OPTIONS structure. ">rindoptset</a>(<span class="string">'method'</span>,0,<span class="string">'nit'</span>,(Nnit),<span class="string">'speed'</span>,Nspeed);
030 <span class="keyword">end</span>
031 <span class="comment">% Only need to calculate Globals which is not empty</span>
032 
033 <span class="comment">% Gullfaks C / North Sea data</span>
034 <span class="comment">% Extract Vcf and Hd</span>
035 <span class="keyword">if</span> isempty(NVcf)
036   [NVcf NHd] = <a href="../../../wafo/onedim/dat2steep.html" class="code" title=" Extracts waveheights and steepnesses from data. ">dat2steep</a>(Nxr,Nrate,0);
037 <span class="keyword">end</span>
038 
039 <span class="comment">% Joint distribution of Tcf and Ac</span>
040 <span class="keyword">if</span> isempty(fTcfAc)
041   Sn=<a href="../../../wafo/onedim/dat2spec.html" class="code" title=" Estimate one-sided spectral density from data.">dat2spec</a>(Nxr);
042   warning([<span class="string">'This takes several  hours to finish ... (1 hour or more depending'</span> <span class="keyword">...</span>
043     <span class="string">' on input parameters and your computer)'</span>])
044   fTcfAc = <a href="../../../wafo/trgauss/spec2thpdf.html" class="code" title=" Joint density of amplitude and period/wave-length characteristics ">spec2thpdf</a>(Sn,0,<span class="string">'TcfAc'</span>,[0 11 NNp],Nh,opt);
045 <span class="keyword">end</span>
046 <span class="comment">% Transform to the joint distribution of Vcf  and 2*Ac</span>
047 fVcf2Ac=<a href="#_sub1" class="code" title="sub  f2 = th2vhpdf(f,v)">th2vhpdf</a>(fTcfAc);
048 
049 
050 <span class="comment">% Kernel density estimate of Vcf and Hd</span>
051 <span class="keyword">if</span> isempty( kdeVcfHd)
052   kopt = <a href="../../../wafo/kdetools/kdeoptset.html" class="code" title=" Create or alter KDE OPTIONS structure. ">kdeoptset</a>(<span class="string">'kernel'</span>,Nkernel,<span class="string">'hs'</span>,Nhs,<span class="string">'L2'</span>,NL2);
053   kdeVcfHd=<a href="../../../wafo/kdetools/kdebin.html" class="code" title=" Binned Kernel Density Estimator. ">kdebin</a>([NVcf, NHd],kopt);
054   
055   <span class="comment">% calculate the levels which encloses fkde.pl percent of the data (v,h)</span>
056   r = <a href="../../../wafo/kdetools/evalpdf.html" class="code" title=" evaluates a PDF struct by interpolation">evalpdf</a>(kdeVcfHd,NVcf, NHd,<span class="string">'linear'</span>);
057   kdeVcfHd.cl = <a href="../../../wafo/kdetools/qlevels2.html" class="code" title=" Calculates quantile levels which encloses P% of data ">qlevels2</a>(r,kdeVcfHd.pl);
058 <span class="keyword">end</span>  
059 
060 
061 plot( NVcf, NHd,<span class="string">'.'</span>), hold on
062 <a href="../../../wafo/trgauss/pdfplot.html" class="code" title=" Plot contents of pdf structures">pdfplot</a>( kdeVcfHd,<span class="string">'r--'</span>)
063 <a href="../../../wafo/trgauss/pdfplot.html" class="code" title=" Plot contents of pdf structures">pdfplot</a>(fVcf2Ac,<span class="string">'k-'</span>)
064 hold off
065 <a href="../../../wafo/misc/wafostamp.html" class="code" title=" Prints a caption "made by WAFO" in current figure.">wafostamp</a>(<span class="string">'Figure 5'</span>,<span class="string">'(NR)'</span>)    
066 
067 <span class="keyword">return</span>
068 
069 <span class="keyword">function</span> f2 = <a name="_sub1" href="#_subfunctions" class="code">th2vhpdf</a>(f,v)
070 <span class="comment">% TH2VHPDF Calculates joint density of crest velocity and height </span>
071 <span class="comment">%         in a stationary Gaussian transform process X(t) where </span>
072 <span class="comment">%         Y(t) = g(X(t)) (Y zero-mean Gaussian with spectrum given in S). </span>
073 <span class="comment">%         The transformation, g, can be estimated using lc2tr or dat2tr.</span>
074 <span class="comment">%         </span>
075 <span class="comment">%  CALL:  fvh = th2vhpdf(fth,v);</span>
076 <span class="comment">%</span>
077 <span class="comment">%        fth  = (T Ac) pdf structure </span>
078 <span class="comment">%        fvh  = (V Ac)=(Ac/T Ac) pdf structure</span>
079 <span class="comment">%          v  = vector of  velocities; note  v &gt;= 0,</span>
080 <span class="comment">%</span>
081 <span class="comment">% Example:</span>
082 <span class="comment">%    fth = spec2thpdf(S,[],'TcfAc',[5 5 51],[],-2,4);</span>
083 <span class="comment">%    fvh = th2vhpdf(fth);  </span>
084 <span class="comment">%</span>
085 <span class="comment">% See also  spec2thpdf</span>
086 
087 <span class="comment">% Tested on : matlab 5.3</span>
088 <span class="comment">% History: </span>
089 <span class="comment">% revised by Per A. Brodtkorb 19.09.1999</span>
090 
091 <span class="comment">%tic</span>
092 
093 f2=f;
094 f2.date=datestr(now);
095 f2.labx{1}=<span class="string">'Velocity (m/s)'</span>;
096 f2.title(find(f2.title==<span class="string">'T'</span>))=<span class="string">'V'</span>;
097 k=findstr(f2.title,<span class="string">'min'</span>);
098 <span class="keyword">if</span> any(k)
099  f2.title=[f2.title(1:k(1)) <span class="string">'ax'</span> f2.title(k(1)+3:<span class="keyword">end</span>)] ;
100 <span class="keyword">end</span>
101 t=f.x{1}(:);
102 h=f.x{2}(:);
103 <span class="keyword">if</span> nargin&lt;2|isempty(v)
104   v=linspace(0,5,length(t))';
105 <span class="keyword">else</span>
106   v=v(:);
107 <span class="keyword">end</span>
108 f2.x{1}=v;
109 
110 <span class="keyword">for</span> ix=2:length(h)
111   v1 =[0; h(ix)./t(2:<span class="keyword">end</span>) ];
112   <span class="comment">%hold on,plot(v,f_th.f(ix,2:end).*t(2:end).^2/h(ix) )</span>
113   <span class="keyword">if</span> 0
114     <span class="comment">% the extrapolation done here does not work well if f.f si sparsely</span>
115     <span class="comment">% sampled =&gt; f2.f values corrupted</span>
116     
117      v1 =[0; h(ix)./t(2:<span class="keyword">end</span>) ];
118     ind= find(f.f(ix,:)&gt;0);
119     f2.f(ix,2:<span class="keyword">end</span>)=exp(min(<a href="../../../wafo/misc/smooth.html" class="code" title=" Calculates a smoothing spline.">smooth</a>(v1(ind), log(f.f(ix,ind)'.*t(ind).^2/h(ix)) ,.99,v(2:<span class="keyword">end</span>) ,1),0));
120   <span class="keyword">else</span>
121     <span class="comment">% no extrapolation =&gt; more robust</span>
122      v1 =[ h(ix)./t(2:<span class="keyword">end</span>) ];
123      
124     f2.f(ix,2:<span class="keyword">end</span>)=interp1(v1,[  f.f(ix,2:<span class="keyword">end</span>)'.*t(2:<span class="keyword">end</span>).^2/h(ix) ],v(2:<span class="keyword">end</span>) ,<span class="string">'linear'</span>);
125   <span class="keyword">end</span>
126 <span class="keyword">end</span>
127 f2.f(isnan(f2.f))=0;
128 k=find(f2.f&gt;1000);
129 <span class="keyword">if</span> any(k)
130   disp(<span class="string">'Spurios spikes due to transformation'</span>)
131   <span class="comment">%disp('set them to zero')</span>
132   <span class="comment">%f2.f(k)=0;</span>
133 <span class="keyword">end</span>
134 
135 
136 
137 <span class="keyword">switch</span> 2
138   <span class="keyword">case</span> 0, <span class="comment">%do nothing</span>
139   <span class="keyword">case</span> 2,<span class="comment">% transform Amplitude</span>
140     rate=2;
141     f2.f=f2.f/rate;
142     f2.x{2}=f2.x{2}*rate;
143    k=findstr(f2.title,<span class="string">'A'</span>);
144    <span class="keyword">if</span> any(k)
145      f2.title=[f2.title(1:k(1)-1) num2str(rate) f2.title(k(1):<span class="keyword">end</span>)] ;
146    <span class="keyword">end</span> 
147  <span class="keyword">case</span> 3
148    <span class="comment">% this does not work correctly</span>
149    g=f.tr;
150    utc=f.u;
151    
152    Ac=f2.x{2}(:);
153    Nx=length(Ac);
154    Nv=length(f2.x{1}(:));
155    der=ones(Nx,1); <span class="comment">% dh/dh=1</span>
156    hg=<a href="../../../wafo/trgauss/tranproc.html" class="code" title=" Transforms process X and up to four derivatives  ">tranproc</a>([utc+Ac der],g);
157    der1=hg(:,2);
158    Acg=hg(:,1); <span class="comment">% Gaussian level</span>
159    hg=<a href="../../../wafo/trgauss/tranproc.html" class="code" title=" Transforms process X and up to four derivatives  ">tranproc</a>([-Acg der],fliplr(g));
160    der2=hg(:,2);
161    der=1+abs(der1.*der2);
162    <span class="comment">% transform amplitude to wave height H=Ac-G(-g(Ac+utc));</span>
163    f2.x{2}=Ac-<a href="../../../wafo/trgauss/tranproc.html" class="code" title=" Transforms process X and up to four derivatives  ">tranproc</a>(-Acg,fliplr(g)); 
164    f2.f=f2.f.*der(:,ones(1,size(f2.f,2)));
165    x1=linspace(f2.x{1}(1),f2.x{1}(Nv),Nv)';
166    x2=linspace(f2.x{2}(1),f2.x{2}(Nx),Nx)';
167    [X1 X2]=meshgrid(x1,x2);
168    f2.f = <a href="../../../wafo/kdetools/evalpdf.html" class="code" title=" evaluates a PDF struct by interpolation">evalpdf</a>(f2,X1,X2,<span class="string">'linear'</span>);
169    f2.x{2}=x2;
170    f2.x{1}=x1;
171    
172    k=findstr(f2.title,<span class="string">'Ac'</span>);
173    <span class="keyword">if</span> any(k)
174      f2.title=[f2.title(1:k(1)-1) <span class="string">'Ac-G(-g(Ac+utc))'</span> f2.title(k(1)+2:<span class="keyword">end</span>)] ;
175    <span class="keyword">end</span> 
176 <span class="keyword">end</span>
177 
178 <span class="keyword">if</span> isfield(f,<span class="string">'pl'</span>)
179   f2.cl=<a href="../../../wafo/kdetools/qlevels.html" class="code" title=" Calculates quantile levels which encloses P% of PDF ">qlevels</a>(f2.f,f.pl);
180 <span class="keyword">else</span>
181   f2.pl=[10:20:90 95 99 99.9];
182   f2.cl=<a href="../../../wafo/kdetools/qlevels.html" class="code" title=" Calculates quantile levels which encloses P% of PDF ">qlevels</a>(f2.f,f2.pl);
183 <span class="keyword">end</span>
184 <span class="comment">%toc</span></pre></div>
<HR noShade>
<SMALL><A href="http://www.maths.lth.se/matstat/">Mathematical 
Statistics</A><BR><A href="http://www.maths.lth.se/">Centre for Mathematical 
Sciences</A><BR><A href="http://www.lu.se/">Lund University</A> with <A 
href="http://www.lth.se/">Lund Institute of Technology</A> </SMALL>
<P><SMALL>Comments or corrections to the <A
href="mailto:wafo@maths.lth.se">WAFO group</A>  </P>

<hr><address>Generated on Thu 06-Oct-2005 02:21:16
 for <strong><A href="http://www.maths.lth.se/matstat/wafo/">WAFO</A></strong>
 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>