<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>WAFO. Description of kdefun</title>
  <meta name="keywords" content="kdefun">
  <meta name="description" content="  Kernel Density Estimator.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="../index.html">wafo</a> &gt; <a href="index.html">kdetools</a> &gt; kdefun.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for wafo\kdetools&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>kdefun
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>  Kernel Density Estimator.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong> [f, hs,lambda]= kdefun(A,options,varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> <a href="kdefun.html" class="code" title="  Kernel Density Estimator. ">KDEFUN</a>  Kernel Density Estimator. 
  
  CALL:  [f, hs] = <a href="kdefun.html" class="code" title="  Kernel Density Estimator. ">kdefun</a>(data,options,x1,x2,...,xd) 
  
    f      = kernel density estimate evaluated at x1,x2,...,xd. 
    data   = data matrix, size N x D (D = # dimensions) 
   options = kdeoptions-structure or cellvector of named parameters with 
             corresponding values, see <a href="kdeoptset.html" class="code" title=" Create or alter KDE OPTIONS structure. ">kdeoptset</a> for details.     
    x1,x2..= vectors/matrices defining the points to evaluate the density  
    
   <a href="kdefun.html" class="code" title="  Kernel Density Estimator. ">KDEFUN</a> gives a slow, but exact kernel density estimate evaluated at x1,x2,...,xd. 
   Notice that densities close to normality appear to be the easiest for the kernel 
   estimator to estimate and that the degree of estimation difficulty increases with  
   skewness, kurtosis and multimodality. 
  
   If D &gt; 1 <a href="kde.html" class="code" title=" Kernel Density Estimator. ">KDE</a> calculates quantile <a href="../../wafo/misc/levels.html" class="code" title=" Calculates discrete levels given the parameter matrix.">levels</a> by integration. An 
   alternative is to calculate them by ranking the kernel density 
   estimate obtained at the points DATA  i.e. use the commands   
  
       f    = <a href="kde.html" class="code" title=" Kernel Density Estimator. ">kde</a>(data); 
       r    = <a href="kdefun.html" class="code" title="  Kernel Density Estimator. ">kdefun</a>(data,[],num2cell(data,1)); 
       f.cl = <a href="qlevels2.html" class="code" title=" Calculates quantile levels which encloses P% of data ">qlevels2</a>(r,f.PL);  
  
   The first is probably best when estimating the pdf and the latter is the 
   easiest and most robust for multidimensional data when only a visualization  
   of the data is needed. 
  
   For faster estimates try <a href="kdebin.html" class="code" title=" Binned Kernel Density Estimator. ">kdebin</a>. 
  
  Examples:  
      data = <a href="../../wafo/wstats/wraylrnd.html" class="code" title=" Random matrices from a Rayleigh distribution">wraylrnd</a>(1,500,1); 
      x = linspace(sqrt(eps),5,55); 
      <a href="../../wafo/wstats/wnormplot.html" class="code" title=" Plots data on a Normal distribution paper">wnormplot</a>((data).^(.5)) % gives a straight line =&gt; L2 = 0.5 reasonable 
      f = <a href="kdefun.html" class="code" title="  Kernel Density Estimator. ">kdefun</a>(data,{'L2',.5},x); 
      plot(x,f,x,<a href="../../wafo/wstats/wraylpdf.html" class="code" title=" Rayleigh probability density function">wraylpdf</a>(x,1),'r') 
  
  See also  <a href="kde.html" class="code" title=" Kernel Density Estimator. ">kde</a>, <a href="mkernel.html" class="code" title=" Multivariate Kernel Function. ">mkernel</a>, <a href="kdebin.html" class="code" title=" Binned Kernel Density Estimator. ">kdebin</a></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<TABLE BORDER=0>

<TR>
<TD><li><a href="kdefun.html" class="code" title=" [f, hs,lambda]= kdefun(A,options,varargin)">kdefun</a></li></TD>
<TD>  Kernel Density Estimator.</TD>
</TR>
<TR>
<TD><li><a href="kdeoptset.html" class="code" title=" options = kdeoptset(varargin)">kdeoptset</a></li></TD>
<TD> Create or alter KDE OPTIONS structure.</TD>
</TR>
<TR>
<TD><li><a href="mkernel2.html" class="code" title=" [z,c]=mkernel(X,kstr)">mkernel2</a></li></TD>
<TD> Multivariate Kernel Function, alternative version.</TD>
</TR>
<TR>
<TD><li><a href="../../wafo/trgauss/tranproc.html" class="code" title=" y = tranproc(x,ff)">tranproc</a></li></TD>
<TD> Transforms process X and up to four derivatives</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\datatypes\cell.m">cell</a></li></TD>
<TD>          Create cell array.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\graph2d\@scribehandle\class.m">class</a></li></TD>
<TD>         Create object or return object class.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\datatypes\deal.m">deal</a></li></TD>
<TD>          Deal inputs to outputs.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\matfun\@single\det.bi">det</a></li></TD>
<TD>           Determinant.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\datafun\@int16\diff.bi">diff</a></li></TD>
<TD>          Difference and approximate derivative.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\lang\error.m">error</a></li></TD>
<TD>         Display message and abort function.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\matfun\@single\inv.bi">inv</a></li></TD>
<TD>           Matrix inverse.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\datatypes\iscell.m">iscell</a></li></TD>
<TD>        True for cell array.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\iofun\@timer\isequal.m">isequal</a></li></TD>
<TD>       True if arrays are numerically equal.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\strfun\@char\lower.bi">lower</a></li></TD>
<TD>         Convert string to lowercase.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\datatypes\num2cell.m">num2cell</a></li></TD>
<TD>      Convert numeric array into cell array.</TD>
</TR>
</TABLE>
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<TABLE BORDER=0>

<TR>
<TD><li><a href="kde.html" class="code" title=" f = kde(A,options,varargin)">kde</a></li></TD>
<TD> Kernel Density Estimator.</TD>
</TR>
<TR>
<TD><li><a href="kdefun.html" class="code" title=" [f, hs,lambda]= kdefun(A,options,varargin)">kdefun</a></li></TD>
<TD>  Kernel Density Estimator.</TD>
</TR>
<TR>
<TD><li><a href="../../wafo/wstats/kdeplot.html" class="code" title=" [fx] = kdeplot(data,g,plotflag,h)">kdeplot</a></li></TD>
<TD> Computes and plots a kernel density estimate of PDF</TD>
</TR>
<TR>
<TD><li><a href="ssample.html" class="code" title=" s=ssample(A,m,varargin)">ssample</a></li></TD>
<TD>  Random sampling from a smoothed empirical distribution</TD>
</TR>
</TABLE>

</ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>001 <span class="keyword">function</span> [f, hs,lambda]= <a href="kdefun.html" class="code" title="  Kernel Density Estimator. "><a name="_sub0" href="#_subfunctions" class="code">kdefun</a>kdefun</a>(A,options,varargin) 
002 <span class="comment">%KDEFUN  Kernel Density Estimator. </span>
003 <span class="comment">% </span>
004 <span class="comment">% CALL:  [f, hs] = kdefun(data,options,x1,x2,...,xd) </span>
005 <span class="comment">% </span>
006 <span class="comment">%   f      = kernel density estimate evaluated at x1,x2,...,xd. </span>
007 <span class="comment">%   data   = data matrix, size N x D (D = # dimensions) </span>
008 <span class="comment">%  options = kdeoptions-structure or cellvector of named parameters with </span>
009 <span class="comment">%            corresponding values, see kdeoptset for details.     </span>
010 <span class="comment">%   x1,x2..= vectors/matrices defining the points to evaluate the density  </span>
011 <span class="comment">%   </span>
012 <span class="comment">%  KDEFUN gives a slow, but exact kernel density estimate evaluated at x1,x2,...,xd. </span>
013 <span class="comment">%  Notice that densities close to normality appear to be the easiest for the kernel </span>
014 <span class="comment">%  estimator to estimate and that the degree of estimation difficulty increases with  </span>
015 <span class="comment">%  skewness, kurtosis and multimodality. </span>
016 <span class="comment">% </span>
017 <span class="comment">%  If D &gt; 1 KDE calculates quantile levels by integration. An </span>
018 <span class="comment">%  alternative is to calculate them by ranking the kernel density </span>
019 <span class="comment">%  estimate obtained at the points DATA  i.e. use the commands   </span>
020 <span class="comment">% </span>
021 <span class="comment">%      f    = kde(data); </span>
022 <span class="comment">%      r    = kdefun(data,[],num2cell(data,1)); </span>
023 <span class="comment">%      f.cl = qlevels2(r,f.PL);  </span>
024 <span class="comment">% </span>
025 <span class="comment">%  The first is probably best when estimating the pdf and the latter is the </span>
026 <span class="comment">%  easiest and most robust for multidimensional data when only a visualization  </span>
027 <span class="comment">%  of the data is needed. </span>
028 <span class="comment">% </span>
029 <span class="comment">%  For faster estimates try kdebin. </span>
030 <span class="comment">% </span>
031 <span class="comment">% Examples:  </span>
032 <span class="comment">%     data = wraylrnd(1,500,1); </span>
033 <span class="comment">%     x = linspace(sqrt(eps),5,55); </span>
034 <span class="comment">%     wnormplot((data).^(.5)) <span class="comment">% gives a straight line =&gt; L2 = 0.5 reasonable </span></span>
035 <span class="comment">%     f = kdefun(data,{'L2',.5},x); </span>
036 <span class="comment">%     plot(x,f,x,wraylpdf(x,1),'r') </span>
037 <span class="comment">% </span>
038 <span class="comment">% See also  kde, mkernel, kdebin </span>
039  
040 <span class="comment">% Reference:   </span>
041 <span class="comment">%  B. W. Silverman (1986)  </span>
042 <span class="comment">% 'Density estimation for statistics and data analysis'   </span>
043 <span class="comment">%  Chapman and Hall , pp 100-110 </span>
044 <span class="comment">% </span>
045 <span class="comment">%  Wand, M.P. and Jones, M.C. (1995)  </span>
046 <span class="comment">% 'Kernel smoothing' </span>
047 <span class="comment">%  Chapman and Hall, pp 43--45 </span>
048  
049  
050  
051  
052 <span class="comment">%Tested on: matlab 5.2 </span>
053 <span class="comment">% History: </span>
054 <span class="comment">% revised pab Feb2004 </span>
055 <span class="comment">%  -options moved into a structure   </span>
056 <span class="comment">% revised pab Dec2003 </span>
057 <span class="comment">% -removed some code   </span>
058 <span class="comment">% revised pab 27.04.2001 </span>
059 <span class="comment">% - changed call from mkernel to mkernel2 (increased speed by 10<span class="comment">%) </span></span>
060 <span class="comment">% revised pab 01.01.2001 </span>
061 <span class="comment">% - added the possibility that L2 is a cellarray of parametric </span>
062 <span class="comment">%   or non-parametric transformations (secret option) </span>
063 <span class="comment">% revised pab 14.12.1999 </span>
064 <span class="comment">%  - fixed a small error in example in help header </span>
065 <span class="comment">% revised pab 28.10.1999 </span>
066 <span class="comment">%  - added L2 </span>
067 <span class="comment">% revised pab 21.10.99  </span>
068 <span class="comment">%  - added alpha to input arguments </span>
069 <span class="comment">%  - made it fully general for d dimensions </span>
070 <span class="comment">%  - HS may be a smoothing matrix </span>
071 <span class="comment">% revised pab 21.09.99   </span>
072 <span class="comment">%  - adapted from kdetools by Christian Beardah </span>
073  
074   defaultoptions = <a href="kdeoptset.html" class="code" title=" Create or alter KDE OPTIONS structure. ">kdeoptset</a>;   
075 <span class="comment">% If just 'defaults' passed in, return the default options in g </span>
076 <span class="keyword">if</span> ((nargin==1) &amp; (nargout &lt;= 1) &amp;  isequal(A,<span class="string">'defaults'</span>)), 
077   f = defaultoptions; 
078   <span class="keyword">return</span> 
079 <span class="keyword">end</span>    
080 error(nargchk(1,inf, nargin)) 
081  
082 [n, d]=size(A); <span class="comment">% Find dimensions of A,  </span>
083                <span class="comment">% n=number of data points, </span>
084                <span class="comment">% d=dimension of the data.   </span>
085 <span class="keyword">if</span> (nargin&lt;2 | isempty(options)) 
086   options  = defaultoptions; 
087 <span class="keyword">else</span> 
088   <span class="keyword">switch</span> lower(class(options)) 
089    <span class="keyword">case</span> {<span class="string">'char'</span>,<span class="string">'struct'</span>}, 
090     options = <a href="kdeoptset.html" class="code" title=" Create or alter KDE OPTIONS structure. ">kdeoptset</a>(defaultoptions,options); 
091    <span class="keyword">case</span> {<span class="string">'cell'</span>} 
092     
093       options = <a href="kdeoptset.html" class="code" title=" Create or alter KDE OPTIONS structure. ">kdeoptset</a>(defaultoptions,options{:}); 
094    <span class="keyword">otherwise</span> 
095     error(<span class="string">'Invalid options'</span>) 
096   <span class="keyword">end</span> 
097 <span class="keyword">end</span> 
098 kernel   = options.kernel; 
099 h        = options.hs; 
100 alpha    = options.alpha; 
101 L2       = options.L2; 
102 hsMethod = options.hsMethod; 
103  
104 <span class="keyword">if</span> isempty(h)  
105   h=zeros(1,d); 
106 <span class="keyword">end</span> 
107  
108 L22 = cell(1,d); 
109 k3=[]; 
110 <span class="keyword">if</span> isempty(L2) 
111   L2=ones(1,d); <span class="comment">% default no transformation </span>
112 <span class="keyword">elseif</span> iscell(L2)   <span class="comment">% cellarray of non-parametric and parametric transformations </span>
113   Nl2 = length(L2); 
114   <span class="keyword">if</span> ~(Nl2==1|Nl2==d), error(<span class="string">'Wrong size of L2'</span>), <span class="keyword">end</span> 
115   [L22{1:d}] = deal(L2{1:min(Nl2,d)}); 
116   L2 = ones(1,d); <span class="comment">% default no transformation </span>
117   <span class="keyword">for</span> ix=1:d, 
118     <span class="keyword">if</span> length(L22{ix})&gt;1, 
119       k3=[k3 ix];       <span class="comment">% Non-parametric transformation </span>
120     <span class="keyword">else</span>  
121      L2(ix) = L22{ix};  <span class="comment">% Parameter to the Box-Cox transformation </span>
122     <span class="keyword">end</span> 
123   <span class="keyword">end</span> 
124 <span class="keyword">elseif</span> length(L2)==1 
125   L2=L2(:,ones(1,d)); 
126 <span class="keyword">end</span> 
127  
128 amin=min(A); 
129 <span class="keyword">if</span> any((amin(L2~=1)&lt;=0))  , 
130   f=[]; 
131   error(<span class="string">'DATA cannot be negative or zero when L2~=1'</span>) 
132 <span class="keyword">end</span> 
133  
134  
135 nv=length(varargin); 
136 <span class="keyword">if</span> nv&lt;d, 
137   error(<span class="string">'some or all of the evaluation points x1,x2,...,xd is missing'</span>) 
138 <span class="keyword">end</span> 
139  
140 xsiz = size(varargin{1}); <span class="comment">% remember size of input </span>
141 Nx   = prod(xsiz); 
142 X    = zeros(Nx,d); 
143 <span class="keyword">for</span> ix=1:min(nv,d), 
144   <span class="keyword">if</span> (any(varargin{ix}&lt;=0) &amp; (L2(ix)~=1)), 
145     f=[]; 
146     error(<span class="string">'xi cannot be negative or zero when L2~=1'</span>) 
147   <span class="keyword">end</span> 
148   X(:,ix)=varargin{ix}(:); <span class="comment">% make sure it is a column vector </span>
149 <span class="keyword">end</span> 
150  
151  
152 <span class="comment">%new call </span>
153 lX = X; <span class="comment">%zeros(Nx,d); </span>
154 lA = A; <span class="comment">%zeros(size(A));   </span>
155  
156 k1 = find(L2==0); <span class="comment">% logaritmic transformation </span>
157 <span class="keyword">if</span> any(k1) 
158   lA(:,k1)=log(A(:,k1)); 
159   lX(:,k1)=log(X(:,k1)); 
160 <span class="keyword">end</span> 
161 k2=find(L2~=0 &amp; L2~=1); <span class="comment">% power transformation </span>
162 <span class="keyword">if</span> any(k2) 
163   lA(:,k2)=sign(L2(ones(n,1),k2)).*A(:,k2).^L2(ones(n,1),k2); 
164   lX(:,k2)=sign(L2(ones(Nx,1),k2)).*X(:,k2).^L2(ones(Nx,1),k2); 
165 <span class="keyword">end</span> 
166 <span class="comment">% Non-parametric transformation </span>
167 <span class="keyword">for</span> ix = k3, 
168   lA(:,ix) = <a href="../../wafo/trgauss/tranproc.html" class="code" title=" Transforms process X and up to four derivatives  ">tranproc</a>(A(:,ix),L22{ix}); 
169   lX(:,ix) = <a href="../../wafo/trgauss/tranproc.html" class="code" title=" Transforms process X and up to four derivatives  ">tranproc</a>(X(:,ix),L22{ix}); 
170 <span class="keyword">end</span> 
171  
172  
173 hsiz=size(h); 
174 <span class="keyword">if</span> (min(hsiz)==1)|(d==1) 
175   <span class="keyword">if</span> max(hsiz)==1, 
176     h=h*ones(1,d); 
177   <span class="keyword">else</span> 
178     h=reshape(h,[1,d]); <span class="comment">% make sure it has the correct dimension </span>
179   <span class="keyword">end</span>; 
180   ind=find(h&lt;=0); 
181   <span class="keyword">if</span> any(ind)    <span class="comment">% If no value of h has been specified by the user then  </span>
182     h(ind)=feval(hsMethod,lA(:,ind),kernel); <span class="comment">% calculate automatic values.   </span>
183   <span class="keyword">end</span> 
184   deth = prod(h); 
185 <span class="keyword">else</span>  <span class="comment">% fully general smoothing matrix </span>
186   deth = det(h); 
187   <span class="keyword">if</span> deth&lt;=0 
188     error(<span class="string">'bandwidth matrix h must be positive definit'</span>) 
189   <span class="keyword">end</span> 
190 <span class="keyword">end</span> 
191  
192 <span class="keyword">if</span> alpha&gt;0 
193   Xn   = num2cell(lA,1); 
194   opt1 = <a href="kdeoptset.html" class="code" title=" Create or alter KDE OPTIONS structure. ">kdeoptset</a>(<span class="string">'kernel'</span>,kernel,<span class="string">'hs'</span>,h,<span class="string">'alpha'</span>,0,<span class="string">'L2'</span>,1); 
195   f2   = <a href="kdefun.html" class="code" title="  Kernel Density Estimator. ">kdefun</a>(lA,opt1,Xn{:}); <span class="comment">% get a pilot estimate by regular KDE (alpha=0) </span>
196   g    = exp(sum(log(f2))/n); 
197    
198   lambda=(f2(:)/g).^(-alpha); 
199 <span class="keyword">else</span> 
200   lambda=ones(n,1); 
201 <span class="keyword">end</span> 
202  
203  
204  
205  
206  
207 f=zeros(Nx,1); 
208 <span class="keyword">if</span> (min(hsiz)==1)|(d==1) 
209   <span class="keyword">for</span> ix=1:n,     <span class="comment">% Sum over all data points </span>
210     Avec=lA(ix,:); 
211     Xnn=(lX-Avec(ones(Nx,1),:))./(h(ones(Nx,1),:) *lambda(ix)); 
212     f = f + <a href="mkernel2.html" class="code" title=" Multivariate Kernel Function, alternative version. ">mkernel2</a>(Xnn,kernel)/lambda(ix)^d; 
213   <span class="keyword">end</span> 
214 <span class="keyword">else</span> <span class="comment">% fully general </span>
215   h1=inv(h); 
216   <span class="keyword">for</span> ix=1:n,     <span class="comment">% Sum over all data points </span>
217     Avec=lA(ix,:); 
218     Xnn=(lX-Avec(ones(Nx,1),:))*(h1/lambda(ix)); 
219     f = f + <a href="mkernel2.html" class="code" title=" Multivariate Kernel Function, alternative version. ">mkernel2</a>(Xnn,kernel)/lambda(ix)^d; 
220   <span class="keyword">end</span>     
221 <span class="keyword">end</span> 
222 f=f/(n*deth); 
223  
224 <span class="comment">% transforming back </span>
225 <span class="keyword">if</span> any(k1), <span class="comment">% L2=0 i.e. logaritmic transformation </span>
226   <span class="keyword">for</span> ix=k1 
227     f=f./X(:,ix); 
228   <span class="keyword">end</span> 
229   <span class="keyword">if</span> any(max(abs(diff(f)))&gt;10) 
230     disp(<span class="string">'Warning: Numerical problems may have occured due to the logaritmic'</span>) 
231     disp(<span class="string">'transformation. Check the KDE for spurious spikes'</span>) 
232   <span class="keyword">end</span> 
233 <span class="keyword">end</span> 
234 <span class="keyword">if</span> any(k2) <span class="comment">% L2~=0 i.e. power transformation </span>
235   <span class="keyword">for</span> ix=k2 
236     f=f.*(X(:,ix).^(L2(ix)-1))*L2(ix)*sign(L2(ix)); 
237   <span class="keyword">end</span> 
238   <span class="keyword">if</span> any(max(abs(diff(f)))&gt;10) 
239     disp(<span class="string">'Warning: Numerical problems may have occured due to the power'</span>) 
240     disp(<span class="string">'transformation. Check the KDE for spurious spikes'</span>) 
241   <span class="keyword">end</span> 
242 <span class="keyword">end</span> 
243 <span class="keyword">if</span> any(k3), <span class="comment">% non-parametric transformation </span>
244   oneC = ones(Nx,1); 
245   <span class="keyword">for</span> ix=k3 
246     gn  = L22{ix};  
247     <span class="comment">%Gn  = fliplr(L22{ix}); </span>
248     <span class="comment">%x0  = tranproc(lX(:,ix),Gn); </span>
249     <span class="keyword">if</span> any(isnan(X(:,ix))), 
250       error(<span class="string">'The transformation does not have a strictly positive derivative.'</span>) 
251     <span class="keyword">end</span> 
252     hg1  = <a href="../../wafo/trgauss/tranproc.html" class="code" title=" Transforms process X and up to four derivatives  ">tranproc</a>([X(:,ix) oneC],gn); 
253     der1 = abs(hg1(:,2)); <span class="comment">% dg(X)/dX = 1/(dG(Y)/dY) </span>
254     <span class="comment">% alternative 2 </span>
255     <span class="comment">%pp  = smooth(Gn(:,1),Gn(:,2),1,[],1); </span>
256     <span class="comment">%dpp = diffpp(pp); </span>
257     <span class="comment">%der1 = 1./abs(ppval(dpp,f.x{ix})); </span>
258     <span class="comment">% Alternative 3 </span>
259     <span class="comment">%pp  = smooth(gn(:,1),gn(:,2),1,[],1); </span>
260     <span class="comment">%dpp = diffpp(pp); </span>
261     <span class="comment">%<span class="comment">%plot(hg1(:,1),der1-abs(ppval(dpp,x0))) </span></span>
262     <span class="comment">%der1 = abs(ppval(dpp,x0)); </span>
263     <span class="keyword">if</span> any(der1&lt;=0),  
264       error([<span class="string">'The transformation must have a strictly positive derivative'</span>]) 
265     <span class="keyword">end</span> 
266     f = f.*der1; 
267   <span class="keyword">end</span> 
268   <span class="keyword">if</span> any(max(abs(diff(f)))&gt;10) 
269     disp(<span class="string">'Warning: Numerical problems may have occured due to the power'</span>) 
270     disp(<span class="string">'transformation. Check the KDE for spurious spikes'</span>) 
271   <span class="keyword">end</span> 
272 <span class="keyword">end</span>     
273    
274 f=reshape(f,xsiz); <span class="comment">% restore original shape </span>
275 <span class="keyword">if</span> nargout&gt;1 
276   hs=h; 
277 <span class="keyword">end</span> 
278  
279  
280  
281  
282  
283  
284  
285  
286</pre></div>
<HR noShade>
<SMALL><A href="http://www.maths.lth.se/matstat/">Mathematical 
Statistics</A><BR><A href="http://www.maths.lth.se/">Centre for Mathematical 
Sciences</A><BR><A href="http://www.lu.se/">Lund University</A> with <A 
href="http://www.lth.se/">Lund Institute of Technology</A> </SMALL>
<P><SMALL>Comments or corrections to the <A
href="mailto:wafo@maths.lth.se">WAFO group</A>  </P>

<hr><address>Generated on Thu 06-Oct-2005 02:21:16
 for <strong><A href="http://www.maths.lth.se/matstat/wafo/">WAFO</A></strong>
 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>