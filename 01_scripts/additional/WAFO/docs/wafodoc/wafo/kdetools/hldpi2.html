<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>WAFO. Description of hldpi2</title>
  <meta name="keywords" content="hldpi2">
  <meta name="description" content="  L-stage DPI estimate of smoothing parameter for 2D data">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="../index.html">wafo</a> &gt; <a href="index.html">kdetools</a> &gt; hldpi2.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for wafo\kdetools&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>hldpi2
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>  L-stage DPI estimate of smoothing parameter for 2D data</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong> h=hldpi2(A,kernel,L) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> <a href="hldpi2.html" class="code" title="  L-stage DPI estimate of smoothing parameter for 2D data ">HLDPI2</a>  L-stage DPI estimate of smoothing parameter for 2D data 
          (DPI=Direct Plug-In) 
  
  CALL: hs = <a href="hldpi2.html" class="code" title="  L-stage DPI estimate of smoothing parameter for 2D data ">hldpi2</a>(data,kernel,L) 
  
        hs = smoothing parameter 
    data   = data matrix, size N x D (D = # dimensions ==2) 
    kernel = 'epanechnikov'  - Epanechnikov kernel. 
             'biweight'      - Bi-weight kernel. 
             'triweight'     - Tri-weight kernel.   
             'triangluar'    - Triangular kernel. 
             'gaussian'      - Gaussian kernel 
             'rectangular'   - Rectanguler kernel.  
             'laplace'       - Laplace kernel. 
             'logistic'      - Logistic kernel. 
         L = 0,1,2,3   (default 2) 
    
   Note that only the first 4 letters of the kernel name is needed. 
  
   Example:  
    x  = <a href="../../wafo/wstats/wnormrnd.html" class="code" title=" Random matrices from a Normal distribution.">wnormrnd</a>(0,1,50,2); 
    hs = <a href="hldpi2.html" class="code" title="  L-stage DPI estimate of smoothing parameter for 2D data ">hldpi2</a>(x,'gauss',1); 
  
  See also  <a href="hste.html" class="code" title=" 2-Stage Solve the Equation estimate of smoothing parameter. ">hste</a>, <a href="hbcv.html" class="code" title="  Biased Cross-Validation estimate of smoothing parameter. ">hbcv</a>, <a href="hboot.html" class="code" title="  Bootstrap cross-validation estimate of smoothing parameter. ">hboot</a>, <a href="hos.html" class="code" title=" Oversmoothing Parameter. ">hos</a>, <a href="hlscv.html" class="code" title="  Least Squares Cross-Validation estimate of smoothing parameter ">hlscv</a>, <a href="hscv.html" class="code" title=" Smoothed cross-validation estimate of smoothing parameter. ">hscv</a>, <a href="hstt.html" class="code" title=" Scott-Tapia-Thompson estimate of smoothing parameter. ">hstt</a>, <a href="kde.html" class="code" title=" Kernel Density Estimator. ">kde</a>, <a href="kdefun.html" class="code" title="  Kernel Density Estimator. ">kdefun</a></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<TABLE BORDER=0>

<TR>
<TD><li><a href="deriv2.html" class="code" title=" k=deriv2(x,y,d)">deriv2</a></li></TD>
<TD>  High order partial derivatives of the Gaussian kernel.</TD>
</TR>
<TR>
<TD><li><a href="kernelstats.html" class="code" title=" [mu2, R, Rdd] = kernelstats(kernel)">kernelstats</a></li></TD>
<TD> Return 2'nd order moment of kernel pdf</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\datafun\corrcoef.m">corrcoef</a></li></TD>
<TD>      Correlation coefficients.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\lang\error.m">error</a></li></TD>
<TD>         Display message and abort function.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\datafun\mean.m">mean</a></li></TD>
<TD>          Average or mean value.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\datafun\std.m">std</a></li></TD>
<TD>           Standard deviation.</TD>
</TR>
</TABLE>
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<TABLE BORDER=0>

</TABLE>

</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code"> p=psim(m,A,h)</a></li></ul>
<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>001 <span class="keyword">function</span> h=<a name="_sub0" href="#_subfunctions" class="code">hldpi2</a>(A,kernel,L) 
002 <span class="comment">%HLDPI2  L-stage DPI estimate of smoothing parameter for 2D data </span>
003 <span class="comment">%         (DPI=Direct Plug-In) </span>
004 <span class="comment">% </span>
005 <span class="comment">% CALL: hs = hldpi2(data,kernel,L) </span>
006 <span class="comment">% </span>
007 <span class="comment">%       hs = smoothing parameter </span>
008 <span class="comment">%   data   = data matrix, size N x D (D = # dimensions ==2) </span>
009 <span class="comment">%   kernel = 'epanechnikov'  - Epanechnikov kernel. </span>
010 <span class="comment">%            'biweight'      - Bi-weight kernel. </span>
011 <span class="comment">%            'triweight'     - Tri-weight kernel.   </span>
012 <span class="comment">%            'triangluar'    - Triangular kernel. </span>
013 <span class="comment">%            'gaussian'      - Gaussian kernel </span>
014 <span class="comment">%            'rectangular'   - Rectanguler kernel.  </span>
015 <span class="comment">%            'laplace'       - Laplace kernel. </span>
016 <span class="comment">%            'logistic'      - Logistic kernel. </span>
017 <span class="comment">%        L = 0,1,2,3   (default 2) </span>
018 <span class="comment">%   </span>
019 <span class="comment">%  Note that only the first 4 letters of the kernel name is needed. </span>
020 <span class="comment">% </span>
021 <span class="comment">%  Example:  </span>
022 <span class="comment">%   x  = wnormrnd(0,1,50,2); </span>
023 <span class="comment">%   hs = hldpi2(x,'gauss',1); </span>
024 <span class="comment">% </span>
025 <span class="comment">% See also  hste, hbcv, hboot, hos, hlscv, hscv, hstt, kde, kdefun </span>
026  
027 <span class="comment">% References   </span>
028 <span class="comment">%  Wand, M.P. and Jones, M.C. (1994)  </span>
029 <span class="comment">%  Computational statistics </span>
030  
031 <span class="comment">% tested on: matlab 5.2 </span>
032 <span class="comment">% history: </span>
033 <span class="comment">% revised pab aug2005 </span>
034 <span class="comment">% -added ad hoc support for other kernels than Gaussian </span>
035 <span class="comment">% revised pab Nov2004   </span>
036 <span class="comment">%  added nargchk   </span>
037 <span class="comment">% revised pab dec2003   </span>
038 <span class="comment">%  -added psim   </span>
039 <span class="comment">% revised pab 3.11.1999 </span>
040 <span class="comment">%  renamed from h2dpi to hldpi2 </span>
041 <span class="comment">% from kdetools              Christian C. Beardah 1996 </span>
042  
043  
044 error(nargchk(1,3,nargin))   
045 [n, d]=size(A); 
046 <span class="keyword">if</span> d~=2, 
047   error(<span class="string">'Wrong size of data'</span>) 
048 <span class="keyword">end</span> 
049 <span class="keyword">if</span> nargin&lt;2 |isempty(kernel) 
050   kernel = <span class="string">'gauss'</span>; 
051 <span class="keyword">end</span> 
052 <span class="keyword">if</span> nargin&lt;3|isempty(L), 
053   L=2; 
054 <span class="keyword">else</span> 
055   L=min(abs(L),3); 
056 <span class="keyword">end</span>; 
057  
058 <span class="comment">% Transform A so rows have st. dev.=1: </span>
059 oldA=A; 
060 A=(oldA-ones(n,1)*mean(oldA))*diag([1./std(oldA)]); <span class="comment">% centre data about </span>
061  
062 <span class="comment">% its mean </span>
063  
064 K22=1/(2*pi); 
065 K40=3/(2*pi); 
066 K04=3/(2*pi); 
067  
068 K42=-3/(2*pi); 
069 K24=-3/(2*pi); 
070 K60=-15/(2*pi); 
071 K06=-15/(2*pi); 
072  
073 K44=9/(2*pi); 
074 K62=15/(2*pi); 
075 K26=15/(2*pi); 
076 K80=105/(2*pi); 
077 K08=105/(2*pi); 
078  
079 <span class="comment">% R= int(mkernel(x)^2) </span>
080 <span class="comment">% mu2= int(x^2*mkernel(x)) </span>
081 kernel2 = <span class="string">'gauss'</span>; 
082 <span class="comment">% values for gaussian kernel </span>
083 [mu2ns,Rns] = <a href="kernelstats.html" class="code" title=" Return 2'nd order moment of kernel pdf ">kernelstats</a>(kernel2); 
084 Rns = Rns^d; 
085 STEconstant2 = Rns /(mu2ns^(2)*n); 
086  
087 [mu2,R] = <a href="kernelstats.html" class="code" title=" Return 2'nd order moment of kernel pdf ">kernelstats</a>(kernel); 
088 R = R^d; 
089  
090 STEconstant = R /(mu2^(2)*n); 
091  
092 sigma1=std(A(:,1)); 
093 sigma2=std(A(:,2)); 
094  
095 rho=corrcoef(A); 
096 rho=rho(1,2); 
097  
098 <span class="keyword">if</span> L==3, 
099  
100   lam100=945; 
101   lam010=945; 
102   lam82=105+840*rho^2; 
103   lam28=105+840*rho^2; 
104   lam64=45+540*rho^2+360*rho^4; 
105   lam46=45+540*rho^2+360*rho^4; 
106  
107   psi100=lam100/(128*pi*sigma1^11*sigma2*(1-rho^2)^5.5); 
108   psi010=lam010/(128*pi*sigma1*sigma2^11*(1-rho^2)^5.5); 
109   psi82=lam82/(128*pi*sigma1^9*sigma2^3*(1-rho^2)^5.5); 
110   psi28=lam28/(128*pi*sigma1^3*sigma2^9*(1-rho^2)^5.5); 
111   psi64=lam64/(128*pi*sigma1^7*sigma2^5*(1-rho^2)^5.5); 
112   psi46=lam46/(128*pi*sigma1^5*sigma2^7*(1-rho^2)^5.5); 
113  
114 <span class="comment">% The following are the smoothing parameters for  </span>
115 <span class="comment">% estimation of psi80, psi08, psi62, psi26 and psi44: </span>
116  
117   a80=(-2*K80/(mu2ns*(psi100+psi82)*n))^(1/12); 
118   a08=(-2*K08/(mu2ns*(psi28+psi010)*n))^(1/12); 
119   a62=(-2*K62/(mu2ns*(psi82+psi64)*n))^(1/12); 
120   a26=(-2*K26/(mu2ns*(psi46+psi28)*n))^(1/12); 
121   a44=(-2*K44/(mu2ns*(psi64+psi46)*n))^(1/12); 
122  
123   psi80=<a href="#_sub1" class="code" title="sub  p=psim(m,A,h)">psim</a>(<span class="string">'80'</span>,A,a80); 
124   psi08=<a href="#_sub1" class="code" title="sub  p=psim(m,A,h)">psim</a>(<span class="string">'08'</span>,A,a08); 
125   psi62=<a href="#_sub1" class="code" title="sub  p=psim(m,A,h)">psim</a>(<span class="string">'62'</span>,A,a62); 
126   psi26=<a href="#_sub1" class="code" title="sub  p=psim(m,A,h)">psim</a>(<span class="string">'26'</span>,A,a26); 
127   psi44=<a href="#_sub1" class="code" title="sub  p=psim(m,A,h)">psim</a>(<span class="string">'44'</span>,A,a44); 
128  
129 <span class="keyword">end</span>; 
130  
131 <span class="keyword">if</span> L==2 | L==3, 
132  
133   <span class="keyword">if</span> L==2, 
134     lam80=105; 
135     lam08=105; 
136     lam62=15+90*rho^2; 
137     lam26=15+90*rho^2; 
138     lam44=9+72*rho^2+24*rho^4; 
139  
140     psi80=lam80/(64*pi*sigma1^9*sigma2*(1-rho^2)^4.5); 
141     psi08=lam08/(64*pi*sigma1*sigma2^9*(1-rho^2)^4.5); 
142     psi62=lam62/(64*pi*sigma1^7*sigma2^3*(1-rho^2)^4.5); 
143     psi26=lam26/(64*pi*sigma1^3*sigma2^7*(1-rho^2)^4.5); 
144     psi44=lam44/(64*pi*sigma1^5*sigma2^5*(1-rho^2)^4.5); 
145   <span class="keyword">end</span>; 
146  
147 <span class="comment">% The following are the smoothing parameters for  </span>
148 <span class="comment">% estimation of psi60, psi06, psi42 and psi24: </span>
149  
150   a60=(-2*K60/(mu2ns*(psi80+psi62)*n))^0.1; 
151   a06=(-2*K06/(mu2ns*(psi26+psi08)*n))^0.1; 
152   a42=(-2*K42/(mu2ns*(psi62+psi44)*n))^0.1; 
153   a24=(-2*K24/(mu2ns*(psi44+psi26)*n))^0.1; 
154  
155   psi60=<a href="#_sub1" class="code" title="sub  p=psim(m,A,h)">psim</a>(<span class="string">'60'</span>,A,a60); 
156   psi06=<a href="#_sub1" class="code" title="sub  p=psim(m,A,h)">psim</a>(<span class="string">'06'</span>,A,a06); 
157   psi42=<a href="#_sub1" class="code" title="sub  p=psim(m,A,h)">psim</a>(<span class="string">'42'</span>,A,a42); 
158   psi24=<a href="#_sub1" class="code" title="sub  p=psim(m,A,h)">psim</a>(<span class="string">'24'</span>,A,a24); 
159  
160 <span class="keyword">end</span>; 
161  
162 <span class="keyword">if</span> L==1 | L==2 | L==3, 
163  
164   <span class="keyword">if</span> L==1, 
165     lam06=15; 
166     lam60=15; 
167     lam24=3+12*rho^2; 
168     lam42=3+12*rho^2; 
169  
170     psi60=-lam60/(32*pi*sigma1^7*sigma2*(1-rho^2)^3.5); 
171     psi06=-lam06/(32*pi*sigma1*sigma2^7*(1-rho^2)^3.5); 
172     psi42=-lam42/(32*pi*sigma1^5*sigma2^3*(1-rho^2)^3.5); 
173     psi24=-lam24/(32*pi*sigma1^3*sigma2^5*(1-rho^2)^3.5); 
174   <span class="keyword">end</span>; 
175  
176 <span class="comment">% The following are the smoothing parameters for  </span>
177 <span class="comment">% estimation of psi40, psi04 and psi22: </span>
178  
179   a40=(-2*K40/(mu2ns*(psi60+psi42)*n))^0.125; 
180   a04=(-2*K04/(mu2ns*(psi24+psi06)*n))^0.125; 
181   a22=(-2*K22/(mu2ns*(psi42+psi24)*n))^0.125; 
182  
183   psi40=<a href="#_sub1" class="code" title="sub  p=psim(m,A,h)">psim</a>(<span class="string">'40'</span>,A,a40); 
184   psi04=<a href="#_sub1" class="code" title="sub  p=psim(m,A,h)">psim</a>(<span class="string">'04'</span>,A,a04); 
185   psi22=<a href="#_sub1" class="code" title="sub  p=psim(m,A,h)">psim</a>(<span class="string">'22'</span>,A,a22); 
186  
187 <span class="keyword">end</span>; 
188  
189 <span class="keyword">if</span> L==0, 
190  
191   lam04=3; 
192   lam40=3; 
193   lam22=3/2; 
194  
195   psi40=-lam40/(16*pi*sigma1^5*sigma2*(1-rho^2)^2.5); 
196   psi04=-lam04/(16*pi*sigma1*sigma2^5*(1-rho^2)^2.5); 
197   psi22=-lam22/(16*pi*sigma1^3*sigma2^3*(1-rho^2)^2.5); 
198  
199 <span class="keyword">end</span>; 
200  
201  
202 h1=(psi04^0.75*R/(n*mu2^2*psi40^0.75*(sqrt(psi40*psi04)+psi22)))^(1/6); 
203 h2=h1*(psi40/psi04)^0.25; 
204  
205 h=real([h1, h2]); 
206  
207  
208 <span class="comment">% Transform values of h back: </span>
209  
210 h=h*diag(std(oldA)); 
211 <span class="keyword">return</span> 
212 <span class="keyword">function</span> p=<a name="_sub1" href="#_subfunctions" class="code">psim</a>(m,A,h) 
213  
214 <span class="comment">% PSIM        Calculate psi_m by brute force. </span>
215 <span class="comment">% </span>
216 <span class="comment">%             PSIM(M,A,H) </span>
217 <span class="comment">% </span>
218 <span class="comment">%             Christian C. Beardah 1996 </span>
219  
220 n=length(A); 
221  
222 Xi=zeros(n,n); 
223 Xj=Xi; 
224 Yi=Xi; 
225 Yj=Xi; 
226  
227 o=ones(1,n); 
228  
229 Xj=A(:,1)*o; 
230 Xi=Xj'; 
231 Yj=A(:,2)*o; 
232 Yi=Yj'; 
233  
234 p=sum(sum(<a href="deriv2.html" class="code" title="  High order partial derivatives of the Gaussian kernel. ">deriv2</a>((Xi-Xj)/h,(Yi-Yj)/h,m) ))/(h*n^2); 
235 <span class="keyword">return</span></pre></div>
<HR noShade>
<SMALL><A href="http://www.maths.lth.se/matstat/">Mathematical 
Statistics</A><BR><A href="http://www.maths.lth.se/">Centre for Mathematical 
Sciences</A><BR><A href="http://www.lu.se/">Lund University</A> with <A 
href="http://www.lth.se/">Lund Institute of Technology</A> </SMALL>
<P><SMALL>Comments or corrections to the <A
href="mailto:wafo@maths.lth.se">WAFO group</A>  </P>

<hr><address>Generated on Thu 06-Oct-2005 02:21:16
 for <strong><A href="http://www.maths.lth.se/matstat/wafo/">WAFO</A></strong>
 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>