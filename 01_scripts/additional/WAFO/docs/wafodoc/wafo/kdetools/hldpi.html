<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>WAFO. Description of hldpi</title>
  <meta name="keywords" content="hldpi">
  <meta name="description" content=" L-stage Direct Plug-In estimate of smoothing parameter.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="../index.html">wafo</a> &gt; <a href="index.html">kdetools</a> &gt; hldpi.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for wafo\kdetools&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>hldpi
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong> L-stage Direct Plug-In estimate of smoothing parameter.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong> h=hldpi(A,kernel,L,inc); </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> <a href="hldpi.html" class="code" title=" L-stage Direct Plug-In estimate of smoothing parameter. ">HLDPI</a> L-stage Direct Plug-In estimate of smoothing parameter. 
  
  CALL: hs = <a href="hldpi.html" class="code" title=" L-stage Direct Plug-In estimate of smoothing parameter. ">hldpi</a>(data,kernel,L) 
  
        hs = one dimensional value for smoothing parameter 
             given the data and kernel.  size 1 x D 
    data   = data matrix, size N x D (D = # dimensions ) 
    kernel = 'epanechnikov'  - Epanechnikov kernel. 
             'biweight'      - Bi-weight kernel. 
             'triweight'     - Tri-weight kernel. 
             'triangluar'    - Triangular kernel. 
             'gaussian'      - Gaussian kernel 
             'rectangular'   - Rectanguler kernel. 
             'laplace'       - Laplace kernel. 
             'logistic'      - Logistic kernel. 
         L = 0,1,2,3,...   (default 2) 
  
   Note that only the first 4 letters of the kernel name is needed. 
  
   Example: 
    x  = <a href="../../wafo/wstats/wnormrnd.html" class="code" title=" Random matrices from a Normal distribution.">wnormrnd</a>(0,1,50,1); 
    hs = <a href="hldpi.html" class="code" title=" L-stage Direct Plug-In estimate of smoothing parameter. ">hldpi</a>(x,'gauss',1); 
  
  See also  <a href="hste.html" class="code" title=" 2-Stage Solve the Equation estimate of smoothing parameter. ">hste</a>, <a href="hbcv.html" class="code" title="  Biased Cross-Validation estimate of smoothing parameter. ">hbcv</a>, <a href="hboot.html" class="code" title="  Bootstrap cross-validation estimate of smoothing parameter. ">hboot</a>, <a href="hos.html" class="code" title=" Oversmoothing Parameter. ">hos</a>, <a href="hlscv.html" class="code" title="  Least Squares Cross-Validation estimate of smoothing parameter ">hlscv</a>, <a href="hscv.html" class="code" title=" Smoothed cross-validation estimate of smoothing parameter. ">hscv</a>, <a href="hstt.html" class="code" title=" Scott-Tapia-Thompson estimate of smoothing parameter. ">hstt</a>, <a href="kde.html" class="code" title=" Kernel Density Estimator. ">kde</a>, <a href="kdefun.html" class="code" title="  Kernel Density Estimator. ">kdefun</a></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<TABLE BORDER=0>

<TR>
<TD><li><a href="deriv.html" class="code" title=" [varargout]=deriv(t,k)">deriv</a></li></TD>
<TD>  4th, 6th, 8th and 10th derivatives of the kernel function.</TD>
</TR>
<TR>
<TD><li><a href="gridcount.html" class="code" title=" c = gridcount(data,X)">gridcount</a></li></TD>
<TD> D-dimensional histogram using linear binning.</TD>
</TR>
<TR>
<TD><li><a href="kernelstats.html" class="code" title=" [mu2, R, Rdd] = kernelstats(kernel)">kernelstats</a></li></TD>
<TD> Return 2'nd order moment of kernel pdf</TD>
</TR>
<TR>
<TD><li><a href="qlevels2.html" class="code" title=" [q, p]=qlevels2(r,p,method)">qlevels2</a></li></TD>
<TD> Calculates quantile levels which encloses P% of data</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\datafun\@int16\diff.bi">diff</a></li></TD>
<TD>          Difference and approximate derivative.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\lang\error.m">error</a></li></TD>
<TD>         Display message and abort function.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\datafun\@logical\fft.bi">fft</a></li></TD>
<TD>           Discrete Fourier transform.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\datafun\@logical\ifft.bi">ifft</a></li></TD>
<TD>          Inverse discrete Fourier transform.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\elmat\linspace.m">linspace</a></li></TD>
<TD>      Linearly spaced vector.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\datafun\std.m">std</a></li></TD>
<TD>           Standard deviation.</TD>
</TR>
</TABLE>
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<TABLE BORDER=0>

<TR>
<TD><li><a href="../../wafo/wstats/kdeplot.html" class="code" title=" [fx] = kdeplot(data,g,plotflag,h)">kdeplot</a></li></TD>
<TD> Computes and plots a kernel density estimate of PDF</TD>
</TR>
</TABLE>

</ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>001 <span class="keyword">function</span> h=<a name="_sub0" href="#_subfunctions" class="code">hldpi</a>(A,kernel,L,inc); 
002 <span class="comment">%HLDPI L-stage Direct Plug-In estimate of smoothing parameter. </span>
003 <span class="comment">% </span>
004 <span class="comment">% CALL: hs = hldpi(data,kernel,L) </span>
005 <span class="comment">% </span>
006 <span class="comment">%       hs = one dimensional value for smoothing parameter </span>
007 <span class="comment">%            given the data and kernel.  size 1 x D </span>
008 <span class="comment">%   data   = data matrix, size N x D (D = # dimensions ) </span>
009 <span class="comment">%   kernel = 'epanechnikov'  - Epanechnikov kernel. </span>
010 <span class="comment">%            'biweight'      - Bi-weight kernel. </span>
011 <span class="comment">%            'triweight'     - Tri-weight kernel. </span>
012 <span class="comment">%            'triangluar'    - Triangular kernel. </span>
013 <span class="comment">%            'gaussian'      - Gaussian kernel </span>
014 <span class="comment">%            'rectangular'   - Rectanguler kernel. </span>
015 <span class="comment">%            'laplace'       - Laplace kernel. </span>
016 <span class="comment">%            'logistic'      - Logistic kernel. </span>
017 <span class="comment">%        L = 0,1,2,3,...   (default 2) </span>
018 <span class="comment">% </span>
019 <span class="comment">%  Note that only the first 4 letters of the kernel name is needed. </span>
020 <span class="comment">% </span>
021 <span class="comment">%  Example: </span>
022 <span class="comment">%   x  = wnormrnd(0,1,50,1); </span>
023 <span class="comment">%   hs = hldpi(x,'gauss',1); </span>
024 <span class="comment">% </span>
025 <span class="comment">% See also  hste, hbcv, hboot, hos, hlscv, hscv, hstt, kde, kdefun </span>
026  
027 <span class="comment">%  Wand,M.P. and Jones, M.C. (1995) </span>
028 <span class="comment">% 'Kernel smoothing' </span>
029 <span class="comment">%  Chapman and Hall, pp 67--74 </span>
030  
031  
032 <span class="comment">%tested on: matlab 5.2 </span>
033 <span class="comment">% revised pab Agu 2005 </span>
034 <span class="comment">% -fixed a bug for kernels other than Gaussian </span>
035 <span class="comment">% -made it more general: L&gt;3 is now possible </span>
036 <span class="comment">% revised pab nov2004 </span>
037 <span class="comment">% - kernel2 = 'gaus' </span>
038 <span class="comment">% -added nargchk </span>
039 <span class="comment">% revised pab Dec2003 </span>
040 <span class="comment">% revised pab 16.10.1999 </span>
041 <span class="comment">%  updated to matlab 5.x changed name from hdpi -&gt; hldpi </span>
042 <span class="comment">%  changed the gridding -&gt; hldpi is now faster </span>
043 <span class="comment">% taken from kdetools             Christian C. Beardah 1994 </span>
044  
045  
046 error(nargchk(1,4,nargin)) 
047 <span class="keyword">if</span> nargin&lt;2|isempty(kernel) 
048   kernel=<span class="string">'gauss'</span>; 
049 <span class="keyword">end</span> 
050 <span class="keyword">if</span> nargin&lt;3|isempty(L), 
051   L=2; 
052 <span class="keyword">else</span> 
053   L=abs(L); 
054 <span class="keyword">end</span>; 
055 <span class="keyword">if</span> nargin&lt;4|isempty(inc) 
056   inc=128; 
057 <span class="keyword">end</span> 
058  
059 nfft = inc*2; 
060 [n, d] = size(A); 
061 <span class="keyword">if</span> (n==1) &amp; (d&gt;1), 
062   A=A.'; 
063   n=d; 
064   d=1; 
065 <span class="keyword">end</span> 
066  
067 xmin = min(A);    <span class="comment">% Find the minimum value of A. </span>
068 xmax = max(A);    <span class="comment">% Find the maximum value of A. </span>
069 xrange = xmax-xmin; <span class="comment">% Find the range of A. </span>
070  
071 sigmaA = std(A); 
072 iqr = abs(diff(<a href="qlevels2.html" class="code" title=" Calculates quantile levels which encloses P% of data ">qlevels2</a>(A,[75 25]),1,1)); <span class="comment">% interquartile range </span>
073 k = find(iqr&gt;0); 
074 <span class="keyword">if</span> any(k) 
075   sigmaA(k) = min(sigmaA(k), iqr(k)/1.349); 
076 <span class="keyword">end</span> 
077  
078 <span class="comment">% R= int(mkernel(x)^2) </span>
079 <span class="comment">% mu2= int(x^2*mkernel(x)) </span>
080 [mu2,R] = <a href="kernelstats.html" class="code" title=" Return 2'nd order moment of kernel pdf ">kernelstats</a>(kernel); 
081  
082 STEconstant = R /(mu2^(2)*n); 
083  
084 <span class="comment">% xa holds the x 'axis' vector, defining a grid of x values where </span>
085 <span class="comment">% the k.d. function will be evaluated and plotted. </span>
086  
087 ax1 = xmin-xrange/8; 
088 bx1 = xmax+xrange/8; 
089  
090 kernel2 = <span class="string">'gaus'</span>; 
091 [mu2,R] = <a href="kernelstats.html" class="code" title=" Return 2'nd order moment of kernel pdf ">kernelstats</a>(kernel2); <span class="comment">% Bug fix: Do not delete this: pab aug2005 </span>
092  
093 <span class="keyword">for</span> dim=1:d 
094   s = sigmaA(dim); 
095   ax = ax1(dim); 
096   bx = bx1(dim); 
097  
098   xa = linspace(ax,bx,inc).'; 
099   xn = linspace(0,bx-ax,inc); 
100  
101   c = <a href="gridcount.html" class="code" title=" D-dimensional histogram using linear binning. ">gridcount</a>(A(:,dim),xa); 
102  
103   <span class="comment">%c=zeros(inc,1); </span>
104   <span class="comment">%deltax =(bx-ax)/(inc-1); </span>
105   <span class="comment">%xn     = (0:(inc-1))*deltax; </span>
106   <span class="comment">%binx   = floor((A(:,dim)-ax)/deltax)+1; </span>
107  
108  
109   <span class="comment">% Obtain the grid counts. </span>
110   <span class="comment">%c = full(sparse(binx,1,(xa(binx+1)-A(:,dim)),inc,1)+... </span>
111   <span class="comment">%         sparse(binx+1,1,(A(:,dim)-xa(binx)),inc,1))/deltax; </span>
112  
113   r   = 2*L+4; 
114   rd2 = L+2; 
115  
116   <span class="comment">% Eq. 3.7 in Wand and Jones (1995) </span>
117   PSI_r =  (-1)^(rd2)*prod(rd2+1:r)/(sqrt(pi)*(2*s)^(r+1)); 
118   PSI   = PSI_r; 
119   <span class="keyword">if</span> L&gt;0 
120     <span class="comment">% High order derivatives of the Gaussian kernel </span>
121     [Kd{1:L}] = <a href="deriv.html" class="code" title="  4th, 6th, 8th and 10th derivatives of the kernel function. ">deriv</a>(0,kernel2); 
122      
123     <span class="comment">% L-stage iterations to estimate PSI_4 </span>
124     <span class="keyword">for</span> ix = L:-1:1 
125       gi = (-2*Kd{ix}/(mu2*PSI*n))^(1/(2*ix+5)); 
126  
127       <span class="comment">% Obtain the kernel weights. </span>
128       [KW0{1:ix}] = <a href="deriv.html" class="code" title="  4th, 6th, 8th and 10th derivatives of the kernel function. ">deriv</a>(xn/gi,kernel2); 
129       kw=[KW0{ix},0,KW0{ix}([inc:-1:2])].'; <span class="comment">% Apply 'fftshift' to kw. </span>
130  
131       <span class="comment">% Perform the convolution. </span>
132       z=real(ifft(fft(c,nfft).*fft(kw))); 
133  
134       PSI = sum(c.*z(1:inc))/(n^2*gi^(2*ix+3)); 
135     <span class="keyword">end</span> 
136   <span class="keyword">end</span> 
137   h(dim)=(STEconstant/PSI)^(1/5); 
138 <span class="keyword">end</span></pre></div>
<HR noShade>
<SMALL><A href="http://www.maths.lth.se/matstat/">Mathematical 
Statistics</A><BR><A href="http://www.maths.lth.se/">Centre for Mathematical 
Sciences</A><BR><A href="http://www.lu.se/">Lund University</A> with <A 
href="http://www.lth.se/">Lund Institute of Technology</A> </SMALL>
<P><SMALL>Comments or corrections to the <A
href="mailto:wafo@maths.lth.se">WAFO group</A>  </P>

<hr><address>Generated on Thu 06-Oct-2005 02:21:16
 for <strong><A href="http://www.maths.lth.se/matstat/wafo/">WAFO</A></strong>
 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>