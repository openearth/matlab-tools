<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>WAFO. Description of smc2rfm</title>
  <meta name="keywords" content="smc2rfm">
  <meta name="description" content=" Calculates the rainflow matrix/intensity for a switching Markov chain.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="../index.html">wafo</a> &gt; <a href="index.html">markov</a> &gt; smc2rfm.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for wafo\markov&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>smc2rfm
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong> Calculates the rainflow matrix/intensity for a switching Markov chain.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong> [F_rfc,mu_rfc] = smc2rfc(P,Qc,def) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> <a href="smc2rfm.html" class="code" title=" Calculates the rainflow matrix/intensity for a switching Markov chain. ">SMC2RFM</a> Calculates the rainflow matrix/intensity for a switching Markov chain. 
  
  [F_rfc,mu_rfc] = smc2rfc(P,Q,1); 
  [F_rfc,mu_rfc] = smc2rfc(P,Q,[2 h]); 
  
  F_rfc  = Rainflow matrix / Rainflow intensity     [NxN] 
  mu_rfc = Rainflow counting intensity              [NxN] 
  
  P      = Transition matrix for regime process     [rxr] 
  Q      = Cell array of transition matrices        {r,1} 
  Q{i}   = Transition matrix for Markov chain i     [nxn] 
  def    = Definition 1: Markov chain (default),     N=n 
                      2: Discretized Markov chain,   N=n+1 
  h      = Discretization step (ONLY Def 2!) 
  
  Calculates  
    (1) the rainflow matrix for a switching Markov chain OR 
    (2) the rainflow intensity for a discretized switching Markov chain. 
  
  Example:  
    param = [-1 1 32]; u = <a href="../../wafo/misc/levels.html" class="code" title=" Calculates discrete levels given the parameter matrix.">levels</a>(param); 
    [F1,F2] = <a href="mktestmat.html" class="code" title="   Makes test matrices for min-max (and max-min) matrices. ">mktestmat</a>(param,[-0.3 0.3],0.15,1,-Inf); 
    Frfc = <a href="smc2rfm.html" class="code" title=" Calculates the rainflow matrix/intensity for a switching Markov chain. ">smc2rfm</a>(P,{F1;F2}); 
    <a href="../../wafo/cycles/cmatplot.html" class="code" title=" Plots a cycle matrix, e.g. a rainflow matrix.">cmatplot</a>(u,u,Frfc) 
  
  See also  <a href="mc2rfm.html" class="code" title="  Calculates the rainflow matrix/intensity for a Markov chain.">mc2rfm</a>, <a href="smctp2rfm.html" class="code" title="  Calculates the rainflow matrix for a SMCTP.">smctp2rfm</a>, smc2stat, <a href="../../wafo/cycles/cmatplot.html" class="code" title=" Plots a cycle matrix, e.g. a rainflow matrix.">cmatplot</a></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<TABLE BORDER=0>

<TR>
<TD><li><a href="../../wafo/cycles/cmat2nt.html" class="code" title=" NT = cmat2nt(F,def)">cmat2nt</a></li></TD>
<TD> Calculates a counting distribution from a cycle matrix.</TD>
</TR>
<TR>
<TD><li><a href="mc2stat.html" class="code" title=" [ro,PP]=mc2stat(P)">mc2stat</a></li></TD>
<TD>  Calculates the stationary distribution for a Markov chain.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\lang\error.m">error</a></li></TD>
<TD>         Display message and abort function.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\matfun\@single\inv.bi">inv</a></li></TD>
<TD>           Matrix inverse.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\ops\kron.m">kron</a></li></TD>
<TD>          Kronecker tensor product.</TD>
</TR>
<TR>
<TD><li><a href="" class="code" title="C:\programs\matlab71\toolbox\matlab\lang\warning.m">warning</a></li></TD>
<TD>       Display warning message; disable or enable warning messages.</TD>
</TR>
</TABLE>
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<TABLE BORDER=0>

<TR>
<TD><li><a href="mc2rfm.html" class="code" title=" [F_rfc,mu_rfc] = mc2rfm(Q,def)">mc2rfm</a></li></TD>
<TD>  Calculates the rainflow matrix/intensity for a Markov chain.</TD>
</TR>
<TR>
<TD><li><a href="../../wafo/wdemos/rfcdemo1.html" class="code" title=" [F_RFC] = refdemo1(demoNr,P,A,m,s2,param)">rfcdemo1</a></li></TD>
<TD>  Demo for switching AR(1)-processes.</TD>
</TR>
<TR>
<TD><li><a href="../../wafo/markov/test/test_markov.html" class="code" title="This is a script file.">test_markov</a></li></TD>
<TD> Quick test of the routines in module 'markov'</TD>
</TR>
</TABLE>

</ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>001 <span class="keyword">function</span> [F_rfc,mu_rfc] = smc2rfc(P,Qc,def) 
002 <span class="comment">%SMC2RFM Calculates the rainflow matrix/intensity for a switching Markov chain. </span>
003 <span class="comment">% </span>
004 <span class="comment">% [F_rfc,mu_rfc] = smc2rfc(P,Q,1); </span>
005 <span class="comment">% [F_rfc,mu_rfc] = smc2rfc(P,Q,[2 h]); </span>
006 <span class="comment">% </span>
007 <span class="comment">% F_rfc  = Rainflow matrix / Rainflow intensity     [NxN] </span>
008 <span class="comment">% mu_rfc = Rainflow counting intensity              [NxN] </span>
009 <span class="comment">% </span>
010 <span class="comment">% P      = Transition matrix for regime process     [rxr] </span>
011 <span class="comment">% Q      = Cell array of transition matrices        {r,1} </span>
012 <span class="comment">% Q{i}   = Transition matrix for Markov chain i     [nxn] </span>
013 <span class="comment">% def    = Definition 1: Markov chain (default),     N=n </span>
014 <span class="comment">%                     2: Discretized Markov chain,   N=n+1 </span>
015 <span class="comment">% h      = Discretization step (ONLY Def 2!) </span>
016 <span class="comment">% </span>
017 <span class="comment">% Calculates  </span>
018 <span class="comment">%   (1) the rainflow matrix for a switching Markov chain OR </span>
019 <span class="comment">%   (2) the rainflow intensity for a discretized switching Markov chain. </span>
020 <span class="comment">% </span>
021 <span class="comment">% Example:  </span>
022 <span class="comment">%   param = [-1 1 32]; u = levels(param); </span>
023 <span class="comment">%   [F1,F2] = mktestmat(param,[-0.3 0.3],0.15,1,-Inf); </span>
024 <span class="comment">%   Frfc = smc2rfm(P,{F1;F2}); </span>
025 <span class="comment">%   cmatplot(u,u,Frfc) </span>
026 <span class="comment">% </span>
027 <span class="comment">% See also  mc2rfm, smctp2rfm, smc2stat, cmatplot </span>
028  
029 <span class="comment">% References </span>
030 <span class="comment">%   </span>
031 <span class="comment">%  P. Johannesson (1999): </span>
032 <span class="comment">%  Rainflow Analysis of Switching Markov Loads. </span>
033 <span class="comment">%  PhD thesis, Mathematical Statistics, Centre for Mathematical Sciences, </span>
034 <span class="comment">%  Lund Institute of Technology. </span>
035 <span class="comment">%   </span>
036 <span class="comment">%  P. Johannesson (1998): </span>
037 <span class="comment">%  Rainflow Cycles for Switching Processes with Markov Structure. </span>
038 <span class="comment">%  Probability in the Engineering and Informational Sciences,  </span>
039 <span class="comment">%  Vol. 12, No. 2, pp. 143-175. </span>
040  
041 <span class="comment">% Tested  on Matlab  5.3 </span>
042 <span class="comment">% </span>
043 <span class="comment">% History: </span>
044 <span class="comment">% Revised by PJ 19-May-2000 </span>
045 <span class="comment">%   Changer disp(...) to warning(...) . </span>
046 <span class="comment">% Revised by PJ  23-Nov-1999 </span>
047 <span class="comment">%   updated for WAFO </span>
048 <span class="comment">% Created by PJ (Pär Johannesson) 1997 </span>
049 <span class="comment">%   Copyright (c) 1997 by Pär Johannesson </span>
050 <span class="comment">%   Toolbox: Rainflow Cycles for Switching Processes V.1.0, 2-Oct-1997 </span>
051  
052  
053 <span class="comment">% Check input arguments </span>
054  
055 ni = nargin; 
056 no = nargout; 
057 error(nargchk(2,3,ni)); 
058  
059 <span class="keyword">if</span> ni&lt;3, def = []; <span class="keyword">end</span> 
060 <span class="keyword">if</span> isempty(def), def = 1; <span class="keyword">end</span> 
061  
062 <span class="comment">% Define  </span>
063  
064 Zstr = <span class="string">'123456789'</span>; 
065  
066 r = length(P);   <span class="comment">% Number of regime states </span>
067 n = length(Qc{1});  <span class="comment">% Number of levels </span>
068  
069 <span class="comment">% Check that the rowsums of P are equal to 1 </span>
070  
071 sumP = sum(P'); 
072 <span class="keyword">if</span> sum(sumP == 1) ~= length(P) 
073   warning([<span class="string">'Rowsums of P not equal to 1. Renormalizing.'</span>]); 
074   <span class="keyword">for</span> i = 1:length(P) 
075     P(i,:) = P(i,:)/sumP(i); 
076   <span class="keyword">end</span> 
077 <span class="keyword">end</span> 
078  
079 <span class="comment">% Check that the rowsums of Qc{1},...,Qc{r} are equal to 1 </span>
080  
081 <span class="keyword">for</span> i = 1:r 
082   sumQi = sum(Qc{i}'); 
083   <span class="keyword">if</span> sum(sumQi == 1) ~= length(Qc{i}) 
084     warning([<span class="string">'Rowsums of Q{'</span> Zstr(i) <span class="string">'} not equal to 1. Renormalizing.'</span>]); 
085     <span class="keyword">for</span> j = 1:length(Qc{i}) 
086       Qc{i}(j,:) = Qc{i}(j,:)/sumQi(j); 
087     <span class="keyword">end</span> 
088   <span class="keyword">end</span> 
089 <span class="keyword">end</span> 
090  
091  
092 <span class="comment">% Make the transition matrix Q for the joint MC (X_k,Z_k) </span>
093  
094 Q = zeros(n*r,n*r); 
095 I = 0:r:(n-1)*r; 
096 <span class="keyword">for</span> z=1:r 
097   QQ = kron(Qc{z},P); 
098   Q(I+z,:) = QQ(I+z,:); 
099 <span class="keyword">end</span> 
100  
101  
102 <span class="comment">% Stationary distribution = ro of Q </span>
103  
104 ro = <a href="mc2stat.html" class="code" title="  Calculates the stationary distribution for a Markov chain.">mc2stat</a>(Q); 
105  
106 <span class="comment">% Calculate rainflow matrix / rainflow intensity </span>
107  
108 <span class="keyword">if</span> def(1) == 1  <span class="comment">% Markov Chain </span>
109  
110   N = n; 
111   mu_rfc = zeros(N,N); 
112   EYE = eye(n*r,n*r); 
113   Qcumsum = fliplr(cumsum(fliplr(Q)')'); 
114  
115   <span class="keyword">for</span> i=2:n 
116     <span class="keyword">for</span> j=i-1:n-1 
117       q = Qcumsum(:,r*j+1); 
118  
119       A = Q(r*(i-1)+1:r*j,r*(i-1)+1:r*j); <span class="comment">% i:j,   i:j </span>
120       C = Q(1:r*(i-1),r*(i-1)+1:r*j);     <span class="comment">% 1:i-1, i:j </span>
121       Eye = EYE(1:r*(j-i+1),1:r*(j-i+1)); <span class="comment">% eye (size of A) </span>
122       d = q(1:r*(i-1));                   <span class="comment">% 1:i-1 </span>
123       e = q(r*(i-1)+1:r*j);               <span class="comment">% i:j </span>
124       Ro = ro(1:r*(i-1));                 <span class="comment">% 1:i-1 </span>
125  
126       <span class="keyword">if</span> j == i-1  <span class="comment">% isempty(A) </span>
127         mu_rfc(i,j) = Ro*d; 
128       <span class="keyword">else</span> 
129         mu_rfc(i,j) = Ro*(d+C*inv(Eye-A)*e); 
130       <span class="keyword">end</span> 
131     <span class="keyword">end</span> 
132   <span class="keyword">end</span> 
133  
134 <span class="keyword">elseif</span> def(1) == 2  <span class="comment">% Discretized Markov Process </span>
135  
136   N = n+1; 
137   mu_rfc = zeros(N,N); 
138   EYE = eye(n*r,n*r); 
139   Qcumsum = fliplr(cumsum(fliplr(Q)')'); 
140  
141   <span class="keyword">for</span> i=2:N-1 
142     <span class="keyword">for</span> j=i:N-1 
143       q = Qcumsum(:,r*(j-1)+1); 
144  
145       A = Q(r*(i-1)+1:r*(j-1),r*(i-1)+1:r*(j-1)); <span class="comment">% i:j-1, i:j-1 </span>
146       C = Q(1:r*(i-1),r*(i-1)+1:r*(j-1));         <span class="comment">% 1:i-1, i:j-1 </span>
147       Eye = EYE(1:r*(j-i),1:r*(j-i));             <span class="comment">% eye (size of A) </span>
148       d = q(1:r*(i-1));                           <span class="comment">% 1:i-1 </span>
149       e = q(r*(i-1)+1:r*(j-1));                   <span class="comment">% i-1:j-1 </span>
150       Ro = ro(1:r*(i-1));                         <span class="comment">% 1:i-1 </span>
151  
152       <span class="keyword">if</span> i == j  <span class="comment">% isempty(A) </span>
153         mu_rfc(i,j) = Ro*d; 
154       <span class="keyword">else</span> 
155         mu_rfc(i,j) = Ro*(d+C*inv(Eye-A)*e); 
156       <span class="keyword">end</span> 
157     <span class="keyword">end</span> 
158   <span class="keyword">end</span> 
159  
160 <span class="keyword">end</span> 
161  
162 <span class="comment">% Fill the missing triangel in the mu_rfc matrix </span>
163 <span class="keyword">if</span> def(1) == 1 
164  
165   F_rfc = zeros(n); 
166   <span class="keyword">for</span> i = 1:n-1 
167     <span class="keyword">for</span> j= i+1:n 
168       F_rfc(i,j) = mu_rfc(i+1,j-1)-mu_rfc(i,j-1)-mu_rfc(i+1,j)+mu_rfc(i,j); 
169     <span class="keyword">end</span> 
170   <span class="keyword">end</span> 
171    
172   mu_rfc = <a href="../../wafo/cycles/cmat2nt.html" class="code" title=" Calculates a counting distribution from a cycle matrix.">cmat2nt</a>(F_rfc); 
173    
174 <span class="comment">% Old version </span>
175 <span class="comment">%  mu_rfc=flipud(mu_rfc'); <span class="comment">% Convert to WAT matrix-format </span></span>
176 <span class="comment">%    for k = 2:N-1 </span>
177 <span class="comment">%      for m = 1:N-k </span>
178 <span class="comment">%        i = k+m; </span>
179 <span class="comment">%        j = N+1+k-i; </span>
180 <span class="comment">%        mu_rfc(i,j) = mu_rfc(i,j-1)+mu_rfc(i-1,j)-mu_rfc(i-1,j-1); </span>
181 <span class="comment">%      end </span>
182 <span class="comment">%    end </span>
183 <span class="comment">%     </span>
184 <span class="comment">%  mu_rfc = flipud(mu_rfc)'; <span class="comment">% Convert to PJ-def </span></span>
185 <span class="comment">%   </span>
186 <span class="comment">%  F_rfc = nt2cmat(mu_rfc);    <span class="comment">% Calculate Rainflow matrix </span></span>
187 <span class="comment">%   </span>
188 <span class="comment">%<span class="comment">%  F_rfc = fliplr(triu(fliplr(F_rfc),1)); <span class="comment">% Zeros blow SW-NE diagonal </span></span></span>
189  
190 <span class="keyword">end</span> 
191  
192 <span class="keyword">if</span> def(1) == 2 
193  
194   mu_rfc=flipud(mu_rfc'); <span class="comment">% Convert to WAT matrix-format </span>
195   <span class="keyword">for</span> k = 1:N-1 
196     <span class="keyword">for</span> m = 1:N-k 
197       i = k+m; 
198       j = N+1+k-i; 
199       mu_rfc(i,j) = mu_rfc(i,j-1)+mu_rfc(i-1,j)-mu_rfc(i-1,j-1); 
200     <span class="keyword">end</span> 
201   <span class="keyword">end</span> 
202  
203   <span class="comment">% Calculate rainflow intensity by numerical differentiation </span>
204  
205   h = def(2); 
206   F_rfc = zeros(N,N); 
207  
208   <span class="keyword">for</span> i=2:N-1 
209     <span class="keyword">for</span> j=2:N-i 
210       F_rfc(i,j) = (mu_rfc(i-1,j-1)-mu_rfc(i-1,j+1) -(mu_rfc(i+1,j-1)-mu_rfc(i+1,j+1))) / (2*h)^2; 
211     <span class="keyword">end</span> 
212   <span class="keyword">end</span> 
213    
214   F_rfc = flipud(F_rfc)';   <span class="comment">% Convert to PJ-def </span>
215   mu_rfc = flipud(mu_rfc)'; <span class="comment">% Convert to PJ-def </span>
216  
217 <span class="keyword">end</span> 
218  
219  
220  
221</pre></div>
<HR noShade>
<SMALL><A href="http://www.maths.lth.se/matstat/">Mathematical 
Statistics</A><BR><A href="http://www.maths.lth.se/">Centre for Mathematical 
Sciences</A><BR><A href="http://www.lu.se/">Lund University</A> with <A 
href="http://www.lth.se/">Lund Institute of Technology</A> </SMALL>
<P><SMALL>Comments or corrections to the <A
href="mailto:wafo@maths.lth.se">WAFO group</A>  </P>

<hr><address>Generated on Thu 06-Oct-2005 02:21:16
 for <strong><A href="http://www.maths.lth.se/matstat/wafo/">WAFO</A></strong>
 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>